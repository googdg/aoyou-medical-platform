<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººä¸­å¿ƒåŠŸèƒ½æµ‹è¯•</title>
    <link rel="stylesheet" href="./css/aoyou-medical.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .test-btn {
            padding: 12px 20px;
            background: #2E86AB;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        .test-btn:hover {
            background: #1E5F7F;
        }
        .test-btn.secondary {
            background: #6c757d;
        }
        .test-btn.danger {
            background: #dc3545;
        }
        .test-results {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }
        .mock-data {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ä¸ªäººä¸­å¿ƒåŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š å½“å‰ç”¨æˆ·çŠ¶æ€</h2>
            <div id="user-status" class="mock-data">
                <p><strong>ç™»å½•çŠ¶æ€:</strong> <span id="login-status">æœªç™»å½•</span></p>
                <p><strong>ç”¨æˆ·å:</strong> <span id="current-username">-</span></p>
                <p><strong>é‚€è¯·ç :</strong> <span id="current-invite-code">-</span></p>
                <p><strong>ç§¯åˆ†:</strong> <span id="current-points">0</span></p>
                <p><strong>ç­‰çº§:</strong> <span id="current-level">1</span></p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h2>
            <div class="test-actions">
                <button onclick="createMockUser()" class="test-btn">åˆ›å»ºæµ‹è¯•ç”¨æˆ·</button>
                <button onclick="addMockWatchHistory()" class="test-btn">æ·»åŠ è§‚çœ‹è®°å½•</button>
                <button onclick="addMockFavorites()" class="test-btn">æ·»åŠ æ”¶è—è®°å½•</button>
                <button onclick="addMockLikes()" class="test-btn">æ·»åŠ ç‚¹èµè®°å½•</button>
                <button onclick="testProfileUI()" class="test-btn">æµ‹è¯•ä¸ªäººä¸­å¿ƒUI</button>
                <button onclick="testStatistics()" class="test-btn">æµ‹è¯•ç»Ÿè®¡åŠŸèƒ½</button>
                <button onclick="clearAllData()" class="test-btn danger">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
            </div>
            <div id="test-results" class="test-results">
                <h4>æµ‹è¯•ç»“æœï¼š</h4>
                <div id="test-output"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯</h2>
            <div id="statistics-display" class="mock-data">
                <p><strong>è§‚çœ‹è§†é¢‘æ•°:</strong> <span id="stat-watched">0</span></p>
                <p><strong>æ”¶è—è§†é¢‘æ•°:</strong> <span id="stat-favorites">0</span></p>
                <p><strong>ç‚¹èµè§†é¢‘æ•°:</strong> <span id="stat-likes">0</span></p>
                <p><strong>æ€»è§‚çœ‹æ—¶é•¿:</strong> <span id="stat-watch-time">0</span> åˆ†é’Ÿ</p>
                <p><strong>æœ€è¿‘è§‚çœ‹:</strong> <span id="stat-recent">æ— </span></p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸš€ æ‰“å¼€å®Œæ•´åº”ç”¨</h2>
            <p>æµ‹è¯•å®Œæˆåï¼Œæ‚¨å¯ä»¥æ‰“å¼€å®Œæ•´çš„åº”ç”¨æ¥ä½“éªŒä¸ªäººä¸­å¿ƒåŠŸèƒ½ï¼š</p>
            <a href="./aoyou-medical-platform.html" target="_blank" class="test-btn" style="display: inline-block; text-decoration: none; text-align: center;">
                æ‰“å¼€ Aoyou Digital åŒ»å­¦å­¦ä¹ å¹³å°
            </a>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ åŠŸèƒ½è¯´æ˜</h2>
            <ul>
                <li><strong>ç”¨æˆ·ä¿¡æ¯å±•ç¤º</strong>ï¼šæ˜¾ç¤ºç”¨æˆ·åã€é‚€è¯·ç ã€åŠ å…¥æ—¶é—´ç­‰åŸºæœ¬ä¿¡æ¯</li>
                <li><strong>ç»Ÿè®¡æ•°æ®</strong>ï¼šæ˜¾ç¤ºç§¯åˆ†ã€ç­‰çº§ã€è§‚çœ‹æ•°ã€æ”¶è—æ•°ã€ç‚¹èµæ•°ã€è§‚çœ‹æ—¶é•¿</li>
                <li><strong>ç­‰çº§è¿›åº¦</strong>ï¼šæ˜¾ç¤ºå½“å‰ç­‰çº§å’Œå‡çº§è¿›åº¦æ¡</li>
                <li><strong>æ”¶è—åˆ—è¡¨</strong>ï¼šæ˜¾ç¤ºç”¨æˆ·æ”¶è—çš„è§†é¢‘ï¼Œæ”¯æŒç‚¹å‡»æ’­æ”¾</li>
                <li><strong>æœ€è¿‘è§‚çœ‹</strong>ï¼šæ˜¾ç¤ºæœ€è¿‘è§‚çœ‹çš„è§†é¢‘ï¼ŒåŒ…å«è§‚çœ‹è¿›åº¦</li>
                <li><strong>åŠŸèƒ½æŒ‰é’®</strong>ï¼šæ¸…é™¤è§‚çœ‹è®°å½•ã€é€€å‡ºç™»å½•ç­‰æ“ä½œ</li>
            </ul>
        </div>
    </div>

    <script src="./js/aoyou-medical-app.js"></script>
    <script src="./js/aoyou-medical-auth.js"></script>
    <script src="./js/aoyou-medical-points.js"></script>
    
    <script>
        // é¡µé¢åŠ è½½å®Œæˆåæ›´æ–°çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            updateUserStatus();
            updateStatistics();
        });
        
        function updateUserStatus() {
            const user = JSON.parse(localStorage.getItem('aoyou_user') || 'null');
            
            if (user) {
                document.getElementById('login-status').textContent = 'å·²ç™»å½•';
                document.getElementById('current-username').textContent = user.name;
                document.getElementById('current-invite-code').textContent = user.inviteCode;
                document.getElementById('current-points').textContent = user.points || 0;
                document.getElementById('current-level').textContent = user.level || 1;
            } else {
                document.getElementById('login-status').textContent = 'æœªç™»å½•';
                document.getElementById('current-username').textContent = '-';
                document.getElementById('current-invite-code').textContent = '-';
                document.getElementById('current-points').textContent = '0';
                document.getElementById('current-level').textContent = '1';
            }
        }
        
        function updateStatistics() {
            const watchHistory = JSON.parse(localStorage.getItem('aoyou_watch_history') || '[]');
            const favorites = JSON.parse(localStorage.getItem('aoyou_favorites') || '[]');
            const likes = JSON.parse(localStorage.getItem('aoyou_likes') || '[]');
            
            // è®¡ç®—æ€»è§‚çœ‹æ—¶é•¿
            let totalWatchTime = 0;
            watchHistory.forEach(record => {
                if (record.duration && record.progress) {
                    totalWatchTime += record.duration * record.progress;
                }
            });
            
            document.getElementById('stat-watched').textContent = watchHistory.length;
            document.getElementById('stat-favorites').textContent = favorites.length;
            document.getElementById('stat-likes').textContent = likes.length;
            document.getElementById('stat-watch-time').textContent = Math.round(totalWatchTime / 60);
            
            if (watchHistory.length > 0) {
                const recent = watchHistory[0];
                const date = new Date(recent.watchedAt);
                document.getElementById('stat-recent').textContent = 
                    `${recent.videoTitle} (${date.toLocaleDateString()})`;
            } else {
                document.getElementById('stat-recent').textContent = 'æ— ';
            }
        }
        
        function createMockUser() {
            const user = {
                id: 'user_test_' + Date.now(),
                name: 'æµ‹è¯•ç”¨æˆ·1234',
                inviteCode: '1234',
                avatar: './images/default-avatar.png',
                points: 150,
                level: 2,
                registeredAt: new Date().toISOString()
            };
            
            localStorage.setItem('aoyou_user', JSON.stringify(user));
            updateUserStatus();
            showTestResult('âœ… æµ‹è¯•ç”¨æˆ·åˆ›å»ºæˆåŠŸ');
        }
        
        function addMockWatchHistory() {
            const watchHistory = JSON.parse(localStorage.getItem('aoyou_watch_history') || '[]');
            
            const mockRecords = [
                {
                    videoId: 'basic_1',
                    videoTitle: 'åŸºç¡€åŒ»å­¦ç³»åˆ— - ç¬¬1è®²',
                    videoCategory: 'åŸºç¡€åŒ»å­¦',
                    videoThumbnail: './images/default-thumbnail.jpg',
                    watchedAt: new Date(Date.now() - 1000 * 60 * 30).toISOString(), // 30åˆ†é’Ÿå‰
                    duration: 1800, // 30åˆ†é’Ÿ
                    progress: 0.8 // è§‚çœ‹äº†80%
                },
                {
                    videoId: 'clinical_2',
                    videoTitle: 'ä¸´åºŠåŒ»å­¦å®è·µ - ç¬¬2è®²',
                    videoCategory: 'ä¸´åºŠåŒ»å­¦',
                    videoThumbnail: './images/default-thumbnail.jpg',
                    watchedAt: new Date(Date.now() - 1000 * 60 * 60 * 2).toISOString(), // 2å°æ—¶å‰
                    duration: 2400, // 40åˆ†é’Ÿ
                    progress: 1.0 // è§‚çœ‹å®Œæˆ
                },
                {
                    videoId: 'imaging_3',
                    videoTitle: 'åŒ»å­¦å½±åƒè¯Šæ–­ - ç¬¬3è®²',
                    videoCategory: 'åŒ»å­¦å½±åƒ',
                    videoThumbnail: './images/default-thumbnail.jpg',
                    watchedAt: new Date(Date.now() - 1000 * 60 * 60 * 24).toISOString(), // 1å¤©å‰
                    duration: 3000, // 50åˆ†é’Ÿ
                    progress: 0.6 // è§‚çœ‹äº†60%
                }
            ];
            
            mockRecords.forEach(record => {
                const existingIndex = watchHistory.findIndex(item => item.videoId === record.videoId);
                if (existingIndex >= 0) {
                    watchHistory[existingIndex] = record;
                } else {
                    watchHistory.unshift(record);
                }
            });
            
            localStorage.setItem('aoyou_watch_history', JSON.stringify(watchHistory));
            updateStatistics();
            showTestResult('âœ… è§‚çœ‹è®°å½•æ·»åŠ æˆåŠŸ');
        }
        
        function addMockFavorites() {
            const favorites = JSON.parse(localStorage.getItem('aoyou_favorites') || '[]');
            
            const mockFavorites = [
                {
                    id: 'fav_1',
                    videoId: 'basic_1',
                    userId: 'user_test',
                    videoTitle: 'åŸºç¡€åŒ»å­¦ç³»åˆ— - ç¬¬1è®²',
                    videoThumbnail: './images/default-thumbnail.jpg',
                    timestamp: new Date().toISOString()
                },
                {
                    id: 'fav_2',
                    videoId: 'pharmacy_4',
                    userId: 'user_test',
                    videoTitle: 'è¯å­¦ä¸æ²»ç–— - ç¬¬4è®²',
                    videoThumbnail: './images/default-thumbnail.jpg',
                    timestamp: new Date().toISOString()
                }
            ];
            
            mockFavorites.forEach(fav => {
                if (!favorites.find(f => f.videoId === fav.videoId)) {
                    favorites.unshift(fav);
                }
            });
            
            localStorage.setItem('aoyou_favorites', JSON.stringify(favorites));
            updateStatistics();
            showTestResult('âœ… æ”¶è—è®°å½•æ·»åŠ æˆåŠŸ');
        }
        
        function addMockLikes() {
            const likes = JSON.parse(localStorage.getItem('aoyou_likes') || '[]');
            
            const mockLikes = [
                {
                    id: 'like_1',
                    videoId: 'basic_1',
                    userId: 'user_test',
                    timestamp: new Date().toISOString()
                },
                {
                    id: 'like_2',
                    videoId: 'clinical_2',
                    userId: 'user_test',
                    timestamp: new Date().toISOString()
                },
                {
                    id: 'like_3',
                    videoId: 'technology_5',
                    userId: 'user_test',
                    timestamp: new Date().toISOString()
                }
            ];
            
            mockLikes.forEach(like => {
                if (!likes.find(l => l.videoId === like.videoId)) {
                    likes.unshift(like);
                }
            });
            
            localStorage.setItem('aoyou_likes', JSON.stringify(likes));
            updateStatistics();
            showTestResult('âœ… ç‚¹èµè®°å½•æ·»åŠ æˆåŠŸ');
        }
        
        function testProfileUI() {
            const user = JSON.parse(localStorage.getItem('aoyou_user') || 'null');
            
            if (!user) {
                showTestResult('âŒ è¯·å…ˆåˆ›å»ºæµ‹è¯•ç”¨æˆ·');
                return;
            }
            
            // æµ‹è¯•ä¸ªäººä¸­å¿ƒUIæ›´æ–°é€»è¾‘
            const tests = [
                { name: 'ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º', pass: !!user.name },
                { name: 'é‚€è¯·ç æ˜¾ç¤º', pass: !!user.inviteCode },
                { name: 'ç§¯åˆ†æ˜¾ç¤º', pass: typeof user.points === 'number' },
                { name: 'ç­‰çº§æ˜¾ç¤º', pass: typeof user.level === 'number' },
                { name: 'æ³¨å†Œæ—¶é—´æ˜¾ç¤º', pass: !!user.registeredAt }
            ];
            
            let results = '<ul>';
            tests.forEach(test => {
                const status = test.pass ? 'âœ…' : 'âŒ';
                const color = test.pass ? 'green' : 'red';
                results += `<li style="color: ${color}">${status} ${test.name}</li>`;
            });
            results += '</ul>';
            
            showTestResult('ä¸ªäººä¸­å¿ƒUIæµ‹è¯•ç»“æœï¼š' + results);
        }
        
        function testStatistics() {
            const watchHistory = JSON.parse(localStorage.getItem('aoyou_watch_history') || '[]');
            const favorites = JSON.parse(localStorage.getItem('aoyou_favorites') || '[]');
            const likes = JSON.parse(localStorage.getItem('aoyou_likes') || '[]');
            
            let totalWatchTime = 0;
            watchHistory.forEach(record => {
                if (record.duration && record.progress) {
                    totalWatchTime += record.duration * record.progress;
                }
            });
            
            const stats = {
                watchedVideos: watchHistory.length,
                favoriteVideos: favorites.length,
                likedVideos: likes.length,
                totalWatchTimeMinutes: Math.round(totalWatchTime / 60)
            };
            
            showTestResult(`
                ç»Ÿè®¡åŠŸèƒ½æµ‹è¯•ç»“æœï¼š<br>
                ğŸ“º è§‚çœ‹è§†é¢‘: ${stats.watchedVideos} ä¸ª<br>
                â­ æ”¶è—è§†é¢‘: ${stats.favoriteVideos} ä¸ª<br>
                ğŸ‘ ç‚¹èµè§†é¢‘: ${stats.likedVideos} ä¸ª<br>
                â±ï¸ è§‚çœ‹æ—¶é•¿: ${stats.totalWatchTimeMinutes} åˆ†é’Ÿ
            `);
        }
        
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æµ‹è¯•æ•°æ®å—ï¼Ÿ')) {
                const keysToRemove = [
                    'aoyou_user',
                    'aoyou_watch_history',
                    'aoyou_favorites',
                    'aoyou_likes',
                    'aoyou_points_history'
                ];
                
                keysToRemove.forEach(key => {
                    localStorage.removeItem(key);
                });
                
                updateUserStatus();
                updateStatistics();
                showTestResult('âœ… æ‰€æœ‰æµ‹è¯•æ•°æ®å·²æ¸…é™¤');
            }
        }
        
        function showTestResult(message) {
            const results = document.getElementById('test-results');
            const output = document.getElementById('test-output');
            
            results.style.display = 'block';
            output.innerHTML = message;
        }
    </script>
</body>
</html>