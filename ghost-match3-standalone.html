<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°é¬¼æ¶ˆæ¶ˆä¹ - Little Ghost Match-3</title>
    <meta name="description" content="å°é¬¼æ¶ˆæ¶ˆä¹ - æœ‰è¶£çš„ä¸‰æ¶ˆç›Šæ™ºæ¸¸æˆï¼ŒæŒ‘æˆ˜ä½ çš„ç­–ç•¥æ€ç»´">
    
    <!-- ç¤¾äº¤åª’ä½“åˆ†äº«ä¼˜åŒ– -->
    <meta property="og:title" content="å°é¬¼æ¶ˆæ¶ˆä¹ - Little Ghost Match-3">
    <meta property="og:description" content="æœ‰è¶£çš„ä¸‰æ¶ˆç›Šæ™ºæ¸¸æˆï¼ŒæŒ‘æˆ˜ä½ çš„ç­–ç•¥æ€ç»´ï¼">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://via.placeholder.com/1200x630/667eea/ffffff?text=å°é¬¼æ¶ˆæ¶ˆä¹">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="å°é¬¼æ¶ˆæ¶ˆä¹ - Little Ghost Match-3">
    <meta name="twitter:description" content="æœ‰è¶£çš„ä¸‰æ¶ˆç›Šæ™ºæ¸¸æˆï¼ŒæŒ‘æˆ˜ä½ çš„ç­–ç•¥æ€ç»´ï¼">
    
    <!-- PWAæ”¯æŒ -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="å°é¬¼æ¶ˆæ¶ˆä¹">
    
    <!-- å›¾æ ‡ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ‘»</text></svg>">
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        .game-title {
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .game-subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .game-board {
            width: 480px;
            height: 480px;
            margin: 20px auto;
            background: #f8f9fa;
            border: 3px solid #667eea;
            border-radius: 12px;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 2px;
            padding: 8px;
            position: relative;
        }

        .game-tile {
            background: linear-gradient(135deg, #ffffff 0%, #f1f3f4 100%);
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 2rem;
            user-select: none;
            position: relative;
            overflow: hidden;
        }

        .game-tile:hover {
            transform: scale(1.05);
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .game-tile.selected {
            border-color: #ffd700;
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.5);
        }

        .game-tile.matched {
            animation: matchPulse 0.5s ease-in-out;
        }

        @keyframes matchPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); background: #ffeb3b; }
            100% { transform: scale(0); opacity: 0; }
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        /* éŸ³é¢‘æ§åˆ¶æ ·å¼ */
        .audio-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .audio-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(40, 167, 69, 0.3);
        }

        .audio-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.4);
        }

        .audio-btn.muted {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            box-shadow: 0 2px 6px rgba(220, 53, 69, 0.3);
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            border-radius: 20px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            border-radius: 2px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .game-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .game-btn:active {
            transform: translateY(0);
        }

        .game-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .game-message {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: 500;
            display: none;
        }

        .game-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .game-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .game-message.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .instructions {
            margin-top: 30px;
            text-align: left;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .instructions h3 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .instructions ul {
            list-style: none;
            padding: 0;
        }

        .instructions li {
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .instructions li:last-child {
            border-bottom: none;
        }

        .ghost-colors {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .ghost-color {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            border: 2px solid #ddd;
            transition: transform 0.2s ease;
        }

        .ghost-color:hover {
            transform: scale(1.1);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-container {
                padding: 20px;
                margin: 10px;
            }

            .game-title {
                font-size: 2rem;
            }

            .game-board {
                width: 90vw;
                height: 90vw;
                max-width: 400px;
                max-height: 400px;
            }

            .game-tile {
                font-size: 1.5rem;
            }

            .game-info {
                flex-direction: column;
                gap: 10px;
            }

            .game-controls {
                flex-direction: column;
                align-items: center;
            }

            .game-btn {
                width: 200px;
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="game-title">å°é¬¼æ¶ˆæ¶ˆä¹</h1>
        <p class="game-subtitle">Little Ghost Match-3 Puzzle Game</p>

        <!-- æ¸¸æˆä¿¡æ¯æ˜¾ç¤º -->
        <div class="game-info">
            <div class="info-item">
                <div class="info-label">åˆ†æ•°</div>
                <div class="info-value" id="score">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">å…³å¡</div>
                <div class="info-value" id="level">1</div>
            </div>
            <div class="info-item">
                <div class="info-label">ç§»åŠ¨</div>
                <div class="info-value" id="moves">30</div>
            </div>
        </div>

        <!-- éŸ³é¢‘æ§åˆ¶ -->
        <div class="audio-controls">
            <button class="audio-btn" id="music-btn" onclick="toggleMusic()">ğŸµ èƒŒæ™¯éŸ³ä¹</button>
            <button class="audio-btn" id="sound-btn" onclick="toggleSound()">ğŸ”Š éŸ³æ•ˆ</button>
            <div class="volume-control">
                <span>ğŸ”Š</span>
                <input type="range" class="volume-slider" id="volume-slider" min="0" max="100" value="50" onchange="setVolume(this.value)">
                <span id="volume-display">50%</span>
            </div>
        </div>

        <!-- æ¸¸æˆæ§åˆ¶æŒ‰é’® -->
        <div class="game-controls">
            <button class="game-btn" id="start-btn" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
            <button class="game-btn" id="pause-btn" onclick="pauseGame()" disabled>æš‚åœ</button>
            <button class="game-btn" id="restart-btn" onclick="restartGame()" disabled>é‡æ–°å¼€å§‹</button>
            <button class="game-btn" id="hint-btn" onclick="showHint()" disabled>æç¤º</button>
        </div>

        <!-- æ¸¸æˆæ¶ˆæ¯ -->
        <div class="game-message" id="game-message"></div>

        <!-- æ¸¸æˆç½‘æ ¼ -->
        <div class="game-board" id="game-board">
            <!-- æ¸¸æˆç“¦ç‰‡å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
        </div>

        <!-- å°é¬¼é¢œè‰²è¯´æ˜ -->
        <div class="ghost-colors">
            <div class="ghost-color" style="background: #FF6B6B;">ğŸ‘»</div>
            <div class="ghost-color" style="background: #4ECDC4;">ğŸƒ</div>
            <div class="ghost-color" style="background: #45B7D1;">ğŸ‘¹</div>
            <div class="ghost-color" style="background: #96CEB4;">ğŸ‘º</div>
            <div class="ghost-color" style="background: #FFEAA7;">ğŸ¤–</div>
            <div class="ghost-color" style="background: #DDA0DD;">ğŸ‘½</div>
        </div>

        <!-- æ¸¸æˆè¯´æ˜ -->
        <div class="instructions">
            <h3>æ¸¸æˆè¯´æ˜</h3>
            <ul>
                <li>ğŸ¯ <strong>ç›®æ ‡</strong>: é€šè¿‡äº¤æ¢ç›¸é‚»çš„å°é¬¼ï¼Œåˆ›é€ ä¸‰ä¸ªæˆ–æ›´å¤šç›¸åŒå°é¬¼çš„è¿çº¿</li>
                <li>ğŸ–±ï¸ <strong>æ“ä½œ</strong>: ç‚¹å‡»ä¸€ä¸ªå°é¬¼ï¼Œç„¶åç‚¹å‡»ç›¸é‚»çš„å°é¬¼æ¥äº¤æ¢ä½ç½®</li>
                <li>ğŸ“± <strong>ç§»åŠ¨ç«¯</strong>: å¯ä»¥é€šè¿‡æ»‘åŠ¨æ‰‹åŠ¿æ¥äº¤æ¢å°é¬¼</li>
                <li>â­ <strong>ç‰¹æ®Šé“å…·</strong>: åŒ¹é…4ä¸ªæˆ–æ›´å¤šå°é¬¼å¯ä»¥åˆ›é€ ç‰¹æ®Šé“å…·</li>
                <li>ğŸ† <strong>å¾—åˆ†</strong>: åŒ¹é…æ›´å¤šå°é¬¼è·å¾—æ›´é«˜åˆ†æ•°ï¼Œå®Œæˆå…³å¡ç›®æ ‡</li>
            </ul>
        </div>

        <!-- åˆ†äº«åŒºåŸŸ -->
        <div class="share-section" style="margin-top: 30px; text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px;">
            <h3 style="color: #333; margin-bottom: 15px;">ğŸ® åˆ†äº«ç»™æœ‹å‹ä»¬</h3>
            <p style="color: #666; margin-bottom: 15px;">è§‰å¾—å¥½ç©ï¼Ÿåˆ†äº«ç»™æœ‹å‹ä¸€èµ·æŒ‘æˆ˜å§ï¼</p>
            <div class="share-buttons" style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                <button class="game-btn" onclick="shareGame('copy')" style="font-size: 0.9rem; padding: 8px 16px;">ğŸ“‹ å¤åˆ¶é“¾æ¥</button>
                <button class="game-btn" onclick="shareGame('wechat')" style="font-size: 0.9rem; padding: 8px 16px;">ğŸ’¬ å¾®ä¿¡åˆ†äº«</button>
                <button class="game-btn" onclick="shareGame('weibo')" style="font-size: 0.9rem; padding: 8px 16px;">ğŸ¦ å¾®åšåˆ†äº«</button>
            </div>
        </div>

        <!-- ç‰ˆæƒä¿¡æ¯ -->
        <div style="margin-top: 30px; text-align: center; color: #666; font-size: 0.9rem;">
            <p>ğŸ¨ ç”± AI åŠ©æ‰‹å¼€å‘ | ğŸ’ å…è´¹å¼€æºæ¸¸æˆ</p>
            <p>â­ å¦‚æœå–œæ¬¢ï¼Œè¯·åˆ†äº«ç»™æ›´å¤šæœ‹å‹ï¼</p>
        </div>
    </div>

    <script>
        // éŸ³é¢‘ç®¡ç†ç³»ç»Ÿ
        class AudioManager {
            constructor() {
                this.audioContext = null;
                this.backgroundMusic = null;
                this.musicEnabled = true;
                this.soundEnabled = true;
                this.volume = 0.5;
                this.musicVolume = 0.3;
                this.soundVolume = 0.7;
                
                this.initAudioContext();
                this.createBackgroundMusic();
            }
            
            async initAudioContext() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (error) {
                    console.log('Web Audio API not supported');
                }
            }
            
            // åˆ›å»ºèƒŒæ™¯éŸ³ä¹ï¼ˆä½¿ç”¨éŸ³é¢‘åˆæˆï¼‰
            createBackgroundMusic() {
                if (!this.audioContext) return;
                
                // åˆ›å»ºä¸€ä¸ªç®€å•çš„èƒŒæ™¯éŸ³ä¹å¾ªç¯
                this.backgroundMusic = {
                    oscillators: [],
                    gainNode: null,
                    isPlaying: false
                };
                
                // åˆ›å»ºå¢ç›ŠèŠ‚ç‚¹æ§åˆ¶éŸ³é‡
                this.backgroundMusic.gainNode = this.audioContext.createGain();
                this.backgroundMusic.gainNode.connect(this.audioContext.destination);
                this.backgroundMusic.gainNode.gain.value = this.musicVolume;
            }
            
            // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
            playBackgroundMusic() {
                if (!this.audioContext || !this.musicEnabled || this.backgroundMusic.isPlaying) return;
                
                // æ¢å¤éŸ³é¢‘ä¸Šä¸‹æ–‡ï¼ˆæŸäº›æµè§ˆå™¨éœ€è¦ç”¨æˆ·äº¤äº’ï¼‰
                if (this.audioContext.state === 'suspended') {
                    this.audioContext.resume();
                }
                
                this.backgroundMusic.isPlaying = true;
                this.playMelodyLoop();
            }
            
            // æ’­æ”¾æ—‹å¾‹å¾ªç¯
            playMelodyLoop() {
                if (!this.musicEnabled || !this.backgroundMusic.isPlaying) return;
                
                // ç®€å•çš„æ—‹å¾‹éŸ³ç¬¦ (Cå¤§è°ƒéŸ³é˜¶)
                const notes = [261.63, 293.66, 329.63, 349.23, 392.00, 440.00, 493.88, 523.25];
                const melody = [0, 2, 4, 2, 0, 2, 4, 2, 4, 5, 6, 4, 5, 6]; // ç®€å•æ—‹å¾‹
                
                let noteIndex = 0;
                const playNote = () => {
                    if (!this.musicEnabled || !this.backgroundMusic.isPlaying) return;
                    
                    const frequency = notes[melody[noteIndex % melody.length]];
                    this.playTone(frequency, 0.5, this.musicVolume * 0.3, 'sine');
                    
                    noteIndex++;
                    setTimeout(playNote, 800); // æ¯ä¸ªéŸ³ç¬¦æŒç»­800ms
                };
                
                playNote();
            }
            
            // åœæ­¢èƒŒæ™¯éŸ³ä¹
            stopBackgroundMusic() {
                if (this.backgroundMusic) {
                    this.backgroundMusic.isPlaying = false;
                    this.backgroundMusic.oscillators.forEach(osc => {
                        try {
                            osc.stop();
                        } catch (e) {}
                    });
                    this.backgroundMusic.oscillators = [];
                }
            }
            
            // æ’­æ”¾éŸ³è°ƒ
            playTone(frequency, duration, volume = 0.5, type = 'sine') {
                if (!this.audioContext || !this.soundEnabled) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume * this.volume, this.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
                
                return oscillator;
            }
            
            // æ’­æ”¾åŒ¹é…éŸ³æ•ˆ
            playMatchSound(matchCount = 3) {
                if (!this.soundEnabled) return;
                
                // æ ¹æ®åŒ¹é…æ•°é‡æ’­æ”¾ä¸åŒéŸ³æ•ˆ
                const baseFreq = 440;
                const frequencies = [];
                
                for (let i = 0; i < matchCount; i++) {
                    frequencies.push(baseFreq * Math.pow(1.2, i));
                }
                
                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        this.playTone(freq, 0.3, this.soundVolume * 0.6, 'triangle');
                    }, index * 100);
                });
            }
            
            // æ’­æ”¾ç‰¹æ®ŠåŒ¹é…éŸ³æ•ˆ
            playSpecialMatchSound() {
                if (!this.soundEnabled) return;
                
                // æ’­æ”¾ä¸Šå‡éŸ³é˜¶
                const frequencies = [523.25, 587.33, 659.25, 698.46, 783.99];
                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        this.playTone(freq, 0.2, this.soundVolume * 0.8, 'sawtooth');
                    }, index * 80);
                });
            }
            
            // æ’­æ”¾ç§»åŠ¨éŸ³æ•ˆ
            playMoveSound() {
                if (!this.soundEnabled) return;
                this.playTone(330, 0.1, this.soundVolume * 0.4, 'square');
            }
            
            // æ’­æ”¾æ— æ•ˆç§»åŠ¨éŸ³æ•ˆ
            playInvalidMoveSound() {
                if (!this.soundEnabled) return;
                this.playTone(150, 0.3, this.soundVolume * 0.5, 'sawtooth');
            }
            
            // æ’­æ”¾å…³å¡å®ŒæˆéŸ³æ•ˆ
            playLevelCompleteSound() {
                if (!this.soundEnabled) return;
                
                // æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
                const victoryMelody = [523.25, 659.25, 783.99, 1046.50];
                victoryMelody.forEach((freq, index) => {
                    setTimeout(() => {
                        this.playTone(freq, 0.4, this.soundVolume * 0.9, 'triangle');
                    }, index * 200);
                });
            }
            
            // æ’­æ”¾æ¸¸æˆç»“æŸéŸ³æ•ˆ
            playGameOverSound() {
                if (!this.soundEnabled) return;
                
                // æ’­æ”¾ä¸‹é™éŸ³æ•ˆ
                const gameOverMelody = [440, 392, 349.23, 293.66];
                gameOverMelody.forEach((freq, index) => {
                    setTimeout(() => {
                        this.playTone(freq, 0.5, this.soundVolume * 0.8, 'sine');
                    }, index * 300);
                });
            }
            
            // æ’­æ”¾æŒ‰é’®ç‚¹å‡»éŸ³æ•ˆ
            playClickSound() {
                if (!this.soundEnabled) return;
                this.playTone(800, 0.1, this.soundVolume * 0.3, 'square');
            }
            
            // è®¾ç½®éŸ³é‡
            setVolume(volume) {
                this.volume = volume / 100;
                if (this.backgroundMusic && this.backgroundMusic.gainNode) {
                    this.backgroundMusic.gainNode.gain.value = this.musicVolume * this.volume;
                }
            }
            
            // åˆ‡æ¢éŸ³ä¹
            toggleMusic() {
                this.musicEnabled = !this.musicEnabled;
                if (this.musicEnabled) {
                    this.playBackgroundMusic();
                } else {
                    this.stopBackgroundMusic();
                }
                return this.musicEnabled;
            }
            
            // åˆ‡æ¢éŸ³æ•ˆ
            toggleSound() {
                this.soundEnabled = !this.soundEnabled;
                return this.soundEnabled;
            }
        }

        // ç®€åŒ–ç‰ˆæ¸¸æˆé€»è¾‘
        class SimpleGhostMatch3 {
            constructor() {
                this.gridSize = 8;
                this.ghostTypes = 6;
                this.grid = [];
                this.score = 0;
                this.level = 1;
                this.moves = 30;
                this.selectedTile = null;
                this.isGameActive = false;
                this.gameBoard = document.getElementById('game-board');
                
                this.ghostEmojis = ['ğŸ‘»', 'ğŸƒ', 'ğŸ‘¹', 'ğŸ‘º', 'ğŸ¤–', 'ğŸ‘½'];
                this.ghostColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD'];
                
                // åˆå§‹åŒ–éŸ³é¢‘ç®¡ç†å™¨
                this.audioManager = new AudioManager();
                
                this.initializeGrid();
            }
            
            initializeGrid() {
                this.grid = [];
                for (let y = 0; y < this.gridSize; y++) {
                    this.grid[y] = [];
                    for (let x = 0; x < this.gridSize; x++) {
                        this.grid[y][x] = this.createRandomGhost();
                    }
                }
                
                // ç¡®ä¿åˆå§‹çŠ¶æ€æ²¡æœ‰åŒ¹é…
                this.removeInitialMatches();
                this.renderGrid();
            }
            
            createRandomGhost() {
                const type = Math.floor(Math.random() * this.ghostTypes);
                return {
                    type: type,
                    emoji: this.ghostEmojis[type],
                    color: this.ghostColors[type],
                    id: Math.random().toString(36).substr(2, 9)
                };
            }
            
            removeInitialMatches() {
                let hasMatches = true;
                while (hasMatches) {
                    const matches = this.findMatches();
                    if (matches.length === 0) {
                        hasMatches = false;
                    } else {
                        // é‡æ–°ç”ŸæˆåŒ¹é…çš„ç“¦ç‰‡
                        matches.forEach(match => {
                            match.forEach(pos => {
                                this.grid[pos.y][pos.x] = this.createRandomGhost();
                            });
                        });
                    }
                }
            }
            
            renderGrid() {
                this.gameBoard.innerHTML = '';
                
                for (let y = 0; y < this.gridSize; y++) {
                    for (let x = 0; x < this.gridSize; x++) {
                        const tile = document.createElement('div');
                        tile.className = 'game-tile';
                        tile.dataset.x = x;
                        tile.dataset.y = y;
                        tile.textContent = this.grid[y][x].emoji;
                        tile.style.backgroundColor = this.grid[y][x].color + '20';
                        tile.addEventListener('click', () => this.handleTileClick(x, y));
                        
                        this.gameBoard.appendChild(tile);
                    }
                }
            }
            
            handleTileClick(x, y) {
                if (!this.isGameActive) return;
                
                const tile = this.gameBoard.children[y * this.gridSize + x];
                
                if (this.selectedTile === null) {
                    // é€‰æ‹©ç“¦ç‰‡
                    this.selectedTile = { x, y };
                    tile.classList.add('selected');
                    this.audioManager.playClickSound();
                } else if (this.selectedTile.x === x && this.selectedTile.y === y) {
                    // å–æ¶ˆé€‰æ‹©
                    tile.classList.remove('selected');
                    this.selectedTile = null;
                    this.audioManager.playClickSound();
                } else {
                    // å°è¯•äº¤æ¢
                    this.attemptSwap(this.selectedTile, { x, y });
                }
            }
            
            attemptSwap(pos1, pos2) {
                // æ£€æŸ¥æ˜¯å¦ç›¸é‚»
                const dx = Math.abs(pos1.x - pos2.x);
                const dy = Math.abs(pos1.y - pos2.y);
                
                if ((dx === 1 && dy === 0) || (dx === 0 && dy === 1)) {
                    // æ‰§è¡Œäº¤æ¢
                    this.swapTiles(pos1, pos2);
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰åŒ¹é…
                    const matches = this.findMatches();
                    
                    if (matches.length > 0) {
                        // æœ‰æ•ˆç§»åŠ¨
                        this.moves--;
                        this.updateUI();
                        this.audioManager.playMoveSound();
                        this.processMatches(matches);
                    } else {
                        // æ— æ•ˆç§»åŠ¨ï¼Œæ¢å¤
                        this.swapTiles(pos1, pos2);
                        this.audioManager.playInvalidMoveSound();
                        this.showMessage('æ— æ•ˆç§»åŠ¨ï¼', 'warning');
                    }
                } else {
                    this.audioManager.playInvalidMoveSound();
                    this.showMessage('åªèƒ½äº¤æ¢ç›¸é‚»çš„å°é¬¼ï¼', 'warning');
                }
                
                // æ¸…é™¤é€‰æ‹©
                this.clearSelection();
            }
            
            swapTiles(pos1, pos2) {
                const temp = this.grid[pos1.y][pos1.x];
                this.grid[pos1.y][pos1.x] = this.grid[pos2.y][pos2.x];
                this.grid[pos2.y][pos2.x] = temp;
                this.renderGrid();
            }
            
            findMatches() {
                const matches = [];
                
                // æŸ¥æ‰¾æ°´å¹³åŒ¹é…
                for (let y = 0; y < this.gridSize; y++) {
                    let count = 1;
                    let currentType = this.grid[y][0].type;
                    
                    for (let x = 1; x < this.gridSize; x++) {
                        if (this.grid[y][x].type === currentType) {
                            count++;
                        } else {
                            if (count >= 3) {
                                const match = [];
                                for (let i = x - count; i < x; i++) {
                                    match.push({ x: i, y: y });
                                }
                                matches.push(match);
                            }
                            count = 1;
                            currentType = this.grid[y][x].type;
                        }
                    }
                    
                    if (count >= 3) {
                        const match = [];
                        for (let i = this.gridSize - count; i < this.gridSize; i++) {
                            match.push({ x: i, y: y });
                        }
                        matches.push(match);
                    }
                }
                
                // æŸ¥æ‰¾å‚ç›´åŒ¹é…
                for (let x = 0; x < this.gridSize; x++) {
                    let count = 1;
                    let currentType = this.grid[0][x].type;
                    
                    for (let y = 1; y < this.gridSize; y++) {
                        if (this.grid[y][x].type === currentType) {
                            count++;
                        } else {
                            if (count >= 3) {
                                const match = [];
                                for (let i = y - count; i < y; i++) {
                                    match.push({ x: x, y: i });
                                }
                                matches.push(match);
                            }
                            count = 1;
                            currentType = this.grid[y][x].type;
                        }
                    }
                    
                    if (count >= 3) {
                        const match = [];
                        for (let i = this.gridSize - count; i < this.gridSize; i++) {
                            match.push({ x: x, y: i });
                        }
                        matches.push(match);
                    }
                }
                
                return matches;
            }
            
            processMatches(matches) {
                let totalScore = 0;
                let maxMatchLength = 0;
                
                matches.forEach(match => {
                    totalScore += match.length * 10;
                    maxMatchLength = Math.max(maxMatchLength, match.length);
                    
                    // æ ‡è®°åŒ¹é…çš„ç“¦ç‰‡
                    match.forEach(pos => {
                        const tileIndex = pos.y * this.gridSize + pos.x;
                        const tile = this.gameBoard.children[tileIndex];
                        tile.classList.add('matched');
                    });
                });
                
                // æ’­æ”¾åŒ¹é…éŸ³æ•ˆ
                if (maxMatchLength >= 5) {
                    this.audioManager.playSpecialMatchSound();
                } else {
                    this.audioManager.playMatchSound(maxMatchLength);
                }
                
                this.score += totalScore;
                this.showMessage(`å¤ªæ£’äº†ï¼è·å¾— ${totalScore} åˆ†ï¼`, 'success');
                
                // å»¶è¿Ÿç§»é™¤åŒ¹é…çš„ç“¦ç‰‡å¹¶åº”ç”¨é‡åŠ›
                setTimeout(() => {
                    this.removeMatches(matches);
                    this.applyGravity();
                    this.fillEmptySpaces();
                    this.renderGrid();
                    
                    // æ£€æŸ¥è¿é”ååº”
                    setTimeout(() => {
                        const newMatches = this.findMatches();
                        if (newMatches.length > 0) {
                            this.processMatches(newMatches);
                        } else {
                            this.checkGameEnd();
                        }
                    }, 300);
                }, 500);
                
                this.updateUI();
            }
            
            removeMatches(matches) {
                matches.forEach(match => {
                    match.forEach(pos => {
                        this.grid[pos.y][pos.x] = null;
                    });
                });
            }
            
            applyGravity() {
                for (let x = 0; x < this.gridSize; x++) {
                    const column = [];
                    
                    // æ”¶é›†éç©ºç“¦ç‰‡
                    for (let y = this.gridSize - 1; y >= 0; y--) {
                        if (this.grid[y][x] !== null) {
                            column.push(this.grid[y][x]);
                        }
                    }
                    
                    // é‡æ–°å¡«å……åˆ—
                    for (let y = 0; y < this.gridSize; y++) {
                        this.grid[y][x] = null;
                    }
                    
                    for (let i = 0; i < column.length; i++) {
                        this.grid[this.gridSize - 1 - i][x] = column[i];
                    }
                }
            }
            
            fillEmptySpaces() {
                for (let y = 0; y < this.gridSize; y++) {
                    for (let x = 0; x < this.gridSize; x++) {
                        if (this.grid[y][x] === null) {
                            this.grid[y][x] = this.createRandomGhost();
                        }
                    }
                }
            }
            
            clearSelection() {
                if (this.selectedTile) {
                    const tileIndex = this.selectedTile.y * this.gridSize + this.selectedTile.x;
                    this.gameBoard.children[tileIndex].classList.remove('selected');
                    this.selectedTile = null;
                }
            }
            
            updateUI() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('level').textContent = this.level;
                document.getElementById('moves').textContent = this.moves;
            }
            
            showMessage(text, type = 'info') {
                const messageEl = document.getElementById('game-message');
                messageEl.textContent = text;
                messageEl.className = `game-message ${type}`;
                messageEl.style.display = 'block';
                
                setTimeout(() => {
                    messageEl.style.display = 'none';
                }, 3000);
            }
            
            checkGameEnd() {
                if (this.moves <= 0) {
                    this.endGame();
                } else if (this.score >= this.level * 1000) {
                    this.nextLevel();
                }
            }
            
            nextLevel() {
                this.level++;
                this.moves += 20;
                this.audioManager.playLevelCompleteSound();
                this.showMessage(`æ­å–œï¼è¿›å…¥ç¬¬ ${this.level} å…³ï¼`, 'success');
                this.updateUI();
            }
            
            endGame() {
                this.isGameActive = false;
                this.audioManager.stopBackgroundMusic();
                this.audioManager.playGameOverSound();
                this.showMessage(`æ¸¸æˆç»“æŸï¼æœ€ç»ˆåˆ†æ•°: ${this.score}`, 'info');
                
                document.getElementById('start-btn').disabled = false;
                document.getElementById('pause-btn').disabled = true;
                document.getElementById('restart-btn').disabled = true;
                document.getElementById('hint-btn').disabled = true;
            }
            
            start() {
                this.isGameActive = true;
                this.score = 0;
                this.level = 1;
                this.moves = 30;
                this.initializeGrid();
                this.updateUI();
                this.audioManager.playBackgroundMusic();
                this.showMessage('æ¸¸æˆå¼€å§‹ï¼ç¥ä½ å¥½è¿ï¼', 'success');
                
                document.getElementById('start-btn').disabled = true;
                document.getElementById('pause-btn').disabled = false;
                document.getElementById('restart-btn').disabled = false;
                document.getElementById('hint-btn').disabled = false;
            }
            
            pause() {
                this.isGameActive = !this.isGameActive;
                const pauseBtn = document.getElementById('pause-btn');
                pauseBtn.textContent = this.isGameActive ? 'æš‚åœ' : 'ç»§ç»­';
                
                this.showMessage(this.isGameActive ? 'æ¸¸æˆç»§ç»­' : 'æ¸¸æˆæš‚åœ', 'info');
            }
            
            restart() {
                this.start();
            }
            
            hint() {
                // ç®€å•çš„æç¤ºï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯èƒ½çš„ç§»åŠ¨
                for (let y = 0; y < this.gridSize; y++) {
                    for (let x = 0; x < this.gridSize; x++) {
                        // æ£€æŸ¥å³ä¾§äº¤æ¢
                        if (x < this.gridSize - 1) {
                            this.swapTiles({ x, y }, { x: x + 1, y });
                            const matches = this.findMatches();
                            this.swapTiles({ x, y }, { x: x + 1, y }); // æ¢å¤
                            
                            if (matches.length > 0) {
                                this.showMessage(`æç¤ºï¼šå°è¯•äº¤æ¢ (${x+1},${y+1}) å’Œ (${x+2},${y+1}) ä½ç½®çš„å°é¬¼`, 'info');
                                return;
                            }
                        }
                        
                        // æ£€æŸ¥ä¸‹æ–¹äº¤æ¢
                        if (y < this.gridSize - 1) {
                            this.swapTiles({ x, y }, { x, y: y + 1 });
                            const matches = this.findMatches();
                            this.swapTiles({ x, y }, { x, y: y + 1 }); // æ¢å¤
                            
                            if (matches.length > 0) {
                                this.showMessage(`æç¤ºï¼šå°è¯•äº¤æ¢ (${x+1},${y+1}) å’Œ (${x+1},${y+2}) ä½ç½®çš„å°é¬¼`, 'info');
                                return;
                            }
                        }
                    }
                }
                
                this.showMessage('æ²¡æœ‰æ‰¾åˆ°æ˜æ˜¾çš„ç§»åŠ¨ï¼Œè¯•è¯•å…¶ä»–ç»„åˆï¼', 'warning');
            }
        }
        
        // å…¨å±€æ¸¸æˆå®ä¾‹
        let game = null;
        
        // æ¸¸æˆæ§åˆ¶å‡½æ•°
        function startGame() {
            if (!game) {
                game = new SimpleGhostMatch3();
            }
            game.audioManager.playClickSound();
            game.start();
        }
        
        function pauseGame() {
            if (game) {
                game.audioManager.playClickSound();
                game.pause();
            }
        }
        
        function restartGame() {
            if (game) {
                game.audioManager.playClickSound();
                game.restart();
            }
        }
        
        function showHint() {
            if (game) {
                game.hint();
            }
        }

        // éŸ³é¢‘æ§åˆ¶å‡½æ•°
        function toggleMusic() {
            if (!game || !game.audioManager) return;
            
            const isEnabled = game.audioManager.toggleMusic();
            const musicBtn = document.getElementById('music-btn');
            
            if (isEnabled) {
                musicBtn.textContent = 'ğŸµ èƒŒæ™¯éŸ³ä¹';
                musicBtn.classList.remove('muted');
            } else {
                musicBtn.textContent = 'ğŸ”‡ èƒŒæ™¯éŸ³ä¹';
                musicBtn.classList.add('muted');
            }
        }

        function toggleSound() {
            if (!game || !game.audioManager) return;
            
            const isEnabled = game.audioManager.toggleSound();
            const soundBtn = document.getElementById('sound-btn');
            
            if (isEnabled) {
                soundBtn.textContent = 'ğŸ”Š éŸ³æ•ˆ';
                soundBtn.classList.remove('muted');
            } else {
                soundBtn.textContent = 'ğŸ”‡ éŸ³æ•ˆ';
                soundBtn.classList.add('muted');
            }
        }

        function setVolume(volume) {
            if (game && game.audioManager) {
                game.audioManager.setVolume(volume);
            }
            document.getElementById('volume-display').textContent = volume + '%';
        }
        
        // åˆ†äº«åŠŸèƒ½
        function shareGame(platform) {
            const url = window.location.href;
            const title = 'å°é¬¼æ¶ˆæ¶ˆä¹ - è¶…å¥½ç©çš„ä¸‰æ¶ˆç›Šæ™ºæ¸¸æˆï¼';
            const description = 'å¿«æ¥æŒ‘æˆ˜è¿™ä¸ªæœ‰è¶£çš„å°é¬¼æ¶ˆæ¶ˆä¹æ¸¸æˆï¼Œçœ‹çœ‹ä½ èƒ½å¾—å¤šå°‘åˆ†ï¼';
            
            switch(platform) {
                case 'copy':
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(url).then(() => {
                            alert('ğŸ‰ é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\nå¿«å»åˆ†äº«ç»™æœ‹å‹ä»¬å§ï¼');
                        }).catch(() => {
                            fallbackCopyText(url);
                        });
                    } else {
                        fallbackCopyText(url);
                    }
                    break;
                    
                case 'wechat':
                    // å¾®ä¿¡åˆ†äº«æç¤º
                    alert('ğŸ“± å¾®ä¿¡åˆ†äº«æç¤ºï¼š\n\n1. å¤åˆ¶è¿™ä¸ªé“¾æ¥ï¼š' + url + '\n2. åœ¨å¾®ä¿¡ä¸­ç²˜è´´åˆ†äº«ç»™æœ‹å‹\n3. æˆ–è€…æˆªå›¾äºŒç»´ç åˆ†äº«');
                    break;
                    
                case 'weibo':
                    const weiboUrl = `https://service.weibo.com/share/share.php?url=${encodeURIComponent(url)}&title=${encodeURIComponent(title + ' ' + description)}`;
                    window.open(weiboUrl, '_blank');
                    break;
            }
        }
        
        // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
        function fallbackCopyText(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('ğŸ‰ é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            } catch (err) {
                alert('ğŸ“‹ è¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥ï¼š\n' + text);
            }
            
            document.body.removeChild(textArea);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('å°é¬¼æ¶ˆæ¶ˆä¹æ¸¸æˆå·²åŠ è½½å®Œæˆï¼');
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                if (e.key === 'r' || e.key === 'R') {
                    if (game && game.isGameActive) {
                        restartGame();
                    }
                } else if (e.key === 'h' || e.key === 'H') {
                    if (game && game.isGameActive) {
                        showHint();
                    }
                } else if (e.key === ' ') {
                    e.preventDefault();
                    if (game && game.isGameActive) {
                        pauseGame();
                    }
                }
            });
        });
    </script>
</body>
</html>