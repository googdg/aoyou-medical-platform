<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°é¬¼æ¶ˆæ¶ˆä¹ - Little Ghost Match-3</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/ghost-match3.css">
    <meta name="description" content="å°é¬¼æ¶ˆæ¶ˆä¹ - æœ‰è¶£çš„ä¸‰æ¶ˆç›Šæ™ºæ¸¸æˆï¼ŒæŒ‘æˆ˜ä½ çš„ç­–ç•¥æ€ç»´">
    <meta name="keywords" content="æ¶ˆæ¶ˆä¹,ä¸‰æ¶ˆæ¸¸æˆ,ç›Šæ™ºæ¸¸æˆ,å°é¬¼,puzzle game">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="index.html">Stevn's Blog</a>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">é¦–é¡µ</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="loadContent('blog')">åšå®¢</a>
                </li>
                <li class="nav-item active">
                    <a href="ghost-match3.html" class="nav-link">å°é¬¼æ¶ˆæ¶ˆä¹</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="loadContent('about')">å…³äº</a>
                </li>
            </ul>
            <div class="nav-toggle" id="mobile-menu">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <div class="container">
            <!-- æ¸¸æˆæ ‡é¢˜ -->
            <header class="game-header-section">
                <h1 class="game-title">å°é¬¼æ¶ˆæ¶ˆä¹</h1>
                <p class="game-subtitle">Little Ghost Match-3 Puzzle Game</p>
                <p class="game-description">
                    æ¬¢è¿æ¥åˆ°å°é¬¼æ¶ˆæ¶ˆä¹ï¼è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„ä¸‰æ¶ˆç›Šæ™ºæ¸¸æˆï¼Œä½ éœ€è¦é€šè¿‡äº¤æ¢ç›¸é‚»çš„å°é¬¼æ¥åˆ›é€ ä¸‰ä¸ªæˆ–æ›´å¤šç›¸åŒå°é¬¼çš„è¿çº¿ã€‚
                    æŒ‘æˆ˜ä½ çš„ç­–ç•¥æ€ç»´ï¼Œè·å¾—æ›´é«˜çš„åˆ†æ•°ï¼
                </p>
            </header>

            <!-- æ¸¸æˆå®¹å™¨ -->
            <div class="game-container" id="game-container">
                <!-- æ¸¸æˆå°†åœ¨è¿™é‡ŒåŠ è½½ -->
                <div class="game-loading">
                    <div class="loading-spinner"></div>
                    <p>æ­£åœ¨åŠ è½½æ¸¸æˆ...</p>
                </div>
            </div>

            <!-- æ¸¸æˆè¯´æ˜ -->
            <section class="game-instructions">
                <h2>æ¸¸æˆè¯´æ˜</h2>
                <div class="instructions-grid">
                    <div class="instruction-item">
                        <div class="instruction-icon">ğŸ¯</div>
                        <h3>æ¸¸æˆç›®æ ‡</h3>
                        <p>é€šè¿‡äº¤æ¢ç›¸é‚»çš„å°é¬¼ï¼Œåˆ›é€ ä¸‰ä¸ªæˆ–æ›´å¤šç›¸åŒå°é¬¼çš„è¿çº¿æ¥æ¶ˆé™¤å®ƒä»¬å¹¶è·å¾—åˆ†æ•°ã€‚</p>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-icon">ğŸ®</div>
                        <h3>æ“ä½œæ–¹å¼</h3>
                        <p>ç‚¹å‡»ä¸€ä¸ªå°é¬¼ï¼Œç„¶åç‚¹å‡»ç›¸é‚»çš„å°é¬¼æ¥äº¤æ¢å®ƒä»¬çš„ä½ç½®ã€‚åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¯ä»¥æ»‘åŠ¨æ“ä½œã€‚</p>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-icon">â­</div>
                        <h3>ç‰¹æ®Šé“å…·</h3>
                        <p>åŒ¹é…4ä¸ªæˆ–æ›´å¤šå°é¬¼å¯ä»¥åˆ›é€ ç‰¹æ®Šé“å…·ï¼Œå®ƒä»¬æœ‰å¼ºå¤§çš„æ¶ˆé™¤æ•ˆæœã€‚</p>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-icon">ğŸ†</div>
                        <h3>å…³å¡è¿›åº¦</h3>
                        <p>è¾¾åˆ°ç›®æ ‡åˆ†æ•°å³å¯å®Œæˆå…³å¡ï¼Œæ¯ä¸ªå…³å¡éƒ½æœ‰ç§»åŠ¨æ¬¡æ•°é™åˆ¶ã€‚</p>
                    </div>
                </div>
            </section>

            <!-- æ¸¸æˆç»Ÿè®¡ -->
            <section class="game-stats" id="game-stats" style="display: none;">
                <h2>æ¸¸æˆç»Ÿè®¡</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">æœ€é«˜åˆ†æ•°</span>
                        <span class="stat-value" id="high-score">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æ¸¸æˆæ¬¡æ•°</span>
                        <span class="stat-value" id="games-played">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æœ€é«˜å…³å¡</span>
                        <span class="stat-value" id="highest-level">1</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æ€»æ¶ˆé™¤æ•°</span>
                        <span class="stat-value" id="total-matches">0</span>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Stevn's Blog. å°é¬¼æ¶ˆæ¶ˆä¹æ¸¸æˆ - å¯“æ•™äºä¹ï¼ŒæŒ‘æˆ˜æ™ºæ…§ã€‚</p>
        </div>
    </footer>

    <!-- JavaScript æ–‡ä»¶ -->
    <script src="js/api-client.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/content-loader.js"></script>
    <script src="js/performance-optimizer.js"></script>
    <script src="js/accessibility-enhancer.js"></script>
    
    <!-- æ¸¸æˆç›¸å…³ JavaScript -->
    <script src="js/grid-manager.js"></script>
    <script src="js/ghost-manager.js"></script>
    <script src="js/ghost-match3-engine.js"></script>
    
    <!-- æ¸¸æˆåˆå§‹åŒ–è„šæœ¬ -->
    <script>
        // æ¸¸æˆåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('å°é¬¼æ¶ˆæ¶ˆä¹é¡µé¢åŠ è½½å®Œæˆ');
            
            // åˆå§‹åŒ–å¯¼èˆª
            if (typeof initializeNavigation === 'function') {
                initializeNavigation();
            }
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initializeGame();
            
            // åŠ è½½æ¸¸æˆç»Ÿè®¡
            loadGameStats();
        });
        
        let gameEngine = null;
        
        /**
         * åˆå§‹åŒ–æ¸¸æˆ
         */
        function initializeGame() {
            const gameContainer = document.getElementById('game-container');
            
            if (!gameContainer) {
                console.error('æ¸¸æˆå®¹å™¨æœªæ‰¾åˆ°');
                return;
            }
            
            try {
                // åˆ›å»ºæ¸¸æˆå¼•æ“å®ä¾‹
                gameEngine = new GhostMatch3Engine(gameContainer, {
                    gridSize: { width: 8, height: 8 },
                    ghostTypes: 6
                });
                
                // ç›‘å¬æ¸¸æˆäº‹ä»¶
                gameEngine.on('engineInitialized', () => {
                    console.log('æ¸¸æˆå¼•æ“åˆå§‹åŒ–å®Œæˆ');
                    hideLoadingScreen();
                    showGameStats();
                });
                
                gameEngine.on('gameStarted', () => {
                    console.log('æ¸¸æˆå¼€å§‹');
                });
                
                gameEngine.on('gameEnded', (data) => {
                    console.log('æ¸¸æˆç»“æŸ', data);
                    updateGameStats(data);
                });
                
                gameEngine.on('levelCompleted', (data) => {
                    console.log('å…³å¡å®Œæˆ', data);
                });
                
                gameEngine.on('gameError', (error) => {
                    console.error('æ¸¸æˆé”™è¯¯', error);
                    showErrorMessage('æ¸¸æˆå‘ç”Ÿé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                });
                
            } catch (error) {
                console.error('æ¸¸æˆåˆå§‹åŒ–å¤±è´¥:', error);
                showErrorMessage('æ¸¸æˆåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        }
        
        /**
         * éšè—åŠ è½½å±å¹•
         */
        function hideLoadingScreen() {
            const loadingElement = document.querySelector('.game-loading');
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
        }
        
        /**
         * æ˜¾ç¤ºæ¸¸æˆç»Ÿè®¡
         */
        function showGameStats() {
            const statsElement = document.getElementById('game-stats');
            if (statsElement) {
                statsElement.style.display = 'block';
            }
        }
        
        /**
         * åŠ è½½æ¸¸æˆç»Ÿè®¡
         */
        function loadGameStats() {
            try {
                const stats = JSON.parse(localStorage.getItem('ghostMatch3_stats') || '{}');
                
                document.getElementById('high-score').textContent = stats.highScore || 0;
                document.getElementById('games-played').textContent = stats.gamesPlayed || 0;
                document.getElementById('highest-level').textContent = stats.highestLevel || 1;
                document.getElementById('total-matches').textContent = stats.totalMatches || 0;
                
            } catch (error) {
                console.error('åŠ è½½æ¸¸æˆç»Ÿè®¡å¤±è´¥:', error);
            }
        }
        
        /**
         * æ›´æ–°æ¸¸æˆç»Ÿè®¡
         */
        function updateGameStats(gameData) {
            try {
                const stats = JSON.parse(localStorage.getItem('ghostMatch3_stats') || '{}');
                
                stats.gamesPlayed = (stats.gamesPlayed || 0) + 1;
                stats.highScore = Math.max(stats.highScore || 0, gameData.score || 0);
                stats.highestLevel = Math.max(stats.highestLevel || 1, gameEngine.level || 1);
                
                localStorage.setItem('ghostMatch3_stats', JSON.stringify(stats));
                loadGameStats();
                
            } catch (error) {
                console.error('æ›´æ–°æ¸¸æˆç»Ÿè®¡å¤±è´¥:', error);
            }
        }
        
        /**
         * æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
         */
        function showErrorMessage(message) {
            const gameContainer = document.getElementById('game-container');
            if (gameContainer) {
                gameContainer.innerHTML = `
                    <div class="game-error">
                        <div class="error-icon">âš ï¸</div>
                        <h3>æ¸¸æˆåŠ è½½å¤±è´¥</h3>
                        <p>${message}</p>
                        <button onclick="location.reload()" class="retry-btn">é‡æ–°åŠ è½½</button>
                    </div>
                `;
            }
        }
        
        /**
         * å¼€å§‹æ–°æ¸¸æˆ
         */
        function startNewGame() {
            if (gameEngine) {
                gameEngine.startNewGame();
            }
        }
        
        /**
         * é‡æ–°å¼€å§‹æ¸¸æˆ
         */
        function restartGame() {
            if (gameEngine) {
                gameEngine.restartGame();
            }
        }
        
        // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
        window.addEventListener('beforeunload', function() {
            if (gameEngine) {
                gameEngine.destroy();
            }
        });
    </script>
</body>
</html>