<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»„é‡‘çŸ¿å·¥å¢å¼ºç‰ˆ - Gold Miner Enhanced</title>
    <meta name="description" content="ç»å…¸é»„é‡‘çŸ¿å·¥æ¸¸æˆå¢å¼ºç‰ˆ - æ›´å¤šå®ç‰©ï¼Œæ›´å¤šæŒ‘æˆ˜ï¼">
    
    <!-- ç¤¾äº¤åª’ä½“åˆ†äº«ä¼˜åŒ– -->
    <meta property="og:title" content="é»„é‡‘çŸ¿å·¥å¢å¼ºç‰ˆ - Gold Miner Enhanced">
    <meta property="og:description" content="ç»å…¸é»„é‡‘çŸ¿å·¥æ¸¸æˆå¢å¼ºç‰ˆï¼ŒæŒ–æ˜é»„é‡‘èµšå–è´¢å¯Œï¼">
    <meta property="og:type" content="website">
    
    <!-- PWAæ”¯æŒ -->
    <meta name="theme-color" content="#FFD700">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="é»„é‡‘çŸ¿å·¥">
    
    <!-- å›¾æ ‡ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>â›ï¸</text></svg>">
    
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(180deg, #87CEEB 0%, #DEB887 50%, #8B4513 100%);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        .game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* æ¸¸æˆç•Œé¢ */
        .game-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .score-info {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 2px;
        }

        .info-value {
            font-size: 18px;
            font-weight: bold;
            color: #FFD700;
        }

        .game-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .control-btn.start {
            background: linear-gradient(135deg, #27AE60 0%, #229954 100%);
        }

        .control-btn.audio {
            background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
            font-size: 12px;
            padding: 6px 12px;
        }

        .control-btn.audio.muted {
            background: linear-gradient(135deg, #95A5A6 0%, #7F8C8D 100%);
        }

        /* æ¸¸æˆç”»å¸ƒ */
        .game-canvas {
            position: absolute;
            top: 100px;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, #87CEEB 0%, #DEB887 30%, #8B4513 100%);
        }

        /* çŸ¿å·¥è§’è‰² */
        .miner {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            z-index: 50;
        }

        .miner::before {
            content: 'ğŸ‘¨â€ğŸ­';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 60px;
        }

        /* é’©å­å’Œç»³å­ */
        .hook-system {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 40;
        }

        .rope {
            width: 4px;
            background: linear-gradient(180deg, #8B4513 0%, #A0522D 100%);
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            transform-origin: top;
            transition: all 0.1s linear;
            box-shadow: 1px 0 2px rgba(0,0,0,0.3);
        }

        .hook {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 25px;
            height: 20px;
            background: linear-gradient(135deg, #C0C0C0 0%, #808080 100%);
            border-radius: 0 0 15px 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .hook::after {
            content: 'ğŸª';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
        }

        /* å®ç‰©æ ·å¼ */
        .treasure {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 30;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .treasure:hover {
            transform: scale(1.1);
        }

        .treasure.gold {
            background: radial-gradient(circle, #FFD700 0%, #FFA500 70%, #FF8C00 100%);
            border: 3px solid #B8860B;
        }

        .treasure.gold::before {
            content: 'ğŸ’°';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
        }

        .treasure.diamond {
            background: linear-gradient(45deg, #E0E0E0 0%, #FFFFFF 50%, #E0E0E0 100%);
            transform: rotate(45deg);
            border: 3px solid #C0C0C0;
        }

        .treasure.diamond::before {
            content: 'ğŸ’';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 20px;
        }

        .treasure.ruby {
            background: radial-gradient(circle, #DC143C 0%, #B22222 70%, #8B0000 100%);
            border: 3px solid #8B0000;
        }

        .treasure.ruby::before {
            content: 'ğŸ’';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
        }

        .treasure.rock {
            background: radial-gradient(circle, #696969 0%, #2F4F4F 70%, #1C1C1C 100%);
            border-radius: 40% 60% 60% 40%;
            border: 3px solid #2F2F2F;
        }

        .treasure.rock::before {
            content: 'ğŸª¨';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 28px;
        }

        .treasure.bomb {
            background: radial-gradient(circle, #2F2F2F 0%, #000000 100%);
            border: 3px solid #8B0000;
            animation: bombPulse 1s infinite;
        }

        .treasure.bomb::before {
            content: 'ğŸ’£';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
        }

        @keyframes bombPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* ç‰¹æ•ˆ */
        .explosion {
            position: absolute;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #FF4500 0%, #FF6347 50%, transparent 100%);
            border-radius: 50%;
            animation: explode 0.5s ease-out;
            z-index: 80;
            pointer-events: none;
        }

        @keyframes explode {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }

        /* æ¸¸æˆæ¶ˆæ¯ */
        .game-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px 50px;
            border-radius: 15px;
            text-align: center;
            z-index: 200;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .game-message h2 {
            margin-bottom: 15px;
            color: #FFD700;
            font-size: 24px;
        }

        .game-message p {
            margin-bottom: 20px;
            font-size: 16px;
            line-height: 1.5;
        }

        .game-message button {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .game-message button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        /* è¿›åº¦æ¡ */
        .progress-bar {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            height: 25px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700 0%, #FFA500 50%, #FF8C00 100%);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        /* åˆ†æ•°å¼¹å‡ºæ•ˆæœ */
        .score-popup {
            position: absolute;
            color: #FFD700;
            font-weight: bold;
            font-size: 20px;
            z-index: 90;
            pointer-events: none;
            animation: scoreFloat 1s ease-out forwards;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        @keyframes scoreFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.2); opacity: 0; }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-header {
                height: 80px;
                padding: 0 10px;
            }

            .score-info {
                gap: 15px;
            }

            .info-value {
                font-size: 16px;
            }

            .control-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            .miner {
                width: 60px;
                height: 60px;
            }

            .miner::before {
                font-size: 40px;
            }

            .game-message {
                padding: 20px 30px;
                margin: 0 20px;
            }

            .game-message h2 {
                font-size: 20px;
            }

            .game-message p {
                font-size: 14px;
            }
        }
    </style>
</head><body>
 
   <div class="game-container">
        <!-- æ¸¸æˆå¤´éƒ¨ -->
        <div class="game-header">
            <div class="score-info">
                <div class="info-item">
                    <div class="info-label">åˆ†æ•°</div>
                    <div class="info-value" id="score">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ç›®æ ‡</div>
                    <div class="info-value" id="target">1000</div>
                </div>
                <div class="info-item">
                    <div class="info-label">å…³å¡</div>
                    <div class="info-value" id="level">1</div>
                </div>
                <div class="info-item">
                    <div class="info-label">æ—¶é—´</div>
                    <div class="info-value" id="time">60</div>
                </div>
                <div class="info-item">
                    <div class="info-label">è¿å‡»</div>
                    <div class="info-value" id="combo">0</div>
                </div>
            </div>
            <div class="game-controls">
                <button class="control-btn start" id="start-btn" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
                <button class="control-btn" id="pause-btn" onclick="pauseGame()" disabled>æš‚åœ</button>
                <button class="control-btn" onclick="restartGame()">é‡æ–°å¼€å§‹</button>
                <button class="control-btn audio" id="audio-btn" onclick="toggleAudio()">ğŸ”Š éŸ³æ•ˆ</button>
            </div>
        </div>

        <!-- æ¸¸æˆç”»å¸ƒ -->
        <div class="game-canvas" id="game-canvas">
            <!-- çŸ¿å·¥ -->
            <div class="miner" id="miner"></div>
            
            <!-- é’©å­ç³»ç»Ÿ -->
            <div class="hook-system" id="hook-system">
                <div class="rope" id="rope" style="height: 0px;"></div>
                <div class="hook" id="hook"></div>
            </div>
        </div>

        <!-- è¿›åº¦æ¡ -->
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
            <div class="progress-text" id="progress-text">0 / 1000</div>
        </div>

        <!-- æ¸¸æˆæ¶ˆæ¯ -->
        <div class="game-message" id="game-message">
            <h2 id="message-title">é»„é‡‘çŸ¿å·¥å¢å¼ºç‰ˆ</h2>
            <p id="message-content">ç‚¹å‡»å±å¹•æˆ–æŒ‰ç©ºæ ¼é”®å‘å°„é’©å­æŒ–æ˜å®ç‰©ï¼<br>å°å¿ƒç‚¸å¼¹ğŸ’£ï¼ŒæŠ“åˆ°ä¼šæ‰£åˆ†ï¼</p>
            <button onclick="hideMessage()">å¼€å§‹æŒ–çŸ¿</button>
        </div>
    </div>

    <script>
        // éŸ³é¢‘ç®¡ç†ç³»ç»Ÿ
        class AudioManager {
            constructor() {
                this.audioContext = null;
                this.enabled = true;
                this.volume = 0.5;
                this.initAudioContext();
            }
            
            async initAudioContext() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (error) {
                    console.log('Web Audio API not supported');
                }
            }
            
            playTone(frequency, duration, volume = 0.5, type = 'sine') {
                if (!this.audioContext || !this.enabled) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume * this.volume, this.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            
            playHookLaunch() {
                this.playTone(400, 0.2, 0.3, 'square');
            }
            
            playTreasureGet(treasureType) {
                switch(treasureType) {
                    case 'gold':
                        this.playTone(800, 0.3, 0.5, 'triangle');
                        break;
                    case 'diamond':
                        this.playTone(1200, 0.4, 0.6, 'sine');
                        break;
                    case 'ruby':
                        this.playTone(1000, 0.35, 0.55, 'triangle');
                        break;
                    case 'rock':
                        this.playTone(200, 0.3, 0.4, 'sawtooth');
                        break;
                    case 'bomb':
                        this.playExplosion();
                        break;
                }
            }
            
            playExplosion() {
                // çˆ†ç‚¸éŸ³æ•ˆ
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        this.playTone(100 + Math.random() * 200, 0.1, 0.8, 'sawtooth');
                    }, i * 20);
                }
            }
            
            playLevelComplete() {
                const notes = [523.25, 659.25, 783.99, 1046.50];
                notes.forEach((freq, index) => {
                    setTimeout(() => {
                        this.playTone(freq, 0.4, 0.7, 'triangle');
                    }, index * 200);
                });
            }
            
            playGameOver() {
                const notes = [440, 392, 349.23, 293.66];
                notes.forEach((freq, index) => {
                    setTimeout(() => {
                        this.playTone(freq, 0.5, 0.6, 'sine');
                    }, index * 300);
                });
            }
            
            toggle() {
                this.enabled = !this.enabled;
                return this.enabled;
            }
        }

        // å¢å¼ºç‰ˆé»„é‡‘çŸ¿å·¥æ¸¸æˆç±»
        class EnhancedGoldMinerGame {
            constructor() {
                this.canvas = document.getElementById('game-canvas');
                this.hookSystem = document.getElementById('hook-system');
                this.rope = document.getElementById('rope');
                this.hook = document.getElementById('hook');
                
                // éŸ³é¢‘ç®¡ç†å™¨
                this.audioManager = new AudioManager();
                
                // æ¸¸æˆçŠ¶æ€
                this.isGameActive = false;
                this.isPaused = false;
                this.score = 0;
                this.level = 1;
                this.timeLeft = 60;
                this.target = 1000;
                this.combo = 0;
                this.maxCombo = 0;
                
                // é’©å­çŠ¶æ€
                this.hookAngle = 0;
                this.hookDirection = 1;
                this.hookLength = 0;
                this.maxHookLength = 500;
                this.hookSpeed = 3;
                this.isHookMoving = false;
                this.isHookReturning = false;
                this.caughtTreasure = null;
                
                // å®ç‰©æ•°ç»„
                this.treasures = [];
                this.treasureTypes = [
                    { type: 'gold', value: 100, weight: 1, size: 35, probability: 0.4 },
                    { type: 'diamond', value: 500, weight: 0.5, size: 30, probability: 0.15 },
                    { type: 'ruby', value: 300, weight: 0.7, size: 32, probability: 0.2 },
                    { type: 'rock', value: 10, weight: 4, size: 45, probability: 0.2 },
                    { type: 'bomb', value: -200, weight: 2, size: 38, probability: 0.05 }
                ];
                
                // å®šæ—¶å™¨
                this.gameTimer = null;
                this.comboTimer = null;
                
                this.initializeGame();
            }
            
            initializeGame() {
                this.generateTreasures();
                this.setupEventListeners();
                this.updateUI();
            }
            
            setupEventListeners() {
                // é”®ç›˜äº‹ä»¶
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && this.isGameActive && !this.isHookMoving) {
                        e.preventDefault();
                        this.launchHook();
                    }
                });
                
                // é¼ æ ‡/è§¦æ‘¸äº‹ä»¶
                this.canvas.addEventListener('click', () => {
                    if (this.isGameActive && !this.isHookMoving) {
                        this.launchHook();
                    }
                });
                
                // è§¦æ‘¸äº‹ä»¶
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (this.isGameActive && !this.isHookMoving) {
                        this.launchHook();
                    }
                });
            }
            
            generateTreasures() {
                this.treasures = [];
                const canvasRect = this.canvas.getBoundingClientRect();
                const canvasHeight = canvasRect.height;
                const canvasWidth = canvasRect.width;
                
                // ç”Ÿæˆä¸åŒç±»å‹çš„å®ç‰©
                const treasureCount = 20 + this.level * 3;
                
                for (let i = 0; i < treasureCount; i++) {
                    const treasureType = this.getRandomTreasureType();
                    const treasure = {
                        ...treasureType,
                        id: `treasure-${i}`,
                        x: Math.random() * (canvasWidth - treasureType.size),
                        y: 100 + Math.random() * (canvasHeight - 150),
                        element: null
                    };
                    
                    // ç¡®ä¿å®ç‰©ä¸é‡å 
                    let attempts = 0;
                    while (this.checkTreasureOverlap(treasure) && attempts < 10) {
                        treasure.x = Math.random() * (canvasWidth - treasureType.size);
                        treasure.y = 100 + Math.random() * (canvasHeight - 150);
                        attempts++;
                    }
                    
                    this.createTreasureElement(treasure);
                    this.treasures.push(treasure);
                }
            }
            
            getRandomTreasureType() {
                const random = Math.random();
                let cumulativeProbability = 0;
                
                for (let treasureType of this.treasureTypes) {
                    cumulativeProbability += treasureType.probability;
                    if (random <= cumulativeProbability) {
                        return { ...treasureType };
                    }
                }
                
                return { ...this.treasureTypes[0] };
            }
            
            checkTreasureOverlap(newTreasure) {
                for (let treasure of this.treasures) {
                    const dx = newTreasure.x - treasure.x;
                    const dy = newTreasure.y - treasure.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const minDistance = (newTreasure.size + treasure.size) / 2 + 10;
                    
                    if (distance < minDistance) {
                        return true;
                    }
                }
                return false;
            }
            
            createTreasureElement(treasure) {
                const element = document.createElement('div');
                element.className = `treasure ${treasure.type}`;
                element.id = treasure.id;
                element.style.left = treasure.x + 'px';
                element.style.top = treasure.y + 'px';
                element.style.width = treasure.size + 'px';
                element.style.height = treasure.size + 'px';
                
                this.canvas.appendChild(element);
                treasure.element = element;
            }
            
            startGame() {
                this.isGameActive = true;
                this.isPaused = false;
                this.timeLeft = 60;
                
                // æ¢å¤éŸ³é¢‘ä¸Šä¸‹æ–‡
                if (this.audioManager.audioContext && this.audioManager.audioContext.state === 'suspended') {
                    this.audioManager.audioContext.resume();
                }
                
                // å¼€å§‹é’©å­æ‘†åŠ¨
                this.startHookSwing();
                
                // å¼€å§‹è®¡æ—¶
                this.gameTimer = setInterval(() => {
                    if (!this.isPaused) {
                        this.timeLeft--;
                        this.updateUI();
                        
                        if (this.timeLeft <= 0) {
                            this.endGame();
                        }
                    }
                }, 1000);
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.getElementById('start-btn').disabled = true;
                document.getElementById('pause-btn').disabled = false;
            }
            
            startHookSwing() {
                const swing = () => {
                    if (!this.isGameActive || this.isPaused || this.isHookMoving) return;
                    
                    this.hookAngle += this.hookDirection * 2;
                    
                    if (this.hookAngle >= 60) {
                        this.hookDirection = -1;
                    } else if (this.hookAngle <= -60) {
                        this.hookDirection = 1;
                    }
                    
                    this.hookSystem.style.transform = `translateX(-50%) rotate(${this.hookAngle}deg)`;
                    
                    requestAnimationFrame(swing);
                };
                
                swing();
            }
            
            launchHook() {
                if (this.isHookMoving) return;
                
                this.isHookMoving = true;
                this.isHookReturning = false;
                this.hookLength = 0;
                
                this.audioManager.playHookLaunch();
                
                const extendHook = () => {
                    if (!this.isGameActive || this.isPaused) return;
                    
                    if (!this.isHookReturning) {
                        this.hookLength += this.hookSpeed;
                        
                        // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°æœ€å¤§é•¿åº¦æˆ–ç¢°åˆ°å®ç‰©
                        if (this.hookLength >= this.maxHookLength || this.checkTreasureCollision()) {
                            this.isHookReturning = true;
                        }
                    } else {
                        // é’©å­è¿”å›
                        const returnSpeed = this.caughtTreasure ? 
                            Math.max(this.hookSpeed / this.caughtTreasure.weight, 0.5) : this.hookSpeed * 2;
                        
                        this.hookLength -= returnSpeed;
                        
                        if (this.hookLength <= 0) {
                            this.hookLength = 0;
                            this.isHookMoving = false;
                            this.isHookReturning = false;
                            
                            // å¦‚æœæŠ“åˆ°å®ç‰©ï¼Œå¤„ç†å¾—åˆ†
                            if (this.caughtTreasure) {
                                this.processTreasure(this.caughtTreasure);
                                this.caughtTreasure = null;
                            }
                            
                            return;
                        }
                    }
                    
                    // æ›´æ–°é’©å­ä½ç½®
                    this.rope.style.height = this.hookLength + 'px';
                    
                    // å¦‚æœæŠ“åˆ°å®ç‰©ï¼Œç§»åŠ¨å®ç‰©
                    if (this.caughtTreasure) {
                        const hookRect = this.hook.getBoundingClientRect();
                        const canvasRect = this.canvas.getBoundingClientRect();
                        
                        this.caughtTreasure.element.style.left = 
                            (hookRect.left - canvasRect.left - this.caughtTreasure.size / 2) + 'px';
                        this.caughtTreasure.element.style.top = 
                            (hookRect.bottom - canvasRect.top) + 'px';
                    }
                    
                    requestAnimationFrame(extendHook);
                };
                
                extendHook();
            }
            
            checkTreasureCollision() {
                const hookRect = this.hook.getBoundingClientRect();
                const canvasRect = this.canvas.getBoundingClientRect();
                
                for (let treasure of this.treasures) {
                    if (!treasure.element) continue;
                    
                    const treasureRect = treasure.element.getBoundingClientRect();
                    
                    // ç¢°æ’æ£€æµ‹
                    if (hookRect.left < treasureRect.right &&
                        hookRect.right > treasureRect.left &&
                        hookRect.top < treasureRect.bottom &&
                        hookRect.bottom > treasureRect.top) {
                        
                        this.caughtTreasure = treasure;
                        treasure.element.style.zIndex = '60';
                        return true;
                    }
                }
                
                return false;
            }
            
            processTreasure(treasure) {
                const scoreGain = treasure.value;
                
                if (treasure.type === 'bomb') {
                    // ç‚¸å¼¹æ•ˆæœ
                    this.createExplosion(treasure.x, treasure.y);
                    this.combo = 0; // é‡ç½®è¿å‡»
                    this.audioManager.playTreasureGet('bomb');
                } else {
                    // æ­£å¸¸å®ç‰©
                    this.combo++;
                    this.audioManager.playTreasureGet(treasure.type);
                    
                    // è¿å‡»åŠ æˆ
                    const comboBonus = Math.floor(this.combo / 3) * 50;
                    const finalScore = scoreGain + comboBonus;
                    
                    this.showScorePopup(finalScore, treasure.x, treasure.y);
                    this.score += finalScore;
                    
                    // é‡ç½®è¿å‡»è®¡æ—¶å™¨
                    if (this.comboTimer) {
                        clearTimeout(this.comboTimer);
                    }
                    this.comboTimer = setTimeout(() => {
                        this.combo = 0;
                        this.updateUI();
                    }, 3000);
                }
                
                this.score += scoreGain;
                this.maxCombo = Math.max(this.maxCombo, this.combo);
                this.removeTreasure(treasure);
                this.updateUI();
                this.checkLevelComplete();
            }
            
            createExplosion(x, y) {
                const explosion = document.createElement('div');
                explosion.className = 'explosion';
                explosion.style.left = (x - 50) + 'px';
                explosion.style.top = (y - 50) + 'px';
                
                this.canvas.appendChild(explosion);
                
                setTimeout(() => {
                    explosion.remove();
                }, 500);
            }
            
            showScorePopup(score, x, y) {
                const popup = document.createElement('div');
                popup.className = 'score-popup';
                popup.textContent = `+${score}`;
                popup.style.left = x + 'px';
                popup.style.top = y + 'px';
                
                this.canvas.appendChild(popup);
                
                setTimeout(() => {
                    popup.remove();
                }, 1000);
            }
            
            removeTreasure(treasure) {
                if (treasure.element) {
                    treasure.element.remove();
                    treasure.element = null;
                }
                
                const index = this.treasures.indexOf(treasure);
                if (index > -1) {
                    this.treasures.splice(index, 1);
                }
            }
            
            checkLevelComplete() {
                if (this.score >= this.target) {
                    this.nextLevel();
                }
            }
            
            nextLevel() {
                this.level++;
                this.target = this.level * 1000;
                this.timeLeft += 40; // é¢å¤–æ—¶é—´
                
                this.audioManager.playLevelComplete();
                
                // æ¸…é™¤ç°æœ‰å®ç‰©
                this.treasures.forEach(treasure => {
                    if (treasure.element) {
                        treasure.element.remove();
                    }
                });
                
                // ç”Ÿæˆæ–°å®ç‰©
                this.generateTreasures();
                this.updateUI();
                
                this.showMessage(`æ­å–œï¼è¿›å…¥ç¬¬${this.level}å…³ï¼`, 
                    `ç›®æ ‡åˆ†æ•°ï¼š${this.target}åˆ†\næœ€å¤§è¿å‡»ï¼š${this.maxCombo}\né¢å¤–æ—¶é—´ï¼š+40ç§’`);
            }
            
            pauseGame() {
                this.isPaused = !this.isPaused;
                const pauseBtn = document.getElementById('pause-btn');
                pauseBtn.textContent = this.isPaused ? 'ç»§ç»­' : 'æš‚åœ';
                
                if (this.isPaused) {
                    this.showMessage('æ¸¸æˆæš‚åœ', 'ç‚¹å‡»ç»§ç»­æŒ‰é’®æ¢å¤æ¸¸æˆ');
                }
            }
            
            restartGame() {
                this.endGame();
                this.score = 0;
                this.level = 1;
                this.target = 1000;
                this.timeLeft = 60;
                this.combo = 0;
                this.maxCombo = 0;
                
                // æ¸…é™¤æ‰€æœ‰å®ç‰©
                this.treasures.forEach(treasure => {
                    if (treasure.element) {
                        treasure.element.remove();
                    }
                });
                
                // é‡ç½®é’©å­
                this.hookLength = 0;
                this.hookAngle = 0;
                this.isHookMoving = false;
                this.isHookReturning = false;
                this.caughtTreasure = null;
                this.rope.style.height = '0px';
                this.hookSystem.style.transform = 'translateX(-50%) rotate(0deg)';
                
                // é‡æ–°ç”Ÿæˆå®ç‰©
                this.generateTreasures();
                this.updateUI();
                
                // é‡ç½®æŒ‰é’®çŠ¶æ€
                document.getElementById('start-btn').disabled = false;
                document.getElementById('pause-btn').disabled = true;
                document.getElementById('pause-btn').textContent = 'æš‚åœ';
            }
            
            endGame() {
                this.isGameActive = false;
                
                if (this.gameTimer) {
                    clearInterval(this.gameTimer);
                    this.gameTimer = null;
                }
                
                if (this.comboTimer) {
                    clearTimeout(this.comboTimer);
                    this.comboTimer = null;
                }
                
                // é‡ç½®æŒ‰é’®çŠ¶æ€
                document.getElementById('start-btn').disabled = false;
                document.getElementById('pause-btn').disabled = true;
                
                const message = this.score >= this.target ? 'æ­å–œé€šå…³ï¼' : 'æ—¶é—´åˆ°ï¼';
                const content = `æœ€ç»ˆåˆ†æ•°ï¼š${this.score}åˆ†\næœ€å¤§è¿å‡»ï¼š${this.maxCombo}\nåˆ°è¾¾å…³å¡ï¼š${this.level}`;
                
                if (this.score < this.target) {
                    this.audioManager.playGameOver();
                }
                
                this.showMessage(message, content);
            }
            
            updateUI() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('target').textContent = this.target;
                document.getElementById('level').textContent = this.level;
                document.getElementById('time').textContent = this.timeLeft;
                document.getElementById('combo').textContent = this.combo;
                
                // æ›´æ–°è¿›åº¦æ¡
                const progress = Math.min((this.score / this.target) * 100, 100);
                document.getElementById('progress-fill').style.width = progress + '%';
                document.getElementById('progress-text').textContent = `${this.score} / ${this.target}`;
            }
            
            showMessage(title, content) {
                document.getElementById('message-title').textContent = title;
                document.getElementById('message-content').innerHTML = content.replace(/\n/g, '<br>');
                document.getElementById('game-message').style.display = 'block';
            }
            
            toggleAudio() {
                const isEnabled = this.audioManager.toggle();
                const audioBtn = document.getElementById('audio-btn');
                
                if (isEnabled) {
                    audioBtn.textContent = 'ğŸ”Š éŸ³æ•ˆ';
                    audioBtn.classList.remove('muted');
                } else {
                    audioBtn.textContent = 'ğŸ”‡ éŸ³æ•ˆ';
                    audioBtn.classList.add('muted');
                }
            }
        }

        // å…¨å±€æ¸¸æˆå®ä¾‹
        let game = null;

        // æ¸¸æˆæ§åˆ¶å‡½æ•°
        function startGame() {
            if (!game) {
                game = new EnhancedGoldMinerGame();
            }
            game.startGame();
        }

        function pauseGame() {
            if (game) {
                game.pauseGame();
            }
        }

        function restartGame() {
            if (game) {
                game.restartGame();
            }
        }

        function toggleAudio() {
            if (game) {
                game.toggleAudio();
            }
        }

        function hideMessage() {
            document.getElementById('game-message').style.display = 'none';
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é»„é‡‘çŸ¿å·¥å¢å¼ºç‰ˆæ¸¸æˆå·²åŠ è½½å®Œæˆï¼');
            
            // æ˜¾ç¤ºåˆå§‹æ¶ˆæ¯
            setTimeout(() => {
                document.getElementById('game-message').style.display = 'block';
            }, 500);
        });

        // é˜²æ­¢é¡µé¢æ»šåŠ¨
        document.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });

        // é˜²æ­¢åŒå‡»ç¼©æ”¾
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        });

        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>