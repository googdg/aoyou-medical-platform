<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»„é‡‘çŸ¿å·¥å¤§å¸ˆç‰ˆ - Gold Miner Master</title>
    <meta name="description" content="ä¸“ä¸šçº§é»„é‡‘çŸ¿å·¥æ¸¸æˆ - æ›´å¥½ç©ï¼Œæ›´æ˜“ä¸Šæ‰‹ï¼Œæ›´æœ‰æŒ‘æˆ˜æ€§ï¼">
    
    <!-- ç¤¾äº¤åª’ä½“åˆ†äº«ä¼˜åŒ– -->
    <meta property="og:title" content="é»„é‡‘çŸ¿å·¥å¤§å¸ˆç‰ˆ - æœ€å¥½ç©çš„æŒ–çŸ¿æ¸¸æˆ">
    <meta property="og:description" content="ä¸“ä¸šçº§é»„é‡‘çŸ¿å·¥æ¸¸æˆï¼Œç®€å•æ˜“ä¸Šæ‰‹ï¼Œè¶£å‘³æ€§åè¶³ï¼">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://via.placeholder.com/1200x630/FFD700/000000?text=é»„é‡‘çŸ¿å·¥å¤§å¸ˆç‰ˆ">
    
    <!-- PWAæ”¯æŒ -->
    <meta name="theme-color" content="#FFD700">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="é»„é‡‘çŸ¿å·¥">
    
    <!-- å›¾æ ‡ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>â›ï¸</text></svg>">
    
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(180deg, #87CEEB 0%, #DEB887 40%, #CD853F 70%, #8B4513 100%);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
            user-select: none;
        }

        /* äº‘æœµè£…é¥° */
        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50px;
            opacity: 0.7;
            animation: cloudFloat 20s infinite linear;
        }

        .cloud::before, .cloud::after {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50px;
        }

        .cloud1 {
            width: 80px;
            height: 30px;
            top: 20%;
            left: -100px;
        }

        .cloud1::before {
            width: 50px;
            height: 50px;
            top: -25px;
            left: 10px;
        }

        .cloud1::after {
            width: 60px;
            height: 40px;
            top: -15px;
            right: 10px;
        }

        @keyframes cloudFloat {
            0% { transform: translateX(-100px); }
            100% { transform: translateX(calc(100vw + 100px)); }
        }

        .game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* æ¸¸æˆç•Œé¢ */
        .game-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 120px;
            background: linear-gradient(135deg, #2C3E50 0%, #34495E 50%, #2C3E50 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border-bottom: 3px solid #FFD700;
        }

        .score-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            align-items: center;
        }

        .info-item {
            text-align: center;
            background: rgba(255, 215, 0, 0.1);
            padding: 8px 12px;
            border-radius: 10px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .info-label {
            font-size: 11px;
            opacity: 0.9;
            margin-bottom: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            font-size: 18px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .game-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-row {
            display: flex;
            gap: 8px;
        }

        .control-btn {
            background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .control-btn.start {
            background: linear-gradient(135deg, #27AE60 0%, #229954 100%);
        }

        .control-btn.audio {
            background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
            font-size: 10px;
            padding: 6px 12px;
        }

        .control-btn.audio.muted {
            background: linear-gradient(135deg, #95A5A6 0%, #7F8C8D 100%);
        }

        /* æ¸¸æˆç”»å¸ƒ */
        .game-canvas {
            position: absolute;
            top: 120px;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, #87CEEB 0%, #DEB887 30%, #CD853F 60%, #8B4513 100%);
            cursor: crosshair;
        }

        /* çŸ¿å·¥è§’è‰² */
        .miner {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 100px;
            z-index: 50;
            transition: all 0.3s ease;
        }

        .miner-body {
            position: relative;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #8B4513 0%, #A0522D 100%);
            border-radius: 50% 50% 0 0;
            border: 3px solid #654321;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .miner-face {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 50px;
            animation: minerBlink 3s infinite;
        }

        @keyframes minerBlink {
            0%, 90%, 100% { content: 'ğŸ‘¨â€ğŸ­'; }
            95% { content: 'ğŸ˜Š'; }
        }

        .miner-face::before {
            content: 'ğŸ‘¨â€ğŸ­';
        }

        .miner.working .miner-face::before {
            content: 'ğŸ˜¤';
        }

        .miner.happy .miner-face::before {
            content: 'ğŸ˜„';
        }

        /* é’©å­å’Œç»³å­ç³»ç»Ÿ */
        .hook-system {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 40;
            transition: transform 0.1s ease-out;
        }

        .rope {
            width: 6px;
            background: linear-gradient(180deg, #8B4513 0%, #A0522D 50%, #654321 100%);
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            transform-origin: top;
            transition: all 0.1s linear;
            box-shadow: 2px 0 4px rgba(0,0,0,0.3);
            border-radius: 3px;
        }

        .hook {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 25px;
            background: linear-gradient(135deg, #C0C0C0 0%, #808080 50%, #696969 100%);
            border-radius: 0 0 20px 20px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.4);
            border: 2px solid #555;
        }

        .hook::after {
            content: 'ğŸª';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }

        /* ç„å‡†çº¿ */
        .aim-line {
            position: absolute;
            top: 120px;
            left: 50%;
            width: 2px;
            height: 0;
            background: rgba(255, 0, 0, 0.5);
            transform-origin: top;
            z-index: 35;
            transition: opacity 0.3s ease;
            opacity: 0;
        }

        .aim-line.visible {
            opacity: 1;
        }

        /* å®ç‰©æ ·å¼ */
        .treasure {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 30;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            animation: treasureGlow 2s ease-in-out infinite alternate;
        }

        @keyframes treasureGlow {
            0% { filter: brightness(1) drop-shadow(0 0 5px rgba(255,215,0,0.3)); }
            100% { filter: brightness(1.1) drop-shadow(0 0 15px rgba(255,215,0,0.6)); }
        }

        .treasure:hover {
            transform: scale(1.05);
            z-index: 31;
        }

        .treasure.gold {
            background: radial-gradient(circle, #FFD700 0%, #FFA500 70%, #FF8C00 100%);
            border: 3px solid #B8860B;
        }

        .treasure.gold::before {
            content: 'ğŸ’°';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 28px;
        }

        .treasure.diamond {
            background: linear-gradient(45deg, #E0E0E0 0%, #FFFFFF 50%, #E0E0E0 100%);
            border: 3px solid #C0C0C0;
            animation: diamondSparkle 1.5s ease-in-out infinite;
        }

        @keyframes diamondSparkle {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3) drop-shadow(0 0 10px rgba(255,255,255,0.8)); }
        }

        .treasure.diamond::before {
            content: 'ğŸ’';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
        }

        .treasure.ruby {
            background: radial-gradient(circle, #DC143C 0%, #B22222 70%, #8B0000 100%);
            border: 3px solid #8B0000;
        }

        .treasure.ruby::before {
            content: 'ğŸ’';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 22px;
        }

        .treasure.emerald {
            background: radial-gradient(circle, #50C878 0%, #228B22 70%, #006400 100%);
            border: 3px solid #006400;
        }

        .treasure.emerald::before {
            content: 'ğŸ’š';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 22px;
        }

        .treasure.rock {
            background: radial-gradient(circle, #696969 0%, #2F4F4F 70%, #1C1C1C 100%);
            border-radius: 40% 60% 60% 40%;
            border: 3px solid #2F2F2F;
            animation: none;
        }

        .treasure.rock::before {
            content: 'ğŸª¨';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
        }

        .treasure.mystery {
            background: linear-gradient(45deg, #9B59B6 0%, #8E44AD 50%, #7D3C98 100%);
            border: 3px solid #6C3483;
            animation: mysteryPulse 1s ease-in-out infinite;
        }

        @keyframes mysteryPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .treasure.mystery::before {
            content: 'ğŸ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 26px;
        }

        /* ç‰¹æ•ˆç³»ç»Ÿ */
        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 80;
        }

        .coin-particle {
            color: #FFD700;
            font-size: 16px;
            animation: coinFloat 1.5s ease-out forwards;
        }

        @keyframes coinFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-80px) scale(1.5); opacity: 0; }
        }

        .sparkle-particle {
            width: 4px;
            height: 4px;
            background: #FFD700;
            border-radius: 50%;
            animation: sparkleFloat 1s ease-out forwards;
        }

        @keyframes sparkleFloat {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0) translateY(-50px); opacity: 0; }
        }

        /* åˆ†æ•°å¼¹å‡ºæ•ˆæœ */
        .score-popup {
            position: absolute;
            color: #FFD700;
            font-weight: bold;
            font-size: 24px;
            z-index: 90;
            pointer-events: none;
            animation: scoreFloat 2s ease-out forwards;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            font-family: 'Arial Black', Arial, sans-serif;
        }

        @keyframes scoreFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            50% { transform: translateY(-30px) scale(1.2); opacity: 1; }
            100% { transform: translateY(-60px) scale(1); opacity: 0; }
        }

        .score-popup.bonus {
            color: #FF6B6B;
            animation: bonusFloat 2s ease-out forwards;
        }

        @keyframes bonusFloat {
            0% { transform: translateY(0) scale(1) rotate(0deg); opacity: 1; }
            50% { transform: translateY(-40px) scale(1.3) rotate(5deg); opacity: 1; }
            100% { transform: translateY(-80px) scale(1.1) rotate(10deg); opacity: 0; }
        }

        /* æ¸¸æˆæ¶ˆæ¯ç³»ç»Ÿ */
        .game-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(0,0,0,0.95) 0%, rgba(44,62,80,0.95) 100%);
            color: white;
            padding: 40px 60px;
            border-radius: 20px;
            text-align: center;
            z-index: 200;
            display: none;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 3px solid #FFD700;
            backdrop-filter: blur(10px);
        }

        .game-message h2 {
            margin-bottom: 20px;
            color: #FFD700;
            font-size: 28px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .game-message p {
            margin-bottom: 25px;
            font-size: 16px;
            line-height: 1.6;
            opacity: 0.9;
        }

        .message-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .message-btn {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(255,215,0,0.3);
        }

        .message-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(255,215,0,0.4);
        }

        .message-btn.secondary {
            background: linear-gradient(135deg, #95A5A6 0%, #7F8C8D 100%);
            color: white;
        }

        /* è¿›åº¦æ¡ç³»ç»Ÿ */
        .progress-container {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            z-index: 90;
        }

        .progress-bar {
            height: 30px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
            border: 2px solid rgba(255,215,0,0.3);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700 0%, #FFA500 50%, #FF8C00 100%);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(255,215,0,0.4);
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 1;
        }

        /* æç¤ºç³»ç»Ÿ */
        .game-tips {
            position: absolute;
            top: 140px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 14px;
            max-width: 250px;
            z-index: 95;
            opacity: 0;
            transform: translateX(20px);
            transition: all 0.3s ease;
        }

        .game-tips.visible {
            opacity: 1;
            transform: translateX(0);
        }

        .game-tips h4 {
            color: #FFD700;
            margin-bottom: 8px;
            font-size: 16px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-header {
                height: 100px;
                padding: 0 15px;
            }

            .score-info {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .info-value {
                font-size: 16px;
            }

            .control-btn {
                padding: 6px 12px;
                font-size: 11px;
            }

            .miner {
                width: 80px;
                height: 80px;
            }

            .miner-face {
                font-size: 40px;
            }

            .game-message {
                padding: 30px 40px;
                margin: 0 20px;
            }

            .game-message h2 {
                font-size: 24px;
            }

            .game-tips {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .score-info {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .control-row {
                flex-direction: column;
                gap: 6px;
            }

            .game-message {
                padding: 25px 30px;
            }

            .message-buttons {
                flex-direction: column;
            }
        }
    </style>
</head><bod
y>
    <div class="game-container">
        <!-- äº‘æœµè£…é¥° -->
        <div class="cloud cloud1"></div>
        
        <!-- æ¸¸æˆå¤´éƒ¨ -->
        <div class="game-header">
            <div class="score-info">
                <div class="info-item">
                    <div class="info-label">åˆ†æ•°</div>
                    <div class="info-value" id="score">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ç›®æ ‡</div>
                    <div class="info-value" id="target">800</div>
                </div>
                <div class="info-item">
                    <div class="info-label">å…³å¡</div>
                    <div class="info-value" id="level">1</div>
                </div>
                <div class="info-item">
                    <div class="info-label">æ—¶é—´</div>
                    <div class="info-value" id="time">90</div>
                </div>
                <div class="info-item">
                    <div class="info-label">è¿å‡»</div>
                    <div class="info-value" id="combo">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">åŠ›é‡</div>
                    <div class="info-value" id="power">100%</div>
                </div>
            </div>
            <div class="game-controls">
                <div class="control-row">
                    <button class="control-btn start" id="start-btn" onclick="startGame()">ğŸ® å¼€å§‹</button>
                    <button class="control-btn" id="pause-btn" onclick="pauseGame()" disabled>â¸ï¸ æš‚åœ</button>
                </div>
                <div class="control-row">
                    <button class="control-btn" onclick="restartGame()">ğŸ”„ é‡å¯</button>
                    <button class="control-btn audio" id="audio-btn" onclick="toggleAudio()">ğŸ”Š éŸ³æ•ˆ</button>
                    <button class="control-btn" onclick="showHelp()">â“ å¸®åŠ©</button>
                </div>
            </div>
        </div>

        <!-- æ¸¸æˆç”»å¸ƒ -->
        <div class="game-canvas" id="game-canvas">
            <!-- çŸ¿å·¥ -->
            <div class="miner" id="miner">
                <div class="miner-body">
                    <div class="miner-face"></div>
                </div>
            </div>
            
            <!-- ç„å‡†çº¿ -->
            <div class="aim-line" id="aim-line"></div>
            
            <!-- é’©å­ç³»ç»Ÿ -->
            <div class="hook-system" id="hook-system">
                <div class="rope" id="rope" style="height: 0px;"></div>
                <div class="hook" id="hook"></div>
            </div>
        </div>

        <!-- è¿›åº¦æ¡ -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
                <div class="progress-text" id="progress-text">0 / 800</div>
            </div>
        </div>

        <!-- æ¸¸æˆæç¤º -->
        <div class="game-tips" id="game-tips">
            <h4>ğŸ’¡ æ¸¸æˆæç¤º</h4>
            <p id="tip-content">ç‚¹å‡»å±å¹•å‘å°„é’©å­æŠ“å–å®ç‰©ï¼</p>
        </div>

        <!-- æ¸¸æˆæ¶ˆæ¯ -->
        <div class="game-message" id="game-message">
            <h2 id="message-title">ğŸ† é»„é‡‘çŸ¿å·¥å¤§å¸ˆç‰ˆ</h2>
            <p id="message-content">
                æ¬¢è¿æ¥åˆ°æœ€ä¸“ä¸šçš„æŒ–çŸ¿æ¸¸æˆï¼<br><br>
                ğŸ¯ <strong>ç®€å•æ“ä½œ</strong>ï¼šç‚¹å‡»å±å¹•å‘å°„é’©å­<br>
                ğŸ’° <strong>æ”¶é›†å®ç‰©</strong>ï¼šè¾¾åˆ°ç›®æ ‡åˆ†æ•°è¿‡å…³<br>
                âš¡ <strong>è¿å‡»ç³»ç»Ÿ</strong>ï¼šè¿ç»­æˆåŠŸè·å¾—é¢å¤–å¥–åŠ±<br>
                ğŸ <strong>ç¥ç§˜å®ç®±</strong>ï¼šéšæœºè·å¾—æƒŠå–œå¥–åŠ±<br>
                ğŸª¨ <strong>é¿å¼€çŸ³å¤´</strong>ï¼šå®ƒä»¬å¾ˆé‡ä½†ä»·å€¼å¾ˆä½
            </p>
            <div class="message-buttons">
                <button class="message-btn" onclick="hideMessage()">ğŸš€ å¼€å§‹æŒ–çŸ¿</button>
                <button class="message-btn secondary" onclick="showHelp()">ğŸ“– æŸ¥çœ‹å¸®åŠ©</button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€ç®¡ç†
        class GameState {
            constructor() {
                this.reset();
            }

            reset() {
                this.score = 0;
                this.level = 1;
                this.time = 90;
                this.target = 800;
                this.combo = 0;
                this.maxCombo = 0;
                this.power = 100;
                this.isPlaying = false;
                this.isPaused = false;
                this.treasures = [];
                this.hookState = 'idle'; // idle, extending, retracting, caught
                this.hookAngle = 0;
                this.hookSpeed = 4;
                this.hookLength = 0;
                this.maxHookLength = window.innerHeight - 200;
                this.caughtTreasure = null;
                this.lastCatchTime = 0;
                this.comboMultiplier = 1;
                this.totalTreasuresCollected = 0;
                this.clearTimer();
            }

            clearTimer() {
                if (this.gameTimer) {
                    clearInterval(this.gameTimer);
                    this.gameTimer = null;
                }
            }
        }

        // éŸ³é¢‘ç®¡ç†ç³»ç»Ÿ
        class AudioManager {
            constructor() {
                this.enabled = true;
                this.context = null;
                this.sounds = {};
                this.initAudio();
            }

            initAudio() {
                try {
                    this.context = new (window.AudioContext || window.webkitAudioContext)();
                    this.createSounds();
                } catch (e) {
                    console.log('éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥ï¼Œä½¿ç”¨é™éŸ³æ¨¡å¼');
                    this.enabled = false;
                }
            }

            createSounds() {
                this.sounds = {
                    hook: () => this.playTone(200, 0.1, 'sine'),
                    catch: () => this.playTone(400, 0.2, 'square'),
                    gold: () => this.playTone(600, 0.3, 'sine'),
                    diamond: () => this.playTone(800, 0.4, 'triangle'),
                    ruby: () => this.playTone(700, 0.3, 'sawtooth'),
                    emerald: () => this.playTone(650, 0.3, 'sine'),
                    rock: () => this.playTone(150, 0.5, 'square'),
                    mystery: () => this.playMysterySound(),
                    combo: () => this.playComboSound(),
                    levelUp: () => this.playLevelUpSound(),
                    gameOver: () => this.playTone(100, 1.5, 'square')
                };
            }

            playTone(frequency, duration, type = 'sine') {
                if (!this.enabled || !this.context) return;
                
                const oscillator = this.context.createOscillator();
                const gainNode = this.context.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.context.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0.1, this.context.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + duration);
                
                oscillator.start(this.context.currentTime);
                oscillator.stop(this.context.currentTime + duration);
            }

            playMysterySound() {
                if (!this.enabled) return;
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        this.playTone(500 + i * 200, 0.2, 'sine');
                    }, i * 100);
                }
            }

            playComboSound() {
                if (!this.enabled) return;
                this.playTone(800, 0.1, 'sine');
                setTimeout(() => this.playTone(1000, 0.1, 'sine'), 100);
                setTimeout(() => this.playTone(1200, 0.2, 'sine'), 200);
            }

            playLevelUpSound() {
                if (!this.enabled) return;
                const notes = [523, 659, 784, 1047]; // C, E, G, C
                notes.forEach((note, i) => {
                    setTimeout(() => this.playTone(note, 0.3, 'sine'), i * 150);
                });
            }

            play(soundName) {
                if (this.enabled && this.sounds[soundName]) {
                    this.sounds[soundName]();
                }
            }

            toggle() {
                this.enabled = !this.enabled;
                return this.enabled;
            }
        }

        // å®ç‰©ç®¡ç†ç³»ç»Ÿ
        class TreasureManager {
            constructor() {
                this.treasureTypes = {
                    gold: { value: 100, weight: 1, size: 40, rarity: 0.35, emoji: 'ğŸ’°' },
                    diamond: { value: 350, weight: 0.4, size: 35, rarity: 0.15, emoji: 'ğŸ’' },
                    ruby: { value: 200, weight: 0.6, size: 32, rarity: 0.2, emoji: 'ğŸ’' },
                    emerald: { value: 250, weight: 0.5, size: 32, rarity: 0.18, emoji: 'ğŸ’š' },
                    rock: { value: 15, weight: 2.5, size: 50, rarity: 0.25, emoji: 'ğŸª¨' },
                    mystery: { value: 500, weight: 0.3, size: 45, rarity: 0.07, emoji: 'ğŸ' }
                };
            }

            generateTreasures(level) {
                const treasures = [];
                const baseCount = 12;
                const count = Math.min(baseCount + level * 2, 22);
                const canvas = document.getElementById('game-canvas');
                const canvasRect = canvas.getBoundingClientRect();
                
                for (let i = 0; i < count; i++) {
                    const type = this.getRandomTreasureType(level);
                    const treasure = this.createTreasure(type, canvasRect, level);
                    
                    // ç¡®ä¿å®ç‰©ä¸é‡å 
                    let attempts = 0;
                    while (attempts < 50 && this.checkOverlap(treasure, treasures)) {
                        treasure.x = Math.random() * (canvasRect.width - treasure.size - 40) + 20;
                        treasure.y = Math.random() * (canvasRect.height - treasure.size - 120) + 160;
                        attempts++;
                    }
                    
                    treasures.push(treasure);
                }
                
                return treasures;
            }

            checkOverlap(newTreasure, existingTreasures) {
                for (let treasure of existingTreasures) {
                    const dx = newTreasure.x - treasure.x;
                    const dy = newTreasure.y - treasure.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const minDistance = (newTreasure.size + treasure.size) / 2 + 10;
                    
                    if (distance < minDistance) {
                        return true;
                    }
                }
                return false;
            }

            getRandomTreasureType(level) {
                const types = Object.keys(this.treasureTypes);
                const weights = types.map(type => {
                    let rarity = this.treasureTypes[type].rarity;
                    
                    // é«˜çº§å…³å¡è°ƒæ•´ç¨€æœ‰åº¦
                    if (type === 'diamond' || type === 'mystery') {
                        rarity += Math.min(level * 0.015, 0.1);
                    }
                    if (type === 'rock') {
                        rarity = Math.max(0.1, rarity - level * 0.02);
                    }
                    
                    return rarity;
                });
                
                const totalWeight = weights.reduce((sum, weight) => sum + weight, 0);
                let random = Math.random() * totalWeight;
                
                for (let i = 0; i < types.length; i++) {
                    random -= weights[i];
                    if (random <= 0) {
                        return types[i];
                    }
                }
                
                return 'gold';
            }

            createTreasure(type, canvasRect, level) {
                const config = this.treasureTypes[type];
                const levelBonus = Math.floor((level - 1) * 15);
                
                return {
                    id: Date.now() + Math.random(),
                    type: type,
                    value: config.value + levelBonus,
                    weight: config.weight,
                    size: config.size,
                    x: Math.random() * (canvasRect.width - config.size - 40) + 20,
                    y: Math.random() * (canvasRect.height - config.size - 120) + 160,
                    element: null,
                    emoji: config.emoji
                };
            }

            renderTreasure(treasure) {
                const element = document.createElement('div');
                element.className = `treasure ${treasure.type}`;
                element.style.left = treasure.x + 'px';
                element.style.top = treasure.y + 'px';
                element.style.width = treasure.size + 'px';
                element.style.height = treasure.size + 'px';
                element.dataset.treasureId = treasure.id;
                element.title = `${treasure.emoji} ${treasure.value}åˆ†`;
                
                treasure.element = element;
                document.getElementById('game-canvas').appendChild(element);
                
                return element;
            }
        }

        // é’©å­ç³»ç»Ÿ
        class HookSystem {
            constructor(gameState, audioManager) {
                this.gameState = gameState;
                this.audioManager = audioManager;
                this.hookElement = document.getElementById('hook-system');
                this.ropeElement = document.getElementById('rope');
                this.aimLineElement = document.getElementById('aim-line');
                this.minerElement = document.getElementById('miner');
                
                this.swingDirection = 1;
                this.swingSpeed = 1.8;
                this.minAngle = -65;
                this.maxAngle = 65;
                this.isSwinging = true;
            }

            update() {
                if (this.gameState.hookState === 'idle' && this.isSwinging) {
                    this.updateSwing();
                } else if (this.gameState.hookState === 'extending') {
                    this.extendHook();
                } else if (this.gameState.hookState === 'retracting') {
                    this.retractHook();
                }
            }

            updateSwing() {
                this.gameState.hookAngle += this.swingDirection * this.swingSpeed;
                
                if (this.gameState.hookAngle >= this.maxAngle) {
                    this.gameState.hookAngle = this.maxAngle;
                    this.swingDirection = -1;
                } else if (this.gameState.hookAngle <= this.minAngle) {
                    this.gameState.hookAngle = this.minAngle;
                    this.swingDirection = 1;
                }
                
                this.hookElement.style.transform = `translateX(-50%) rotate(${this.gameState.hookAngle}deg)`;
                this.updateAimLine();
            }

            updateAimLine() {
                const angle = this.gameState.hookAngle * Math.PI / 180;
                const length = 150;
                
                this.aimLineElement.style.height = length + 'px';
                this.aimLineElement.style.transform = `translateX(-50%) rotate(${this.gameState.hookAngle}deg)`;
                this.aimLineElement.classList.add('visible');
            }

            launch() {
                if (this.gameState.hookState !== 'idle') return;
                
                this.gameState.hookState = 'extending';
                this.gameState.hookLength = 0;
                this.isSwinging = false;
                
                this.audioManager.play('hook');
                this.aimLineElement.classList.remove('visible');
                this.minerElement.classList.add('working');
                
                // æ ¹æ®åŠ›é‡è°ƒæ•´é’©å­é€Ÿåº¦
                this.gameState.hookSpeed = 3 + (this.gameState.power / 100) * 2;
            }

            extendHook() {
                this.gameState.hookLength += this.gameState.hookSpeed;
                this.ropeElement.style.height = this.gameState.hookLength + 'px';
                
                // æ£€æŸ¥ç¢°æ’
                this.checkCollisions();
                
                // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾æœ€å¤§é•¿åº¦
                if (this.gameState.hookLength >= this.gameState.maxHookLength) {
                    this.gameState.hookState = 'retracting';
                }
            }

            retractHook() {
                const baseSpeed = this.gameState.hookSpeed * 1.2;
                const weightPenalty = this.gameState.caughtTreasure ? 
                    this.gameState.caughtTreasure.weight * 0.8 : 0;
                const retractSpeed = Math.max(1, baseSpeed - weightPenalty);
                
                this.gameState.hookLength -= retractSpeed;
                this.ropeElement.style.height = Math.max(0, this.gameState.hookLength) + 'px';
                
                // ç§»åŠ¨è¢«æŠ“ä½çš„å®ç‰©
                if (this.gameState.caughtTreasure) {
                    this.updateCaughtTreasurePosition();
                }
                
                // æ£€æŸ¥æ˜¯å¦å®Œå…¨æ”¶å›
                if (this.gameState.hookLength <= 0) {
                    this.completeCatch();
                }
            }

            checkCollisions() {
                const hookRect = this.getHookPosition();
                
                for (let treasure of this.gameState.treasures) {
                    if (!treasure.element) continue;
                    
                    const treasureRect = treasure.element.getBoundingClientRect();
                    const canvasRect = document.getElementById('game-canvas').getBoundingClientRect();
                    
                    // è½¬æ¢ä¸ºç›¸å¯¹åæ ‡
                    const relTreasureRect = {
                        left: treasureRect.left - canvasRect.left,
                        right: treasureRect.right - canvasRect.left,
                        top: treasureRect.top - canvasRect.top,
                        bottom: treasureRect.bottom - canvasRect.top
                    };
                    
                    if (this.isColliding(hookRect, relTreasureRect)) {
                        this.catchTreasure(treasure);
                        break;
                    }
                }
            }

            getHookPosition() {
                const angle = this.gameState.hookAngle * Math.PI / 180;
                const canvas = document.getElementById('game-canvas');
                const canvasRect = canvas.getBoundingClientRect();
                
                const hookX = canvasRect.width / 2 + Math.sin(angle) * this.gameState.hookLength;
                const hookY = Math.cos(angle) * this.gameState.hookLength + 25;
                
                return {
                    left: hookX - 15,
                    right: hookX + 15,
                    top: hookY - 15,
                    bottom: hookY + 15
                };
            }

            isColliding(rect1, rect2) {
                return !(rect1.right < rect2.left || 
                        rect1.left > rect2.right || 
                        rect1.bottom < rect2.top || 
                        rect1.top > rect2.bottom);
            }

            catchTreasure(treasure) {
                this.gameState.caughtTreasure = treasure;
                this.gameState.hookState = 'retracting';
                this.audioManager.play('catch');
                
                // æ·»åŠ è§†è§‰æ•ˆæœ
                treasure.element.style.zIndex = '60';
                treasure.element.style.transform = 'scale(1.1)';
                treasure.element.style.boxShadow = '0 0 20px rgba(255, 215, 0, 0.8)';
            }

            updateCaughtTreasurePosition() {
                if (!this.gameState.caughtTreasure) return;
                
                const angle = this.gameState.hookAngle * Math.PI / 180;
                const canvas = document.getElementById('game-canvas');
                const canvasRect = canvas.getBoundingClientRect();
                
                const treasureX = canvasRect.width / 2 + Math.sin(angle) * this.gameState.hookLength;
                const treasureY = Math.cos(angle) * this.gameState.hookLength + 25;
                
                this.gameState.caughtTreasure.element.style.left = (treasureX - this.gameState.caughtTreasure.size / 2) + 'px';
                this.gameState.caughtTreasure.element.style.top = (treasureY - this.gameState.caughtTreasure.size / 2) + 'px';
            }

            completeCatch() {
                if (this.gameState.caughtTreasure) {
                    game.collectTreasure(this.gameState.caughtTreasure);
                    this.gameState.caughtTreasure = null;
                }
                
                this.gameState.hookState = 'idle';
                this.gameState.hookLength = 0;
                this.isSwinging = true;
                this.ropeElement.style.height = '0px';
                this.hookElement.style.transform = 'translateX(-50%) rotate(0deg)';
                this.gameState.hookAngle = 0;
                this.minerElement.classList.remove('working');
            }
        }

        // ç‰¹æ•ˆç³»ç»Ÿ
        class EffectsManager {
            static createParticle(x, y, type, text = '') {
                const particle = document.createElement('div');
                particle.className = `particle ${type}-particle`;
                particle.textContent = text;
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                
                document.getElementById('game-canvas').appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, type === 'coin' ? 1500 : 1000);
            }

            static showScorePopup(x, y, score, type = 'normal') {
                const popup = document.createElement('div');
                popup.className = `score-popup ${type}`;
                popup.textContent = '+' + score;
                popup.style.left = x + 'px';
                popup.style.top = y + 'px';
                
                document.getElementById('game-canvas').appendChild(popup);
                
                // åˆ›å»ºé‡‘å¸ç²’å­æ•ˆæœ
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        this.createParticle(
                            x + Math.random() * 40 - 20, 
                            y + Math.random() * 20 - 10, 
                            'coin', 
                            'ğŸ’°'
                        );
                    }, i * 100);
                }
                
                setTimeout(() => {
                    if (popup.parentNode) {
                        popup.parentNode.removeChild(popup);
                    }
                }, 2000);
            }

            static showComboEffect(x, y, combo) {
                const comboText = document.createElement('div');
                comboText.className = 'score-popup bonus';
                comboText.textContent = `${combo}x è¿å‡»!`;
                comboText.style.left = x + 'px';
                comboText.style.top = (y - 40) + 'px';
                comboText.style.fontSize = '20px';
                
                document.getElementById('game-canvas').appendChild(comboText);
                
                // åˆ›å»ºé—ªçƒç²’å­
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        this.createParticle(
                            x + Math.random() * 60 - 30, 
                            y + Math.random() * 40 - 20, 
                            'sparkle'
                        );
                    }, i * 50);
                }
                
                setTimeout(() => {
                    if (comboText.parentNode) {
                        comboText.parentNode.removeChild(comboText);
                    }
                }, 2000);
            }

            static showTip(message, duration = 3000) {
                const tipsElement = document.getElementById('game-tips');
                const contentElement = document.getElementById('tip-content');
                
                contentElement.textContent = message;
                tipsElement.classList.add('visible');
                
                setTimeout(() => {
                    tipsElement.classList.remove('visible');
                }, duration);
            }
        }

        // ä¸»æ¸¸æˆç±»
        class GoldMinerGame {
            constructor() {
                this.gameState = new GameState();
                this.audioManager = new AudioManager();
                this.treasureManager = new TreasureManager();
                this.hookSystem = new HookSystem(this.gameState, this.audioManager);
                this.effectsManager = EffectsManager;
                
                this.gameLoop = null;
                this.levelTargets = [800, 1200, 1800, 2500, 3500, 5000, 7000, 10000, 15000, 20000];
                this.tips = [
                    'ğŸ’¡ è¿ç»­æŠ“å–å®ç‰©å¯è·å¾—è¿å‡»å¥–åŠ±ï¼',
                    'âš¡ åŠ›é‡ä¸è¶³æ—¶é’©å­ä¼šå˜æ…¢ï¼Œæ³¨æ„ä¼‘æ¯ï¼',
                    'ğŸ’ é’»çŸ³ä»·å€¼æœ€é«˜ï¼Œä¼˜å…ˆæŠ“å–ï¼',
                    'ğŸª¨ é¿å…æŠ“å–çŸ³å¤´ï¼Œå®ƒä»¬å¾ˆé‡ä½†ä»·å€¼ä½ï¼',
                    'ğŸ ç¥ç§˜å®ç®±æœ‰æƒŠå–œå¥–åŠ±ï¼',
                    'â° åˆç†åˆ†é…æ—¶é—´ï¼Œä¸è¦è´ªå¿ƒï¼',
                    'ğŸ¯ ç„å‡†è§’åº¦å¾ˆé‡è¦ï¼'
                ];
                
                this.initEventListeners();
                this.showWelcomeMessage();
            }

            initEventListeners() {
                // ç‚¹å‡»å‘å°„é’©å­
                document.getElementById('game-canvas').addEventListener('click', (e) => {
                    if (this.gameState.isPlaying && !this.gameState.isPaused) {
                        this.hookSystem.launch();
                    }
                });

                // é”®ç›˜æ§åˆ¶
                document.addEventListener('keydown', (e) => {
                    if (!this.gameState.isPlaying) return;
                    
                    switch(e.code) {
                        case 'Space':
                            e.preventDefault();
                            this.hookSystem.launch();
                            break;
                        case 'KeyP':
                            this.pauseGame();
                            break;
                        case 'KeyR':
                            this.restartGame();
                            break;
                    }
                });

                // è§¦æ‘¸æ”¯æŒ
                document.getElementById('game-canvas').addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (this.gameState.isPlaying && !this.gameState.isPaused) {
                        this.hookSystem.launch();
                    }
                });

                // çª—å£å¤§å°å˜åŒ–
                window.addEventListener('resize', () => {
                    this.gameState.maxHookLength = window.innerHeight - 200;
                });
            }

            showWelcomeMessage() {
                const messageEl = document.getElementById('game-message');
                messageEl.style.display = 'block';
            }

            startGame() {
                this.gameState.reset();
                this.gameState.isPlaying = true;
                
                // æ›´æ–°UI
                document.getElementById('start-btn').disabled = true;
                document.getElementById('pause-btn').disabled = false;
                
                // ç”Ÿæˆå®ç‰©
                this.generateLevel();
                
                // å¼€å§‹æ¸¸æˆå¾ªç¯
                this.startGameLoop();
                
                // å¼€å§‹è®¡æ—¶
                this.startTimer();
                
                // æ˜¾ç¤ºæç¤º
                if (this.gameState.level === 1) {
                    setTimeout(() => {
                        this.effectsManager.showTip('ç‚¹å‡»å±å¹•å‘å°„é’©å­æŠ“å–å®ç‰©ï¼');
                    }, 1000);
                }
                
                this.audioManager.play('levelUp');
            }

            generateLevel() {
                // æ¸…é™¤ç°æœ‰å®ç‰©
                this.clearTreasures();
                
                // ç”Ÿæˆæ–°å®ç‰©
                this.gameState.treasures = this.treasureManager.generateTreasures(this.gameState.level);
                
                // æ¸²æŸ“å®ç‰©
                this.gameState.treasures.forEach(treasure => {
                    this.treasureManager.renderTreasure(treasure);
                });
                
                // æ›´æ–°ç›®æ ‡åˆ†æ•°
                const targetIndex = Math.min(this.gameState.level - 1, this.levelTargets.length - 1);
                this.gameState.target = this.levelTargets[targetIndex];
                
                this.updateUI();
            }

            startGameLoop() {
                this.gameLoop = setInterval(() => {
                    if (!this.gameState.isPaused) {
                        this.update();
                    }
                }, 16); // 60 FPS
            }

            update() {
                this.hookSystem.update();
                this.updatePowerSystem();
                this.updateComboSystem();
            }

            updatePowerSystem() {
                // åŠ›é‡ç³»ç»Ÿï¼šéšæ—¶é—´æ¢å¤
                if (this.gameState.power < 100) {
                    this.gameState.power = Math.min(100, this.gameState.power + 0.3);
                    this.updateUI();
                }
            }

            updateComboSystem() {
                // è¿å‡»ç³»ç»Ÿï¼šè¶…æ—¶é‡ç½®
                const now = Date.now();
                if (now - this.gameState.lastCatchTime > 4000 && this.gameState.combo > 0) {
                    this.gameState.combo = 0;
                    this.gameState.comboMultiplier = 1;
                    this.updateUI();
                }
            }

            startTimer() {
                this.gameState.gameTimer = setInterval(() => {
                    if (!this.gameState.isPaused) {
                        this.gameState.time--;
                        this.updateUI();
                        
                        // æ—¶é—´æé†’
                        if (this.gameState.time === 30) {
                            this.effectsManager.showTip('â° è¿˜å‰©30ç§’ï¼åŠ å¿«é€Ÿåº¦ï¼', 2000);
                        } else if (this.gameState.time === 10) {
                            this.effectsManager.showTip('ğŸš¨ æœ€å10ç§’ï¼', 2000);
                        }
                        
                        if (this.gameState.time <= 0) {
                            this.endGame();
                        } else if (this.gameState.time <= 10) {
                            // æ—¶é—´è­¦å‘Šæ•ˆæœ
                            document.getElementById('time').style.color = '#FF4444';
                            document.getElementById('time').style.animation = 'pulse 0.5s infinite';
                        }
                    }
                }, 1000);
            }

            collectTreasure(treasure) {
                // è®¡ç®—åˆ†æ•°
                let baseScore = treasure.value;
                let bonusScore = 0;
                
                // è¿å‡»ç³»ç»Ÿ
                const now = Date.now();
                if (now - this.gameState.lastCatchTime < 4000) {
                    this.gameState.combo++;
                    this.gameState.comboMultiplier = Math.min(3, 1 + this.gameState.combo * 0.15);
                    bonusScore = Math.floor(baseScore * (this.gameState.comboMultiplier - 1));
                } else {
                    this.gameState.combo = 1;
                    this.gameState.comboMultiplier = 1;
                }
                
                this.gameState.lastCatchTime = now;
                this.gameState.maxCombo = Math.max(this.gameState.maxCombo, this.gameState.combo);
                
                const totalScore = baseScore + bonusScore;
                this.gameState.score += totalScore;
                this.gameState.totalTreasuresCollected++;
                
                // æ¶ˆè€—åŠ›é‡
                const powerCost = Math.max(5, treasure.weight * 8);
                this.gameState.power = Math.max(10, this.gameState.power - powerCost);
                
                // ç‰¹æ•ˆå’ŒéŸ³æ•ˆ
                const treasureRect = treasure.element.getBoundingClientRect();
                const canvasRect = document.getElementById('game-canvas').getBoundingClientRect();
                const relX = treasureRect.left - canvasRect.left + treasureRect.width / 2;
                const relY = treasureRect.top - canvasRect.top + treasureRect.height / 2;
                
                this.effectsManager.showScorePopup(relX - 20, relY - 30, totalScore, bonusScore > 0 ? 'bonus' : 'normal');
                
                if (this.gameState.combo > 1) {
                    this.effectsManager.showComboEffect(relX + 30, relY - 20, this.gameState.combo);
                    this.audioManager.play('combo');
                } else {
                    this.audioManager.play(treasure.type);
                }
                
                // ç¥ç§˜å®ç®±ç‰¹æ®Šæ•ˆæœ
                if (treasure.type === 'mystery') {
                    this.handleMysteryBox();
                }
                
                // ç§»é™¤å®ç‰©
                treasure.element.remove();
                const index = this.gameState.treasures.indexOf(treasure);
                if (index > -1) {
                    this.gameState.treasures.splice(index, 1);
                }
                
                // çŸ¿å·¥è¡¨æƒ…
                this.minerElement.classList.add('happy');
                setTimeout(() => {
                    this.minerElement.classList.remove('happy');
                }, 1000);
                
                this.updateUI();
                this.checkLevelComplete();
                
                // éšæœºæ˜¾ç¤ºæç¤º
                if (Math.random() < 0.3) {
                    const randomTip = this.tips[Math.floor(Math.random() * this.tips.length)];
                    setTimeout(() => {
                        this.effectsManager.showTip(randomTip, 2000);
                    }, 1000);
                }
            }

            handleMysteryBox() {
                const bonuses = [
                    { type: 'score', value: 800, message: 'ğŸ‰ å¥–åŠ±åˆ†æ•° +800!' },
                    { type: 'time', value: 25, message: 'â° é¢å¤–æ—¶é—´ +25ç§’!' },
                    { type: 'power', value: 40, message: 'âš¡ åŠ›é‡æ¢å¤ +40!' },
                    { type: 'combo', value: 3, message: 'ğŸ”¥ è¿å‡»å¥–åŠ± +3!' }
                ];
                
                const bonus = bonuses[Math.floor(Math.random() * bonuses.length)];
                
                switch(bonus.type) {
                    case 'score':
                        this.gameState.score += bonus.value;
                        break;
                    case 'time':
                        this.gameState.time += bonus.value;
                        break;
                    case 'power':
                        this.gameState.power = Math.min(100, this.gameState.power + bonus.value);
                        break;
                    case 'combo':
                        this.gameState.combo += bonus.value;
                        break;
                }
                
                this.effectsManager.showTip(bonus.message, 3000);
                this.audioManager.play('mystery');
            }

            checkLevelComplete() {
                if (this.gameState.score >= this.gameState.target) {
                    this.nextLevel();
                }
            }

            nextLevel() {
                this.gameState.level++;
                this.gameState.time += 50; // é¢å¤–æ—¶é—´
                this.gameState.power = 100; // æ¢å¤åŠ›é‡
                
                this.audioManager.play('levelUp');
                this.effectsManager.showTip(`ğŸ‰ æ­å–œé€šè¿‡ç¬¬${this.gameState.level - 1}å…³ï¼å‡†å¤‡ä¸‹ä¸€å…³...`, 3000);
                
                // çŸ­æš‚æš‚åœåç”Ÿæˆæ–°å…³å¡
                setTimeout(() => {
                    this.generateLevel();
                }, 2000);
            }

            pauseGame() {
                if (!this.gameState.isPlaying) return;
                
                this.gameState.isPaused = !this.gameState.isPaused;
                const pauseBtn = document.getElementById('pause-btn');
                
                if (this.gameState.isPaused) {
                    pauseBtn.textContent = 'â–¶ï¸ ç»§ç»­';
                    this.showMessage('â¸ï¸ æ¸¸æˆæš‚åœ', 'ç‚¹å‡»ç»§ç»­æŒ‰é’®æ¢å¤æ¸¸æˆ', 'ç»§ç»­æ¸¸æˆ', 'è¿”å›ä¸»èœå•');
                } else {
                    pauseBtn.textContent = 'â¸ï¸ æš‚åœ';
                    this.hideMessage();
                }
            }

            restartGame() {
                this.endGame();
                setTimeout(() => {
                    this.startGame();
                }, 500);
            }

            endGame() {
                this.gameState.isPlaying = false;
                this.gameState.clearTimer();
                
                if (this.gameLoop) {
                    clearInterval(this.gameLoop);
                    this.gameLoop = null;
                }
                
                // æ›´æ–°UI
                document.getElementById('start-btn').disabled = false;
                document.getElementById('pause-btn').disabled = true;
                document.getElementById('time').style.color = '#FFD700';
                document.getElementById('time').style.animation = 'none';
                
                // æ˜¾ç¤ºç»“æœ
                const success = this.gameState.score >= this.gameState.target;
                const title = success ? 'ğŸ† æ­å–œé€šå…³ï¼' : 'â° æ—¶é—´åˆ°ï¼';
                const message = success ? 
                    `å¤ªæ£’äº†ï¼ä½ æˆåŠŸå®Œæˆäº†ç¬¬${this.gameState.level}å…³ï¼<br><br>` +
                    `ğŸ† æœ€ç»ˆå¾—åˆ†ï¼š${this.gameState.score}<br>` +
                    `ğŸ”¥ æœ€é«˜è¿å‡»ï¼š${this.gameState.maxCombo}<br>` +
                    `ğŸ’° æ”¶é›†å®ç‰©ï¼š${this.gameState.totalTreasuresCollected}ä¸ª` :
                    `æ¸¸æˆç»“æŸï¼å†æ¥å†å‰ï¼<br><br>` +
                    `ğŸ† æœ€ç»ˆå¾—åˆ†ï¼š${this.gameState.score}<br>` +
                    `ğŸ¯ ç›®æ ‡åˆ†æ•°ï¼š${this.gameState.target}<br>` +
                    `ğŸ“Š å®Œæˆåº¦ï¼š${Math.round((this.gameState.score / this.gameState.target) * 100)}%<br>` +
                    `ğŸ”¥ æœ€é«˜è¿å‡»ï¼š${this.gameState.maxCombo}`;
                
                this.showMessage(title, message, 'é‡æ–°å¼€å§‹', 'æŸ¥çœ‹å¸®åŠ©');
                this.audioManager.play(success ? 'levelUp' : 'gameOver');
            }

            clearTreasures() {
                this.gameState.treasures.forEach(treasure => {
                    if (treasure.element) {
                        treasure.element.remove();
                    }
                });
                this.gameState.treasures = [];
            }

            updateUI() {
                document.getElementById('score').textContent = this.gameState.score.toLocaleString();
                document.getElementById('target').textContent = this.gameState.target.toLocaleString();
                document.getElementById('level').textContent = this.gameState.level;
                document.getElementById('time').textContent = this.gameState.time;
                document.getElementById('combo').textContent = this.gameState.combo;
                document.getElementById('power').textContent = Math.round(this.gameState.power) + '%';
                
                // æ›´æ–°è¿›åº¦æ¡
                const progress = Math.min(100, (this.gameState.score / this.gameState.target) * 100);
                document.getElementById('progress-fill').style.width = progress + '%';
                document.getElementById('progress-text').textContent = `${this.gameState.score.toLocaleString()} / ${this.gameState.target.toLocaleString()}`;
            }

            showMessage(title, content, primaryButton, secondaryButton = null) {
                document.getElementById('message-title').innerHTML = title;
                document.getElementById('message-content').innerHTML = content;
                
                const buttonsContainer = document.querySelector('.message-buttons');
                buttonsContainer.innerHTML = '';
                
                const primaryBtn = document.createElement('button');
                primaryBtn.className = 'message-btn';
                primaryBtn.textContent = primaryButton;
                primaryBtn.onclick = () => {
                    if (primaryButton === 'é‡æ–°å¼€å§‹') {
                        this.hideMessage();
                        this.restartGame();
                    } else if (primaryButton === 'ç»§ç»­æ¸¸æˆ') {
                        this.pauseGame();
                    } else {
                        this.hideMessage();
                    }
                };
                buttonsContainer.appendChild(primaryBtn);
                
                if (secondaryButton) {
                    const secondaryBtn = document.createElement('button');
                    secondaryBtn.className = 'message-btn secondary';
                    secondaryBtn.textContent = secondaryButton;
                    secondaryBtn.onclick = () => {
                        if (secondaryButton === 'æŸ¥çœ‹å¸®åŠ©') {
                            this.showHelp();
                        } else if (secondaryButton === 'è¿”å›ä¸»èœå•') {
                            this.hideMessage();
                            this.endGame();
                        }
                    };
                    buttonsContainer.appendChild(secondaryBtn);
                }
                
                document.getElementById('game-message').style.display = 'block';
            }

            hideMessage() {
                document.getElementById('game-message').style.display = 'none';
            }

            toggleAudio() {
                const enabled = this.audioManager.toggle();
                const audioBtn = document.getElementById('audio-btn');
                audioBtn.textContent = enabled ? 'ğŸ”Š éŸ³æ•ˆ' : 'ğŸ”‡ é™éŸ³';
                audioBtn.classList.toggle('muted', !enabled);
            }

            showHelp() {
                const helpContent = `
                    <strong>ğŸ® æ¸¸æˆæ“ä½œï¼š</strong><br>
                    â€¢ ç‚¹å‡»å±å¹•æˆ–æŒ‰ç©ºæ ¼é”®å‘å°„é’©å­<br>
                    â€¢ æŠ“å–å®ç‰©è·å¾—åˆ†æ•°è¾¾åˆ°ç›®æ ‡å³å¯è¿‡å…³<br>
                    â€¢ æŒ‰Pé”®æš‚åœï¼ŒæŒ‰Ré”®é‡æ–°å¼€å§‹<br><br>
                    
                    <strong>ğŸ’° å®ç‰©ä»·å€¼ï¼š</strong><br>
                    â€¢ ğŸ’° é‡‘å¸ï¼š100åˆ†ï¼ˆè½»ï¼‰<br>
                    â€¢ ğŸ’ é’»çŸ³ï¼š350åˆ†ï¼ˆå¾ˆè½»ï¼‰<br>
                    â€¢ ğŸ’ çº¢å®çŸ³ï¼š200åˆ†ï¼ˆè½»ï¼‰<br>
                    â€¢ ğŸ’š ç»¿å®çŸ³ï¼š250åˆ†ï¼ˆè½»ï¼‰<br>
                    â€¢ ğŸ ç¥ç§˜å®ç®±ï¼š500åˆ†+ç‰¹æ®Šå¥–åŠ±ï¼ˆè½»ï¼‰<br>
                    â€¢ ğŸª¨ çŸ³å¤´ï¼š15åˆ†ï¼ˆå¾ˆé‡ï¼Œé¿å…æŠ“å–ï¼‰<br><br>
                    
                    <strong>âš¡ æ¸¸æˆæŠ€å·§ï¼š</strong><br>
                    â€¢ è¿ç»­æŠ“å–å®ç‰©å¯è·å¾—è¿å‡»å¥–åŠ±ï¼ˆæœ€é«˜3å€ï¼‰<br>
                    â€¢ åŠ›é‡ä¸è¶³æ—¶é’©å­é€Ÿåº¦ä¼šå˜æ…¢<br>
                    â€¢ ä¼˜å…ˆæŠ“å–é’»çŸ³ç­‰é«˜ä»·å€¼è½»è´¨å®ç‰©<br>
                    â€¢ ç¥ç§˜å®ç®±æœ‰éšæœºå¥–åŠ±ï¼ˆåˆ†æ•°/æ—¶é—´/åŠ›é‡/è¿å‡»ï¼‰<br>
                    â€¢ åˆç†åˆ†é…æ—¶é—´ï¼Œä¸è¦è´ªå¿ƒæŠ“çŸ³å¤´
                `;
                this.showMessage('â“ æ¸¸æˆå¸®åŠ©', helpContent, 'å¼€å§‹æ¸¸æˆ', 'å…³é—­å¸®åŠ©');
            }
        }

        // å…¨å±€å‡½æ•°
        let game;

        function initGame() {
            game = new GoldMinerGame();
        }

        function startGame() {
            game.startGame();
        }

        function pauseGame() {
            game.pauseGame();
        }

        function restartGame() {
            game.restartGame();
        }

        function toggleAudio() {
            game.toggleAudio();
        }

        function showHelp() {
            game.showHelp();
        }

        function hideMessage() {
            game.hideMessage();
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', initGame);

        // é˜²æ­¢é¡µé¢æ»šåŠ¨å’Œç¼©æ”¾
        document.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });

        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });

        // å¤„ç†é¡µé¢å¯è§æ€§å˜åŒ–
        document.addEventListener('visibilitychange', function() {
            if (game && game.gameState.isPlaying && document.hidden) {
                game.pauseGame();
            }
        });

        // å¤„ç†çª—å£å¤±ç„¦
        window.addEventListener('blur', function() {
            if (game && game.gameState.isPlaying) {
                game.pauseGame();
            }
        });
    </script>
</body>
</html>