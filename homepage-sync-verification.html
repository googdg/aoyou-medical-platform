<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸»é¡µå†…å®¹åŒæ­¥éªŒè¯</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
            line-height: 1.6;
        }
        .header {
            text-align: center;
            background: linear-gradient(135deg, #007cba 0%, #0056b3 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }
        .test-section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            margin: 0.5rem;
            text-decoration: none;
            display: inline-block;
            transition: all 0.2s;
        }
        .btn-primary {
            background: #007cba;
            color: white;
        }
        .btn-primary:hover {
            background: #005a87;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-success:hover {
            background: #1e7e34;
        }
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        .btn-warning:hover {
            background: #e0a800;
        }
        .status {
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .test-form {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
        }
        .form-group input,
        .form-group textarea {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .debug-info {
            background: #f0f0f0;
            padding: 1rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        .comparison-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }
        .comparison-item h4 {
            margin-top: 0;
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”„ ä¸»é¡µå†…å®¹åŒæ­¥éªŒè¯</h1>
        <p>éªŒè¯ç®¡ç†åå°çš„ä¸»é¡µå†…å®¹æ˜¯å¦æ­£ç¡®åŒæ­¥åˆ°å‰ç«¯æ˜¾ç¤º</p>
    </div>

    <div class="test-section">
        <h2>ğŸ“ æµ‹è¯•ä¸»é¡µå†…å®¹åŒæ­¥</h2>
        <p>åœ¨ä¸‹é¢ç¼–è¾‘å†…å®¹ï¼Œç„¶åæµ‹è¯•æ˜¯å¦èƒ½æ­£ç¡®åŒæ­¥åˆ°ä¸»é¡µï¼š</p>
        
        <form class="test-form" id="test-form">
            <div class="form-group">
                <label for="site-title">ç½‘ç«™æ ‡é¢˜</label>
                <input type="text" id="site-title" name="site-title" placeholder="è¾“å…¥ç½‘ç«™æ ‡é¢˜" value="æµ‹è¯•ç½‘ç«™æ ‡é¢˜">
            </div>
            
            <div class="form-group">
                <label for="site-tagline">ç½‘ç«™æ ‡è¯­</label>
                <input type="text" id="site-tagline" name="site-tagline" placeholder="è¾“å…¥ç½‘ç«™æ ‡è¯­" value="è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ ‡è¯­">
            </div>
            
            <div class="form-group">
                <label for="welcome-title">æ¬¢è¿æ ‡é¢˜</label>
                <input type="text" id="welcome-title" name="welcome-title" placeholder="è¾“å…¥æ¬¢è¿æ ‡é¢˜" value="æ¬¢è¿æ¥åˆ°æˆ‘çš„ç½‘ç«™ï¼">
            </div>
            
            <div class="form-group">
                <label for="welcome-subtitle">æ¬¢è¿å‰¯æ ‡é¢˜</label>
                <input type="text" id="welcome-subtitle" name="welcome-subtitle" placeholder="è¾“å…¥æ¬¢è¿å‰¯æ ‡é¢˜" value="å¾ˆé«˜å…´ä½ æ‰¾åˆ°äº†æˆ‘ï¼">
            </div>
            
            <div class="form-group">
                <label for="navigation-guide">å¯¼èˆªæŒ‡å—</label>
                <textarea id="navigation-guide" name="navigation-guide" placeholder="è¾“å…¥å¯¼èˆªæŒ‡å—">ä½¿ç”¨ä¸Šæ–¹èœå•æ å¿«é€Ÿå¯¼èˆªåˆ°ç½‘ç«™çš„ä¸åŒéƒ¨åˆ†ã€‚ä½ å¯ä»¥æ‰¾åˆ°æˆ‘çš„åšå®¢æ–‡ç« ã€ç¤¾äº¤åª’ä½“é“¾æ¥å’Œæœ‰ç”¨çš„èµ„æºã€‚</textarea>
            </div>
            
            <div class="form-group">
                <label for="intro1">ä¸ªäººä»‹ç»1</label>
                <textarea id="intro1" name="intro1" placeholder="è¾“å…¥ç¬¬ä¸€æ®µä¸ªäººä»‹ç»">æˆ‘çƒ­è¡·äºç¼–ç¨‹ã€å†™ä½œå’Œåˆ›é€ æ•°å­—ä½“éªŒã€‚å½“æˆ‘ä¸åœ¨ç”µè„‘å±å¹•å‰æ—¶ï¼Œä½ å¯ä»¥å‘ç°æˆ‘åœ¨æ¢ç´¢æ–°æŠ€æœ¯ã€é€šè¿‡å†™ä½œåˆ†äº«çŸ¥è¯†ï¼Œæˆ–åœ¨å„ç§å¹³å°ä¸Šè®¨è®ºæƒ³æ³•ã€‚</textarea>
            </div>
            
            <div class="form-group">
                <label for="intro2">ä¸ªäººä»‹ç»2</label>
                <textarea id="intro2" name="intro2" placeholder="è¾“å…¥ç¬¬äºŒæ®µä¸ªäººä»‹ç»">è¿™ä¸ªç½‘ç«™æ˜¯æˆ‘çš„æ•°å­—å®¶å›­ï¼Œæˆ‘åœ¨è¿™é‡Œåˆ†äº«æƒ³æ³•ã€é¡¹ç›®å’Œèµ„æºï¼Œå¸Œæœ›ä½ ä¼šè§‰å¾—æœ‰ä»·å€¼ã€‚éšæ—¶æ¢ç´¢ï¼Œå¦‚æœä½ æƒ³è”ç³»ï¼Œè¯·ä¸è¦çŠ¹è±«ï¼</textarea>
            </div>
        </form>
        
        <div class="btn-group">
            <button class="btn btn-primary" onclick="loadCurrentContent()">ğŸ“¥ åŠ è½½å½“å‰å†…å®¹</button>
            <button class="btn btn-success" onclick="saveAndSync()">ğŸ’¾ ä¿å­˜å¹¶åŒæ­¥</button>
            <button class="btn btn-warning" onclick="testAPIDirectly()">ğŸ”§ ç›´æ¥æµ‹è¯•API</button>
            <button class="btn btn-primary" onclick="openMainPage()">ğŸŒ æ‰“å¼€ä¸»é¡µ</button>
        </div>
        
        <div id="status-message"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ” åŒæ­¥çŠ¶æ€æ£€æŸ¥</h2>
        <div class="btn-group">
            <button class="btn btn-primary" onclick="checkAPIStatus()">ğŸ” æ£€æŸ¥APIçŠ¶æ€</button>
            <button class="btn btn-success" onclick="compareContent()">ğŸ“Š å¯¹æ¯”å†…å®¹</button>
            <button class="btn btn-warning" onclick="clearCache()">ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜</button>
        </div>
        
        <div class="comparison" id="content-comparison" style="display: none;">
            <div class="comparison-item">
                <h4>APIä¸­çš„å†…å®¹</h4>
                <div id="api-content" class="debug-info">åŠ è½½ä¸­...</div>
            </div>
            <div class="comparison-item">
                <h4>localStorageä¸­çš„å†…å®¹</h4>
                <div id="local-content" class="debug-info">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š è°ƒè¯•ä¿¡æ¯</h2>
        <div id="debug-info" class="debug-info">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>

    <script>
        let authToken = localStorage.getItem('admin_token');
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        window.onload = function() {
            checkAPIStatus();
            loadCurrentContent();
        };
        
        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.innerHTML = '';
                }, 3000);
            }
        }
        
        // æ·»åŠ è°ƒè¯•ä¿¡æ¯
        function addDebugInfo(message) {
            const debugDiv = document.getElementById('debug-info');
            const timestamp = new Date().toLocaleTimeString();\n            debugDiv.textContent += `[${timestamp}] ${message}\\n`;\n            debugDiv.scrollTop = debugDiv.scrollHeight;\n        }\n        \n        // åŠ è½½å½“å‰å†…å®¹\n        async function loadCurrentContent() {\n            addDebugInfo('å¼€å§‹åŠ è½½å½“å‰å†…å®¹...');\n            \n            try {\n                const response = await fetch('/api/homepage');\n                const data = await response.json();\n                \n                if (data.success) {\n                    populateForm(data.content || {});\n                    addDebugInfo('âœ… å†…å®¹åŠ è½½æˆåŠŸ');\n                    showStatus('å†…å®¹åŠ è½½æˆåŠŸï¼', 'success');\n                } else {\n                    addDebugInfo('âŒ åŠ è½½å¤±è´¥: ' + data.message);\n                    showStatus('åŠ è½½å¤±è´¥: ' + data.message, 'error');\n                }\n            } catch (error) {\n                addDebugInfo('âŒ åŠ è½½é”™è¯¯: ' + error.message);\n                showStatus('åŠ è½½å¤±è´¥: ' + error.message, 'error');\n            }\n        }\n        \n        // å¡«å……è¡¨å•\n        function populateForm(content) {\n            const fields = ['site-title', 'site-tagline', 'welcome-title', 'welcome-subtitle', 'navigation-guide', 'intro1', 'intro2'];\n            \n            fields.forEach(field => {\n                const element = document.getElementById(field);\n                if (element && content[field]) {\n                    element.value = content[field];\n                }\n            });\n        }\n        \n        // æ”¶é›†è¡¨å•æ•°æ®\n        function collectFormData() {\n            const data = {};\n            const fields = ['site-title', 'site-tagline', 'welcome-title', 'welcome-subtitle', 'navigation-guide', 'intro1', 'intro2'];\n            \n            fields.forEach(field => {\n                const element = document.getElementById(field);\n                if (element) {\n                    data[field] = element.value;\n                }\n            });\n            \n            return data;\n        }\n        \n        // ä¿å­˜å¹¶åŒæ­¥\n        async function saveAndSync() {\n            if (!authToken) {\n                // å°è¯•è·å–è®¤è¯ä»¤ç‰Œ\n                await getAuthToken();\n                if (!authToken) {\n                    showStatus('è¯·å…ˆç™»å½•ç®¡ç†åå°è·å–è®¤è¯ä»¤ç‰Œ', 'error');\n                    return;\n                }\n            }\n            \n            addDebugInfo('å¼€å§‹ä¿å­˜å†…å®¹...');\n            showStatus('æ­£åœ¨ä¿å­˜å†…å®¹...', 'info');\n            \n            const content = collectFormData();\n            \n            try {\n                const response = await fetch('/api/homepage', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'Authorization': `Bearer ${authToken}`\n                    },\n                    body: JSON.stringify(content)\n                });\n                \n                const data = await response.json();\n                \n                if (data.success) {\n                    addDebugInfo('âœ… å†…å®¹ä¿å­˜æˆåŠŸ');\n                    showStatus('å†…å®¹ä¿å­˜æˆåŠŸï¼ç°åœ¨æµ‹è¯•åŒæ­¥...', 'success');\n                    \n                    // æµ‹è¯•åŒæ­¥åˆ°ä¸»é¡µ\n                    setTimeout(() => {\n                        testSyncToMainPage(content);\n                    }, 1000);\n                } else {\n                    addDebugInfo('âŒ ä¿å­˜å¤±è´¥: ' + data.message);\n                    showStatus('ä¿å­˜å¤±è´¥: ' + data.message, 'error');\n                }\n            } catch (error) {\n                addDebugInfo('âŒ ä¿å­˜é”™è¯¯: ' + error.message);\n                showStatus('ä¿å­˜å¤±è´¥: ' + error.message, 'error');\n            }\n        }\n        \n        // è·å–è®¤è¯ä»¤ç‰Œ\n        async function getAuthToken() {\n            try {\n                const response = await fetch('/api/auth/login', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({\n                        username: 'admin',\n                        password: 'admin123'\n                    })\n                });\n                \n                const data = await response.json();\n                \n                if (data.success && data.token) {\n                    authToken = data.token;\n                    localStorage.setItem('admin_token', authToken);\n                    addDebugInfo('âœ… è®¤è¯æˆåŠŸ');\n                } else {\n                    addDebugInfo('âŒ è®¤è¯å¤±è´¥: ' + data.message);\n                }\n            } catch (error) {\n                addDebugInfo('âŒ è®¤è¯é”™è¯¯: ' + error.message);\n            }\n        }\n        \n        // æµ‹è¯•åŒæ­¥åˆ°ä¸»é¡µ\n        function testSyncToMainPage(content) {\n            addDebugInfo('æµ‹è¯•å‘ä¸»é¡µå‘é€åŒæ­¥æ¶ˆæ¯...');\n            \n            // å°è¯•å‘ä¸»é¡µå‘é€æ¶ˆæ¯\n            const mainWindow = window.open('/', 'mainPage');\n            \n            setTimeout(() => {\n                mainWindow.postMessage({\n                    type: 'homepage-update',\n                    content: content\n                }, '*');\n                \n                addDebugInfo('âœ… åŒæ­¥æ¶ˆæ¯å·²å‘é€åˆ°ä¸»é¡µ');\n                showStatus('åŒæ­¥æ¶ˆæ¯å·²å‘é€ï¼è¯·æ£€æŸ¥ä¸»é¡µæ˜¯å¦æ›´æ–°ã€‚', 'success');\n            }, 1000);\n        }\n        \n        // ç›´æ¥æµ‹è¯•API\n        async function testAPIDirectly() {\n            addDebugInfo('ç›´æ¥æµ‹è¯•API...');\n            \n            try {\n                // æµ‹è¯•GET\n                const getResponse = await fetch('/api/homepage');\n                const getData = await getResponse.json();\n                addDebugInfo('GET APIå“åº”: ' + JSON.stringify(getData, null, 2));\n                \n                // æµ‹è¯•POSTï¼ˆå¦‚æœæœ‰è®¤è¯ä»¤ç‰Œï¼‰\n                if (authToken) {\n                    const testContent = {\n                        'site-title': 'ç›´æ¥APIæµ‹è¯•æ ‡é¢˜',\n                        'site-tagline': 'ç›´æ¥APIæµ‹è¯•æ ‡è¯­'\n                    };\n                    \n                    const postResponse = await fetch('/api/homepage', {\n                        method: 'POST',\n                        headers: {\n                            'Content-Type': 'application/json',\n                            'Authorization': `Bearer ${authToken}`\n                        },\n                        body: JSON.stringify(testContent)\n                    });\n                    \n                    const postData = await postResponse.json();\n                    addDebugInfo('POST APIå“åº”: ' + JSON.stringify(postData, null, 2));\n                }\n                \n                showStatus('APIæµ‹è¯•å®Œæˆï¼Œè¯·æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯', 'success');\n            } catch (error) {\n                addDebugInfo('âŒ APIæµ‹è¯•é”™è¯¯: ' + error.message);\n                showStatus('APIæµ‹è¯•å¤±è´¥: ' + error.message, 'error');\n            }\n        }\n        \n        // æ£€æŸ¥APIçŠ¶æ€\n        async function checkAPIStatus() {\n            addDebugInfo('æ£€æŸ¥APIçŠ¶æ€...');\n            \n            try {\n                const response = await fetch('/api/homepage');\n                if (response.ok) {\n                    addDebugInfo('âœ… APIçŠ¶æ€æ­£å¸¸');\n                    showStatus('APIçŠ¶æ€æ­£å¸¸', 'success');\n                } else {\n                    addDebugInfo('âŒ APIçŠ¶æ€å¼‚å¸¸: ' + response.status);\n                    showStatus('APIçŠ¶æ€å¼‚å¸¸: ' + response.status, 'error');\n                }\n            } catch (error) {\n                addDebugInfo('âŒ APIè¿æ¥å¤±è´¥: ' + error.message);\n                showStatus('APIè¿æ¥å¤±è´¥: ' + error.message, 'error');\n            }\n        }\n        \n        // å¯¹æ¯”å†…å®¹\n        async function compareContent() {\n            addDebugInfo('å¼€å§‹å¯¹æ¯”å†…å®¹...');\n            \n            try {\n                // è·å–APIå†…å®¹\n                const response = await fetch('/api/homepage');\n                const apiData = await response.json();\n                \n                // è·å–localStorageå†…å®¹\n                const localData = localStorage.getItem('homepage_content');\n                \n                // æ˜¾ç¤ºå¯¹æ¯”\n                document.getElementById('api-content').textContent = JSON.stringify(apiData.content || {}, null, 2);\n                document.getElementById('local-content').textContent = localData || 'æ— æ•°æ®';\n                document.getElementById('content-comparison').style.display = 'grid';\n                \n                addDebugInfo('âœ… å†…å®¹å¯¹æ¯”å®Œæˆ');\n                showStatus('å†…å®¹å¯¹æ¯”å®Œæˆï¼Œè¯·æŸ¥çœ‹ä¸‹æ–¹å¯¹æ¯”ç»“æœ', 'success');\n            } catch (error) {\n                addDebugInfo('âŒ å¯¹æ¯”å¤±è´¥: ' + error.message);\n                showStatus('å¯¹æ¯”å¤±è´¥: ' + error.message, 'error');\n            }\n        }\n        \n        // æ¸…é™¤ç¼“å­˜\n        function clearCache() {\n            localStorage.removeItem('homepage_content');\n            addDebugInfo('âœ… ç¼“å­˜å·²æ¸…é™¤');\n            showStatus('ç¼“å­˜å·²æ¸…é™¤', 'success');\n        }\n        \n        // æ‰“å¼€ä¸»é¡µ\n        function openMainPage() {\n            window.open('/', '_blank');\n            addDebugInfo('å·²æ‰“å¼€ä¸»é¡µ');\n        }\n    </script>\n</body>\n</html>"