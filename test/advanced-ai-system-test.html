<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜çº§AIç³»ç»Ÿæµ‹è¯• - å¦å…‹å¤§æˆ˜</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            background-color: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        
        .danger { background-color: #f44336; }
        .danger:hover { background-color: #da190b; }
        
        .warning { background-color: #ff9800; }
        .warning:hover { background-color: #e68900; }
        
        .info { background-color: #2196F3; }
        .info:hover { background-color: #1976D2; }
        
        canvas {
            border: 2px solid #444;
            background-color: #000;
            display: block;
            margin: 0 auto;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background-color: #333;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .stat-label {
            font-size: 12px;
            color: #ccc;
            margin-top: 5px;
        }
        
        .ai-info {
            background-color: #1a1a2e;
            border-left: 4px solid #16213e;
            padding: 15px;
            margin: 10px 0;
        }
        
        .ai-strategy {
            color: #ffd700;
            font-weight: bold;
        }
        
        .ai-difficulty {
            color: #ff6b6b;
            font-weight: bold;
        }
        
        .log {
            background-color: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            border: 1px solid #333;
            margin-top: 10px;
        }
        
        .performance-chart {
            background-color: #333;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– é«˜çº§AIç³»ç»Ÿæµ‹è¯•</h1>
            <p>æµ‹è¯•å¦å…‹å¤§æˆ˜æ¸¸æˆçš„é«˜çº§äººå·¥æ™ºèƒ½ç³»ç»Ÿ</p>
        </div>

        <div class="test-section">
            <h2>ğŸ® æ¸¸æˆæ§åˆ¶</h2>
            <div class="controls">
                <button id="startTest">å¼€å§‹æµ‹è¯•</button>
                <button id="pauseTest">æš‚åœ/ç»§ç»­</button>
                <button id="resetTest" class="warning">é‡ç½®æµ‹è¯•</button>
                <button id="stopTest" class="danger">åœæ­¢æµ‹è¯•</button>
            </div>
            
            <div class="controls">
                <label>AIéš¾åº¦: 
                    <select id="difficultySelect">
                        <option value="easy">ç®€å•</option>
                        <option value="normal" selected>æ™®é€š</option>
                        <option value="hard">å›°éš¾</option>
                        <option value="expert">ä¸“å®¶</option>
                        <option value="nightmare">å™©æ¢¦</option>
                    </select>
                </label>
                
                <label>AIæ•°é‡: 
                    <input type="range" id="aiCountSlider" min="1" max="8" value="3">
                    <span id="aiCountValue">3</span>
                </label>
                
                <button id="spawnAI" class="info">ç”ŸæˆAIå¦å…‹</button>
                <button id="clearAI" class="warning">æ¸…é™¤AI</button>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ¯ æ¸¸æˆç”»é¢</h2>
            <canvas id="gameCanvas" width="800" height="600"></canvas>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š AIæ€§èƒ½ç»Ÿè®¡</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalAI">0</div>
                    <div class="stat-label">AIå¦å…‹æ•°é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgReactionTime">0ms</div>
                    <div class="stat-label">å¹³å‡ååº”æ—¶é—´</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgAccuracy">0%</div>
                    <div class="stat-label">å¹³å‡å°„å‡»ç²¾åº¦</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="strategySwitches">0</div>
                    <div class="stat-label">ç­–ç•¥åˆ‡æ¢æ¬¡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="teamworkEvents">0</div>
                    <div class="stat-label">å›¢é˜Ÿåä½œäº‹ä»¶</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="learningProgress">0%</div>
                    <div class="stat-label">å­¦ä¹ è¿›åº¦</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ§  AIçŠ¶æ€ä¿¡æ¯</h2>
            <div id="aiStatusContainer">
                <!-- AIçŠ¶æ€ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“ˆ æ€§èƒ½ç›‘æ§</h2>
            <div class="performance-chart">
                <canvas id="performanceChart" width="400" height="200"></canvas>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“ ç³»ç»Ÿæ—¥å¿—</h2>
            <div class="controls">
                <button id="clearLog" class="warning">æ¸…é™¤æ—¥å¿—</button>
                <button id="exportLog" class="info">å¯¼å‡ºæ—¥å¿—</button>
            </div>
            <div id="systemLog" class="log"></div>
        </div>
    </div>

    <!-- å¼•å…¥ä¾èµ– -->
    <script src="../js/entity-component-system.js"></script>
    <script src="../js/map-system.js"></script>
    <script src="../js/tank-system.js"></script>
    <script src="../js/bullet-system.js"></script>
    <script src="../js/ai-system.js"></script>
    <script src="../js/advanced-ai-system.js"></script>
    <script src="../js/combat-system.js"></script>

    <script>
        // é«˜çº§AIç³»ç»Ÿæµ‹è¯•ç±»
        class AdvancedAISystemTest {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.isRunning = false;
                this.isPaused = false;
                
                // æ¸¸æˆç³»ç»Ÿ
                this.entityManager = new EntityManager();
                this.gameMap = null;
                this.aiTanks = [];
                this.playerTank = null;
                
                // æµ‹è¯•ç»Ÿè®¡
                this.stats = {
                    totalAI: 0,
                    reactionTimes: [],
                    accuracyScores: [],
                    strategySwitches: 0,
                    teamworkEvents: 0,
                    learningProgress: 0
                };
                
                // æ€§èƒ½ç›‘æ§
                this.performanceData = {
                    fps: [],
                    aiDecisions: [],
                    memoryUsage: []
                };
                
                this.lastTime = 0;
                this.frameCount = 0;
                this.fpsCounter = 0;
                
                this.initializeUI();
                this.initializeGame();
                this.startPerformanceMonitoring();
            }

            initializeUI() {
                // ç»‘å®šæ§åˆ¶æŒ‰é’®
                document.getElementById('startTest').addEventListener('click', () => this.startTest());
                document.getElementById('pauseTest').addEventListener('click', () => this.togglePause());
                document.getElementById('resetTest').addEventListener('click', () => this.resetTest());
                document.getElementById('stopTest').addEventListener('click', () => this.stopTest());
                
                document.getElementById('spawnAI').addEventListener('click', () => this.spawnAITank());
                document.getElementById('clearAI').addEventListener('click', () => this.clearAI());
                document.getElementById('clearLog').addEventListener('click', () => this.clearLog());
                document.getElementById('exportLog').addEventListener('click', () => this.exportLog());
                
                // AIæ•°é‡æ»‘å—
                const aiCountSlider = document.getElementById('aiCountSlider');
                const aiCountValue = document.getElementById('aiCountValue');
                aiCountSlider.addEventListener('input', (e) => {
                    aiCountValue.textContent = e.target.value;
                });
                
                this.log('é«˜çº§AIç³»ç»Ÿæµ‹è¯•åˆå§‹åŒ–å®Œæˆ');
            }

            initializeGame() {
                // åˆ›å»ºæ¸¸æˆåœ°å›¾
                this.gameMap = new GameMap(25, 19, 32);
                this.gameMap.generateRandomMap();
                
                // åˆ›å»ºç©å®¶å¦å…‹ï¼ˆç”¨äºAIæµ‹è¯•ç›®æ ‡ï¼‰
                this.createPlayerTank();
                
                this.log('æ¸¸æˆç¯å¢ƒåˆå§‹åŒ–å®Œæˆ');
            }

            createPlayerTank() {
                const playerEntity = this.entityManager.createEntity();
                playerEntity.addTag('player');
                
                // æ·»åŠ ç»„ä»¶
                playerEntity.addComponent(new Transform(400, 300, 0));
                playerEntity.addComponent(new Movement(100));
                playerEntity.addComponent(new Health(100, 100));
                playerEntity.addComponent(new Weapon('normal', 25, 500, 300));
                
                // æ·»åŠ æ¸²æŸ“ç»„ä»¶
                const renderer = new Renderer('#00ff00', 24, 24);
                renderer.shape = 'tank';
                playerEntity.addComponent(renderer);
                
                // æ·»åŠ ç¢°æ’ä½“
                playerEntity.addComponent(new Collider(24, 24, 'player'));
                
                this.playerTank = playerEntity;
                this.log('ç©å®¶å¦å…‹åˆ›å»ºå®Œæˆ');
            }

            spawnAITank() {
                const difficulty = document.getElementById('difficultySelect').value;
                const strategies = Object.values(AdvancedAISystem.AIStrategy);
                const strategy = strategies[Math.floor(Math.random() * strategies.length)];
                
                // éšæœºç”Ÿæˆä½ç½®
                let x, y;
                do {
                    x = Math.random() * (this.canvas.width - 50) + 25;
                    y = Math.random() * (this.canvas.height - 50) + 25;
                } while (!this.gameMap.isPassable(x, y));
                
                const aiEntity = this.entityManager.createEntity();
                aiEntity.addTag('enemy');
                
                // æ·»åŠ åŸºç¡€ç»„ä»¶
                aiEntity.addComponent(new Transform(x, y, Math.random() * Math.PI * 2));
                aiEntity.addComponent(new Movement(80 + Math.random() * 40));
                aiEntity.addComponent(new Health(100, 100));
                aiEntity.addComponent(new Weapon('normal', 25, 600, 250));
                
                // æ·»åŠ æ¸²æŸ“ç»„ä»¶
                const renderer = new Renderer('#ff4444', 24, 24);
                renderer.shape = 'tank';
                aiEntity.addComponent(renderer);
                
                // æ·»åŠ ç¢°æ’ä½“
                aiEntity.addComponent(new Collider(24, 24, 'enemy'));
                
                // æ·»åŠ é«˜çº§AIæ§åˆ¶å™¨
                const aiController = new AdvancedAISystem.AdvancedAIController(
                    AISystem.AIBehavior.BALANCED,
                    difficulty
                );
                aiController.entity = aiEntity;
                aiController.gameMap = this.gameMap;
                aiController.strategy = strategy;
                
                aiEntity.addComponent(aiController);
                
                this.aiTanks.push(aiEntity);
                this.stats.totalAI++;
                
                this.log(`ç”ŸæˆAIå¦å…‹ - éš¾åº¦: ${difficulty}, ç­–ç•¥: ${strategy}`);
                this.updateStats();
            }

            clearAI() {
                for (const aiTank of this.aiTanks) {
                    this.entityManager.removeEntity(aiTank);
                }
                this.aiTanks = [];
                this.stats.totalAI = 0;
                this.log('æ¸…é™¤æ‰€æœ‰AIå¦å…‹');
                this.updateStats();
            }

            startTest() {
                if (this.isRunning) return;
                
                this.isRunning = true;
                this.isPaused = false;
                
                // ç”Ÿæˆåˆå§‹AIå¦å…‹
                const aiCount = parseInt(document.getElementById('aiCountSlider').value);
                for (let i = 0; i < aiCount; i++) {
                    this.spawnAITank();
                }
                
                this.gameLoop();
                this.log('æµ‹è¯•å¼€å§‹');
            }

            togglePause() {
                if (!this.isRunning) return;
                
                this.isPaused = !this.isPaused;
                if (!this.isPaused) {
                    this.gameLoop();
                }
                this.log(this.isPaused ? 'æµ‹è¯•æš‚åœ' : 'æµ‹è¯•ç»§ç»­');
            }

            resetTest() {
                this.stopTest();
                this.clearAI();
                this.stats = {
                    totalAI: 0,
                    reactionTimes: [],
                    accuracyScores: [],
                    strategySwitches: 0,
                    teamworkEvents: 0,
                    learningProgress: 0
                };
                this.performanceData = {
                    fps: [],
                    aiDecisions: [],
                    memoryUsage: []
                };
                this.updateStats();
                this.log('æµ‹è¯•é‡ç½®');
            }

            stopTest() {
                this.isRunning = false;
                this.isPaused = false;
                this.log('æµ‹è¯•åœæ­¢');
            }

            gameLoop(currentTime = 0) {
                if (!this.isRunning || this.isPaused) return;
                
                const deltaTime = currentTime - this.lastTime;
                this.lastTime = currentTime;
                
                // æ›´æ–°FPSè®¡æ•°
                this.frameCount++;
                if (currentTime - this.fpsCounter >= 1000) {
                    this.performanceData.fps.push(this.frameCount);
                    if (this.performanceData.fps.length > 60) {
                        this.performanceData.fps.shift();
                    }
                    this.frameCount = 0;
                    this.fpsCounter = currentTime;
                }
                
                // æ›´æ–°æ¸¸æˆé€»è¾‘
                this.update(deltaTime);
                
                // æ¸²æŸ“
                this.render();
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                this.updateStats();
                this.updateAIStatus();
                
                requestAnimationFrame((time) => this.gameLoop(time));
            }

            update(deltaTime) {
                // æ›´æ–°æ‰€æœ‰å®ä½“
                const entities = this.entityManager.getAllEntities();
                for (const entity of entities) {
                    // æ›´æ–°AIæ§åˆ¶å™¨
                    const aiController = entity.getComponent('AdvancedAIController') || 
                                       entity.getComponent('AIController');
                    if (aiController) {
                        aiController.update(deltaTime);
                        
                        // æ”¶é›†AIæ€§èƒ½æ•°æ®
                        this.collectAIPerformanceData(aiController);
                    }
                    
                    // æ›´æ–°ç§»åŠ¨
                    const movement = entity.getComponent('Movement');
                    const transform = entity.getComponent('Transform');
                    if (movement && transform) {
                        transform.x += movement.velocity.x * deltaTime / 1000;
                        transform.y += movement.velocity.y * deltaTime / 1000;
                        
                        // è¾¹ç•Œæ£€æŸ¥
                        transform.x = Math.max(12, Math.min(this.canvas.width - 12, transform.x));
                        transform.y = Math.max(12, Math.min(this.canvas.height - 12, transform.y));
                    }
                }
                
                // ç®€å•çš„ç¢°æ’æ£€æµ‹å’Œæˆ˜æ–—é€»è¾‘
                this.handleCombat();
            }

            collectAIPerformanceData(aiController) {
                if (aiController.difficultyConfig) {
                    this.stats.reactionTimes.push(aiController.difficultyConfig.reactionTime);
                    this.stats.accuracyScores.push(aiController.difficultyConfig.accuracy * 100);
                    
                    // ä¿æŒæ•°ç»„å¤§å°
                    if (this.stats.reactionTimes.length > 100) {
                        this.stats.reactionTimes.shift();
                        this.stats.accuracyScores.shift();
                    }
                }
                
                // æ£€æµ‹ç­–ç•¥åˆ‡æ¢
                if (aiController.lastStrategy && aiController.lastStrategy !== aiController.strategy) {
                    this.stats.strategySwitches++;
                    this.log(`AIç­–ç•¥åˆ‡æ¢: ${aiController.lastStrategy} -> ${aiController.strategy}`);
                }
                aiController.lastStrategy = aiController.strategy;
                
                // æ£€æµ‹å›¢é˜Ÿåä½œäº‹ä»¶
                if (aiController.teamwork && aiController.teamwork.communicationMessages.length > 0) {
                    this.stats.teamworkEvents += aiController.teamwork.communicationMessages.length;
                }
                
                // å­¦ä¹ è¿›åº¦
                if (aiController.learning && aiController.learning.behaviorPatterns.size > 0) {
                    this.stats.learningProgress = Math.min(100, 
                        aiController.learning.behaviorPatterns.size * 10);
                }
            }

            handleCombat() {
                // ç®€åŒ–çš„æˆ˜æ–—é€»è¾‘
                const entities = this.entityManager.getAllEntities();
                
                for (const entity of entities) {
                    const aiController = entity.getComponent('AdvancedAIController');
                    if (aiController && aiController.wantToFire) {
                        // æ¨¡æ‹Ÿå°„å‡»
                        aiController.wantToFire = false;
                        this.log(`AIå¦å…‹ ${entity.id} å¼€ç«`);
                    }
                }
            }

            render() {
                // æ¸…ç©ºç”»å¸ƒ
                this.ctx.fillStyle = '#000000';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // æ¸²æŸ“åœ°å›¾
                if (this.gameMap) {
                    this.renderMap();
                }
                
                // æ¸²æŸ“æ‰€æœ‰å®ä½“
                const entities = this.entityManager.getAllEntities();
                for (const entity of entities) {
                    this.renderEntity(entity);
                }
                
                // æ¸²æŸ“AIè°ƒè¯•ä¿¡æ¯
                this.renderAIDebugInfo();
            }

            renderMap() {
                const tileSize = this.gameMap.tileSize;
                
                for (let y = 0; y < this.gameMap.height; y++) {
                    for (let x = 0; x < this.gameMap.width; x++) {
                        const tile = this.gameMap.getTile(x, y);
                        const pixelX = x * tileSize;
                        const pixelY = y * tileSize;
                        
                        switch (tile) {
                            case 1: // å¢™å£
                                this.ctx.fillStyle = '#8B4513';
                                this.ctx.fillRect(pixelX, pixelY, tileSize, tileSize);
                                break;
                            case 2: // é’¢å¢™
                                this.ctx.fillStyle = '#696969';
                                this.ctx.fillRect(pixelX, pixelY, tileSize, tileSize);
                                break;
                            case 3: // æ°´åŸŸ
                                this.ctx.fillStyle = '#4169E1';
                                this.ctx.fillRect(pixelX, pixelY, tileSize, tileSize);
                                break;
                        }
                    }
                }
            }

            renderEntity(entity) {
                const transform = entity.getComponent('Transform');
                const renderer = entity.getComponent('Renderer');
                
                if (!transform || !renderer) return;
                
                this.ctx.save();
                this.ctx.translate(transform.x, transform.y);
                this.ctx.rotate(transform.rotation);
                
                this.ctx.fillStyle = renderer.color;
                
                if (renderer.shape === 'tank') {
                    // ç»˜åˆ¶å¦å…‹
                    this.ctx.fillRect(-renderer.width/2, -renderer.height/2, 
                                    renderer.width, renderer.height);
                    
                    // ç»˜åˆ¶ç‚®ç®¡
                    this.ctx.fillRect(0, -2, renderer.width/2, 4);
                } else {
                    // é»˜è®¤çŸ©å½¢
                    this.ctx.fillRect(-renderer.width/2, -renderer.height/2, 
                                    renderer.width, renderer.height);
                }
                
                this.ctx.restore();
            }

            renderAIDebugInfo() {
                // æ¸²æŸ“AIçš„è§†é‡èŒƒå›´ã€è·¯å¾„ç­‰è°ƒè¯•ä¿¡æ¯
                for (const aiTank of this.aiTanks) {
                    const transform = aiTank.getComponent('Transform');
                    const aiController = aiTank.getComponent('AdvancedAIController');
                    
                    if (!transform || !aiController) continue;
                    
                    // ç»˜åˆ¶è§†é‡èŒƒå›´
                    this.ctx.strokeStyle = 'rgba(255, 255, 0, 0.3)';
                    this.ctx.beginPath();
                    this.ctx.arc(transform.x, transform.y, aiController.config?.viewDistance || 200, 0, Math.PI * 2);
                    this.ctx.stroke();
                    
                    // ç»˜åˆ¶æ”»å‡»èŒƒå›´
                    this.ctx.strokeStyle = 'rgba(255, 0, 0, 0.3)';
                    this.ctx.beginPath();
                    this.ctx.arc(transform.x, transform.y, aiController.config?.attackRange || 150, 0, Math.PI * 2);
                    this.ctx.stroke();
                    
                    // ç»˜åˆ¶å±é™©åŒºåŸŸ
                    if (aiController.dangerZones) {
                        for (const zone of aiController.dangerZones) {
                            this.ctx.fillStyle = 'rgba(255, 0, 0, 0.1)';
                            this.ctx.beginPath();
                            this.ctx.arc(zone.x, zone.y, zone.radius, 0, Math.PI * 2);
                            this.ctx.fill();
                        }
                    }
                    
                    // ç»˜åˆ¶å®‰å…¨åŒºåŸŸ
                    if (aiController.safeZones) {
                        for (const zone of aiController.safeZones.slice(0, 3)) { // åªæ˜¾ç¤ºå‰3ä¸ª
                            this.ctx.fillStyle = 'rgba(0, 255, 0, 0.1)';
                            this.ctx.beginPath();
                            this.ctx.arc(zone.x, zone.y, 30, 0, Math.PI * 2);
                            this.ctx.fill();
                        }
                    }
                }
            }

            updateStats() {
                document.getElementById('totalAI').textContent = this.stats.totalAI;
                
                const avgReactionTime = this.stats.reactionTimes.length > 0 ?
                    Math.round(this.stats.reactionTimes.reduce((a, b) => a + b, 0) / this.stats.reactionTimes.length) : 0;
                document.getElementById('avgReactionTime').textContent = avgReactionTime + 'ms';
                
                const avgAccuracy = this.stats.accuracyScores.length > 0 ?
                    Math.round(this.stats.accuracyScores.reduce((a, b) => a + b, 0) / this.stats.accuracyScores.length) : 0;
                document.getElementById('avgAccuracy').textContent = avgAccuracy + '%';
                
                document.getElementById('strategySwitches').textContent = this.stats.strategySwitches;
                document.getElementById('teamworkEvents').textContent = this.stats.teamworkEvents;
                document.getElementById('learningProgress').textContent = this.stats.learningProgress + '%';
            }

            updateAIStatus() {
                const container = document.getElementById('aiStatusContainer');
                container.innerHTML = '';
                
                for (let i = 0; i < this.aiTanks.length; i++) {
                    const aiTank = this.aiTanks[i];
                    const aiController = aiTank.getComponent('AdvancedAIController');
                    const health = aiTank.getComponent('Health');
                    
                    if (!aiController) continue;
                    
                    const statusDiv = document.createElement('div');
                    statusDiv.className = 'ai-info';
                    statusDiv.innerHTML = `
                        <h4>AIå¦å…‹ #${i + 1}</h4>
                        <p><span class="ai-strategy">ç­–ç•¥:</span> ${aiController.strategy || 'unknown'}</p>
                        <p><span class="ai-difficulty">éš¾åº¦:</span> ${aiController.difficulty || 'normal'}</p>
                        <p>çŠ¶æ€: ${aiController.currentState || 'idle'}</p>
                        <p>ç”Ÿå‘½å€¼: ${health ? health.current : 0}/${health ? health.max : 0}</p>
                        <p>ç›®æ ‡: ${aiController.target ? 'æœ‰ç›®æ ‡' : 'æ— ç›®æ ‡'}</p>
                        <p>å±é™©åŒºåŸŸ: ${aiController.dangerZones ? aiController.dangerZones.length : 0}</p>
                        <p>å®‰å…¨åŒºåŸŸ: ${aiController.safeZones ? aiController.safeZones.length : 0}</p>
                    `;
                    container.appendChild(statusDiv);
                }
            }

            startPerformanceMonitoring() {
                setInterval(() => {
                    if (!this.isRunning) return;
                    
                    // æ›´æ–°æ€§èƒ½å›¾è¡¨
                    this.updatePerformanceChart();
                }, 1000);
            }

            updatePerformanceChart() {
                const canvas = document.getElementById('performanceChart');
                const ctx = canvas.getContext('2d');
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // ç»˜åˆ¶FPSå›¾è¡¨
                if (this.performanceData.fps.length > 1) {
                    ctx.strokeStyle = '#4CAF50';
                    ctx.beginPath();
                    
                    const maxFPS = Math.max(...this.performanceData.fps, 60);
                    const stepX = canvas.width / (this.performanceData.fps.length - 1);
                    
                    for (let i = 0; i < this.performanceData.fps.length; i++) {
                        const x = i * stepX;
                        const y = canvas.height - (this.performanceData.fps[i] / maxFPS) * canvas.height;
                        
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    
                    ctx.stroke();
                    
                    // ç»˜åˆ¶æ ‡ç­¾
                    ctx.fillStyle = '#fff';
                    ctx.font = '12px Arial';
                    ctx.fillText(`FPS: ${this.performanceData.fps[this.performanceData.fps.length - 1] || 0}`, 10, 20);
                }
            }

            log(message) {
                const logElement = document.getElementById('systemLog');
                const timestamp = new Date().toLocaleTimeString();
                logElement.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                logElement.scrollTop = logElement.scrollHeight;
            }

            clearLog() {
                document.getElementById('systemLog').innerHTML = '';
            }

            exportLog() {
                const logContent = document.getElementById('systemLog').textContent;
                const blob = new Blob([logContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `ai-test-log-${new Date().toISOString().slice(0, 19)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        // å¯åŠ¨æµ‹è¯•
        let aiTest;
        window.addEventListener('load', () => {
            aiTest = new AdvancedAISystemTest();
        });
    </script>
</body>
</html>