<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾—åˆ†ç³»ç»Ÿæµ‹è¯• - å¦å…‹å¤§æˆ˜</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            background-color: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        
        .danger { background-color: #f44336; }
        .danger:hover { background-color: #da190b; }
        
        .warning { background-color: #ff9800; }
        .warning:hover { background-color: #e68900; }
        
        .info { background-color: #2196F3; }
        .info:hover { background-color: #1976D2; }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background-color: #333;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .stat-label {
            font-size: 12px;
            color: #ccc;
            margin-top: 5px;
        }
        
        .score-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .current-score {
            font-size: 48px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .high-score {
            font-size: 18px;
            color: #ffd700;
            margin-top: 10px;
        }
        
        .lives-display {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .life-icon {
            width: 30px;
            height: 30px;
            background-color: #ff4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .life-icon.lost {
            background-color: #666;
            opacity: 0.3;
        }
        
        .life-icon.respawning {
            background-color: #ffaa00;
            animation: pulse 1s infinite;
        }
        
        .life-icon.invulnerable {
            background-color: #00ff00;
            animation: glow 0.5s infinite alternate;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        @keyframes glow {
            0% { box-shadow: 0 0 5px #00ff00; }
            100% { box-shadow: 0 0 20px #00ff00; }
        }
        
        .combo-display {
            background-color: #ff6b35;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin: 10px 0;
            transform: scale(1);
            transition: transform 0.3s ease;
        }
        
        .combo-display.active {
            transform: scale(1.1);
            animation: comboGlow 0.5s infinite alternate;
        }
        
        @keyframes comboGlow {
            0% { box-shadow: 0 0 10px #ff6b35; }
            100% { box-shadow: 0 0 30px #ff6b35; }
        }
        
        .multiplier-display {
            background-color: #9b59b6;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            margin: 10px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #333;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease;
        }
        
        .events-list {
            background-color: #1a1a2e;
            border-radius: 6px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .event-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin: 5px 0;
            background-color: #16213e;
            border-radius: 4px;
            border-left: 4px solid #4CAF50;
        }
        
        .event-points {
            font-weight: bold;
            color: #ffd700;
        }
        
        .event-type {
            font-size: 12px;
            color: #ccc;
        }
        
        .game-state {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin: 10px 0;
        }
        
        .state-indicator {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .state-playing { color: #27ae60; }
        .state-paused { color: #f39c12; }
        .state-game-over { color: #e74c3c; }
        .state-menu { color: #3498db; }
        
        .accuracy-meter {
            background-color: #333;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .accuracy-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: conic-gradient(#4CAF50 0deg, #4CAF50 var(--accuracy-deg), #333 var(--accuracy-deg), #333 360deg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            position: relative;
        }
        
        .accuracy-circle::before {
            content: '';
            width: 70px;
            height: 70px;
            background-color: #333;
            border-radius: 50%;
            position: absolute;
        }
        
        .accuracy-text {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            z-index: 1;
        }
        
        .log {
            background-color: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            border: 1px solid #333;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ† å¾—åˆ†ç³»ç»Ÿæµ‹è¯•</h1>
            <p>æµ‹è¯•å¦å…‹å¤§æˆ˜æ¸¸æˆçš„å¾—åˆ†ã€ç”Ÿå‘½å€¼å’Œæ¸¸æˆçŠ¶æ€ç®¡ç†ç³»ç»Ÿ</p>
        </div>

        <div class="test-section">
            <h2>ğŸ® æ¸¸æˆæ§åˆ¶</h2>
            <div class="controls">
                <button id="startGame">å¼€å§‹æ¸¸æˆ</button>
                <button id="pauseGame">æš‚åœæ¸¸æˆ</button>
                <button id="resumeGame">ç»§ç»­æ¸¸æˆ</button>
                <button id="gameOver" class="danger">æ¸¸æˆç»“æŸ</button>
                <button id="resetGame" class="warning">é‡ç½®æ¸¸æˆ</button>
            </div>
            
            <div class="controls">
                <button id="completeLevel" class="info">å®Œæˆå…³å¡</button>
                <button id="nextLevel" class="info">ä¸‹ä¸€å…³</button>
                <button id="loseLife" class="danger">å¤±å»ç”Ÿå‘½</button>
                <button id="gainLife" class="info">è·å¾—ç”Ÿå‘½</button>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ’° å¾—åˆ†æ˜¾ç¤º</h2>
            <div class="score-display">
                <div class="current-score" id="currentScore">0</div>
                <div class="high-score">æœ€é«˜åˆ†: <span id="highScore">0</span></div>
            </div>
            
            <div class="combo-display" id="comboDisplay">
                <div>è¿å‡»: <span id="comboCount">0</span></div>
                <div>æœ€é«˜è¿å‡»: <span id="maxCombo">0</span></div>
            </div>
            
            <div class="multiplier-display" id="multiplierDisplay">
                <div>å¾—åˆ†å€æ•°: x<span id="multiplier">1.0</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="multiplierProgress" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>â¤ï¸ ç”Ÿå‘½å€¼ç³»ç»Ÿ</h2>
            <div class="lives-display" id="livesDisplay">
                <!-- ç”Ÿå‘½å›¾æ ‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="controls">
                <div>é‡ç”Ÿè¿›åº¦: <span id="respawnProgress">0%</span></div>
                <div>æ— æ•Œæ—¶é—´: <span id="invulnerabilityTime">0%</span></div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ¯ ç²¾åº¦ç»Ÿè®¡</h2>
            <div class="accuracy-meter">
                <div class="accuracy-circle" id="accuracyCircle">
                    <div class="accuracy-text" id="accuracyText">0%</div>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <div>å‘½ä¸­: <span id="shotsHit">0</span> / å‘å°„: <span id="shotsFired">0</span></div>
                </div>
            </div>
            
            <div class="controls">
                <button id="fireShot" class="info">å‘å°„å­å¼¹</button>
                <button id="hitTarget" class="info">å‘½ä¸­ç›®æ ‡</button>
                <button id="missTarget" class="warning">æœªå‘½ä¸­</button>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ® æ¸¸æˆçŠ¶æ€</h2>
            <div class="game-state">
                <div class="state-indicator" id="gameStateIndicator">MENU</div>
                <div>å…³å¡: <span id="currentLevel">1</span> / <span id="maxLevel">20</span></div>
                <div>æ•Œäºº: <span id="enemiesDestroyed">0</span> / <span id="enemiesTotal">0</span></div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ… å¾—åˆ†æ“ä½œ</h2>
            <div class="controls">
                <button id="destroyBasicEnemy" class="info">æ¶ˆç­åŸºç¡€æ•Œäºº (+100)</button>
                <button id="destroyFastEnemy" class="info">æ¶ˆç­å¿«é€Ÿæ•Œäºº (+200)</button>
                <button id="destroyHeavyEnemy" class="info">æ¶ˆç­é‡å‹æ•Œäºº (+300)</button>
                <button id="destroyBoss" class="info">æ¶ˆç­Boss (+1000)</button>
            </div>
            
            <div class="controls">
                <button id="collectCommonPowerUp" class="info">æ”¶é›†æ™®é€šé“å…· (+50)</button>
                <button id="collectRarePowerUp" class="info">æ”¶é›†ç¨€æœ‰é“å…· (+200)</button>
                <button id="collectLegendaryPowerUp" class="info">æ”¶é›†ä¼ è¯´é“å…· (+1000)</button>
            </div>
            
            <div class="controls">
                <button id="setMultiplier" class="warning">è®¾ç½®2å€å¾—åˆ† (10ç§’)</button>
                <button id="addBonus" class="info">å¥–åŠ±å¾—åˆ† (+500)</button>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="sessionScore">0</div>
                    <div class="stat-label">æœ¬æ¬¡å¾—åˆ†</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="levelScore">0</div>
                    <div class="stat-label">å…³å¡å¾—åˆ†</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalEvents">0</div>
                    <div class="stat-label">å¾—åˆ†äº‹ä»¶</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="deathCount">0</div>
                    <div class="stat-label">æ­»äº¡æ¬¡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="respawnCount">0</div>
                    <div class="stat-label">é‡ç”Ÿæ¬¡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="playTime">0s</div>
                    <div class="stat-label">æ¸¸æˆæ—¶é—´</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“ˆ æœ€è¿‘å¾—åˆ†äº‹ä»¶</h2>
            <div id="recentEvents" class="events-list">
                <p>æš‚æ— å¾—åˆ†äº‹ä»¶</p>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“ ç³»ç»Ÿæ—¥å¿—</h2>
            <div class="controls">
                <button id="clearLog" class="warning">æ¸…é™¤æ—¥å¿—</button>
                <button id="exportLog" class="info">å¯¼å‡ºæ—¥å¿—</button>
            </div>
            <div id="systemLog" class="log"></div>
        </div>
    </div>

    <!-- å¼•å…¥ä¾èµ– -->
    <script src="../js/entity-component-system.js"></script>
    <script src="../js/score-system.js"></script>

    <script>
        // å¾—åˆ†ç³»ç»Ÿæµ‹è¯•ç±»
        class ScoreSystemTest {
            constructor() {
                this.scoreComponent = new ScoreSystem.ScoreComponent();
                this.lifeSystem = new ScoreSystem.LifeSystem(3, 3000);
                this.gameStateManager = new ScoreSystem.GameStateManager();
                
                this.updateInterval = null;
                
                this.initializeUI();
                this.startUpdateLoop();
                this.setupEventListeners();
            }

            initializeUI() {
                // ç»‘å®šæ§åˆ¶æŒ‰é’®
                document.getElementById('startGame').addEventListener('click', () => this.startGame());
                document.getElementById('pauseGame').addEventListener('click', () => this.pauseGame());
                document.getElementById('resumeGame').addEventListener('click', () => this.resumeGame());
                document.getElementById('gameOver').addEventListener('click', () => this.gameOver());
                document.getElementById('resetGame').addEventListener('click', () => this.resetGame());
                
                document.getElementById('completeLevel').addEventListener('click', () => this.completeLevel());
                document.getElementById('nextLevel').addEventListener('click', () => this.nextLevel());
                document.getElementById('loseLife').addEventListener('click', () => this.loseLife());
                document.getElementById('gainLife').addEventListener('click', () => this.gainLife());
                
                // å¾—åˆ†æ“ä½œ
                document.getElementById('destroyBasicEnemy').addEventListener('click', () => 
                    this.addScore(100, ScoreSystem.ScoreEventType.ENEMY_DESTROYED, { enemyType: 'ENEMY_BASIC' }));
                document.getElementById('destroyFastEnemy').addEventListener('click', () => 
                    this.addScore(200, ScoreSystem.ScoreEventType.ENEMY_DESTROYED, { enemyType: 'ENEMY_FAST' }));
                document.getElementById('destroyHeavyEnemy').addEventListener('click', () => 
                    this.addScore(300, ScoreSystem.ScoreEventType.ENEMY_DESTROYED, { enemyType: 'ENEMY_HEAVY' }));
                document.getElementById('destroyBoss').addEventListener('click', () => 
                    this.addScore(1000, ScoreSystem.ScoreEventType.ENEMY_DESTROYED, { enemyType: 'ENEMY_BOSS' }));
                
                document.getElementById('collectCommonPowerUp').addEventListener('click', () => 
                    this.addScore(50, ScoreSystem.ScoreEventType.POWERUP_COLLECTED, { rarity: 'common' }));
                document.getElementById('collectRarePowerUp').addEventListener('click', () => 
                    this.addScore(200, ScoreSystem.ScoreEventType.POWERUP_COLLECTED, { rarity: 'rare' }));
                document.getElementById('collectLegendaryPowerUp').addEventListener('click', () => 
                    this.addScore(1000, ScoreSystem.ScoreEventType.POWERUP_COLLECTED, { rarity: 'legendary' }));
                
                document.getElementById('setMultiplier').addEventListener('click', () => this.setMultiplier());
                document.getElementById('addBonus').addEventListener('click', () => this.addBonus());
                
                // ç²¾åº¦æµ‹è¯•
                document.getElementById('fireShot').addEventListener('click', () => this.fireShot());
                document.getElementById('hitTarget').addEventListener('click', () => this.hitTarget());
                document.getElementById('missTarget').addEventListener('click', () => this.missTarget());
                
                document.getElementById('clearLog').addEventListener('click', () => this.clearLog());
                document.getElementById('exportLog').addEventListener('click', () => this.exportLog());
                
                this.log('å¾—åˆ†ç³»ç»Ÿæµ‹è¯•åˆå§‹åŒ–å®Œæˆ');
            }

            setupEventListeners() {
                // ç›‘å¬å¾—åˆ†äº‹ä»¶
                window.addEventListener('scoreAdded', (e) => {
                    const { points, eventType, details } = e.detail;
                    this.log(`ğŸ’° å¾—åˆ†äº‹ä»¶: +${points} (${eventType})`);
                    this.updateRecentEvents();
                });
                
                // ç›‘å¬æ¸¸æˆçŠ¶æ€å˜æ›´
                window.addEventListener('gameStateChanged', (e) => {
                    const { newState, oldState } = e.detail;
                    this.log(`ğŸ® çŠ¶æ€å˜æ›´: ${oldState} -> ${newState}`);
                });
            }

            startUpdateLoop() {
                this.updateInterval = setInterval(() => {
                    this.update();
                    this.updateUI();
                }, 100); // 100msæ›´æ–°é—´éš”
            }

            update() {
                const deltaTime = 100;
                
                this.scoreComponent.update(deltaTime);
                this.lifeSystem.update(deltaTime);
                
                // æ›´æ–°æ¸¸æˆçŠ¶æ€ç®¡ç†å™¨çš„å…³å¡æ•°æ®
                if (this.gameStateManager.gameState === 'PLAYING') {
                    this.gameStateManager.sessionData.playTime = Date.now() - this.gameStateManager.sessionData.startTime;
                }
            }

            updateUI() {
                // æ›´æ–°å¾—åˆ†æ˜¾ç¤º
                const scoreStats = this.scoreComponent.getStats();
                document.getElementById('currentScore').textContent = scoreStats.currentScore.toLocaleString();
                document.getElementById('highScore').textContent = scoreStats.highScore.toLocaleString();
                document.getElementById('comboCount').textContent = scoreStats.comboCount;
                document.getElementById('maxCombo').textContent = scoreStats.maxCombo;
                document.getElementById('multiplier').textContent = scoreStats.multiplier.toFixed(1);
                
                // æ›´æ–°å€æ•°è¿›åº¦æ¡
                const multiplierProgress = this.scoreComponent.multiplier > 1.0 ? 
                    (1 - this.scoreComponent.multiplierTimer / this.scoreComponent.multiplierDuration) * 100 : 0;
                document.getElementById('multiplierProgress').style.width = multiplierProgress + '%';
                
                // æ›´æ–°è¿å‡»æ˜¾ç¤º
                const comboDisplay = document.getElementById('comboDisplay');
                if (scoreStats.comboCount > 0) {
                    comboDisplay.classList.add('active');
                } else {
                    comboDisplay.classList.remove('active');
                }
                
                // æ›´æ–°ç”Ÿå‘½å€¼æ˜¾ç¤º
                this.updateLivesDisplay();
                
                // æ›´æ–°ç²¾åº¦æ˜¾ç¤º
                this.updateAccuracyDisplay();
                
                // æ›´æ–°æ¸¸æˆçŠ¶æ€æ˜¾ç¤º
                this.updateGameStateDisplay();
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                this.updateStats();
            }

            updateLivesDisplay() {
                const livesDisplay = document.getElementById('livesDisplay');
                const lifeStats = this.lifeSystem.getStats();
                
                livesDisplay.innerHTML = '';
                
                for (let i = 0; i < lifeStats.maxLives; i++) {
                    const lifeIcon = document.createElement('div');
                    lifeIcon.className = 'life-icon';
                    lifeIcon.textContent = 'â¤ï¸';
                    
                    if (i >= lifeStats.currentLives) {
                        lifeIcon.classList.add('lost');
                    } else if (lifeStats.isRespawning && i === lifeStats.currentLives - 1) {
                        lifeIcon.classList.add('respawning');
                    } else if (lifeStats.isInvulnerable && i === lifeStats.currentLives - 1) {
                        lifeIcon.classList.add('invulnerable');
                    }
                    
                    livesDisplay.appendChild(lifeIcon);
                }
                
                // æ›´æ–°é‡ç”Ÿå’Œæ— æ•Œè¿›åº¦
                const respawnProgress = this.lifeSystem.getRespawnProgress() * 100;
                const invulnerabilityProgress = this.lifeSystem.getInvulnerabilityProgress() * 100;
                
                document.getElementById('respawnProgress').textContent = respawnProgress.toFixed(0) + '%';
                document.getElementById('invulnerabilityTime').textContent = invulnerabilityProgress.toFixed(0) + '%';
            }

            updateAccuracyDisplay() {
                const scoreStats = this.scoreComponent.getStats();
                const accuracy = scoreStats.accuracy * 100;
                
                document.getElementById('accuracyText').textContent = accuracy.toFixed(1) + '%';
                document.getElementById('shotsHit').textContent = scoreStats.shotsHit;
                document.getElementById('shotsFired').textContent = scoreStats.shotsFired;
                
                // æ›´æ–°ç²¾åº¦åœ†ç¯
                const accuracyCircle = document.getElementById('accuracyCircle');
                accuracyCircle.style.setProperty('--accuracy-deg', (accuracy * 3.6) + 'deg');
            }

            updateGameStateDisplay() {
                const gameStats = this.gameStateManager.getStats();
                const stateIndicator = document.getElementById('gameStateIndicator');
                
                stateIndicator.textContent = gameStats.gameState;
                stateIndicator.className = 'state-indicator state-' + gameStats.gameState.toLowerCase();
                
                document.getElementById('currentLevel').textContent = gameStats.currentLevel;
                document.getElementById('maxLevel').textContent = this.gameStateManager.maxLevel;
                document.getElementById('enemiesDestroyed').textContent = gameStats.levelData.enemiesDestroyed;
                document.getElementById('enemiesTotal').textContent = gameStats.levelData.enemiesTotal;
            }

            updateStats() {
                const scoreStats = this.scoreComponent.getStats();
                const lifeStats = this.lifeSystem.getStats();
                const gameStats = this.gameStateManager.getStats();
                
                document.getElementById('sessionScore').textContent = scoreStats.sessionScore.toLocaleString();
                document.getElementById('levelScore').textContent = scoreStats.levelScore.toLocaleString();
                document.getElementById('totalEvents').textContent = scoreStats.totalEvents;
                document.getElementById('deathCount').textContent = lifeStats.deathCount;
                document.getElementById('respawnCount').textContent = lifeStats.respawnCount;
                
                const playTime = Math.floor(gameStats.sessionData.playTime / 1000);
                document.getElementById('playTime').textContent = playTime + 's';
            }

            updateRecentEvents() {
                const eventsContainer = document.getElementById('recentEvents');
                const recentEvents = this.scoreComponent.getRecentEvents(10);
                
                if (recentEvents.length === 0) {
                    eventsContainer.innerHTML = '<p>æš‚æ— å¾—åˆ†äº‹ä»¶</p>';
                    return;
                }
                
                let html = '';
                for (const event of recentEvents) {
                    const timeAgo = Math.floor((Date.now() - event.timestamp) / 1000);
                    html += `
                        <div class="event-item">
                            <div>
                                <div class="event-points">+${event.points}</div>
                                <div class="event-type">${event.eventType || 'æœªçŸ¥äº‹ä»¶'}</div>
                            </div>
                            <div>${timeAgo}ç§’å‰</div>
                        </div>
                    `;
                }
                
                eventsContainer.innerHTML = html;
            }

            // æ¸¸æˆæ§åˆ¶æ–¹æ³•
            startGame() {
                this.gameStateManager.changeState('PLAYING');
                this.gameStateManager.updateLevelData({
                    enemiesTotal: 10,
                    enemiesDestroyed: 0,
                    timeLimit: 120000,
                    timeRemaining: 120000
                });
                this.log('ğŸ¯ æ¸¸æˆå¼€å§‹');
            }

            pauseGame() {
                if (this.gameStateManager.gameState === 'PLAYING') {
                    this.gameStateManager.changeState('PAUSED');
                    this.log('â¸ï¸ æ¸¸æˆæš‚åœ');
                }
            }

            resumeGame() {
                if (this.gameStateManager.gameState === 'PAUSED') {
                    this.gameStateManager.changeState('PLAYING');
                    this.log('â–¶ï¸ æ¸¸æˆç»§ç»­');
                }
            }

            gameOver() {
                this.gameStateManager.changeState('GAME_OVER');
                this.scoreComponent.gameOver(this.lifeSystem.currentLives);
                this.log('ğŸ’€ æ¸¸æˆç»“æŸ');
            }

            resetGame() {
                this.scoreComponent.reset();
                this.lifeSystem = new ScoreSystem.LifeSystem(3, 3000);
                this.gameStateManager.reset();
                this.log('ğŸ”„ æ¸¸æˆé‡ç½®');
            }

            completeLevel() {
                const timeRemaining = 30; // å‡è®¾å‰©ä½™30ç§’
                const enemiesDestroyed = this.gameStateManager.levelData.enemiesTotal;
                
                this.scoreComponent.completeLevel(timeRemaining, enemiesDestroyed);
                this.gameStateManager.changeState('LEVEL_COMPLETE');
                this.log('ğŸ‰ å…³å¡å®Œæˆ');
            }

            nextLevel() {
                this.gameStateManager.onLevelComplete();
                this.gameStateManager.changeState('PLAYING');
                this.gameStateManager.updateLevelData({
                    enemiesTotal: 10 + this.gameStateManager.currentLevel * 2,
                    enemiesDestroyed: 0
                });
                this.log(`ğŸš€ è¿›å…¥å…³å¡ ${this.gameStateManager.currentLevel}`);
            }

            loseLife() {
                if (this.lifeSystem.loseLife()) {
                    this.gameStateManager.sessionData.totalDeaths++;
                    
                    if (this.lifeSystem.isDead()) {
                        this.gameOver();
                    }
                }
            }

            gainLife() {
                this.lifeSystem.gainLife();
            }

            // å¾—åˆ†æ“ä½œæ–¹æ³•
            addScore(points, eventType, details) {
                this.scoreComponent.addScore(points, eventType, details);
                
                // æ¨¡æ‹Ÿæ•Œäººè¢«æ¶ˆç­
                if (eventType === ScoreSystem.ScoreEventType.ENEMY_DESTROYED) {
                    const levelData = this.gameStateManager.levelData;
                    levelData.enemiesDestroyed++;
                    this.gameStateManager.updateLevelData(levelData);
                    
                    // æ£€æŸ¥å…³å¡å®Œæˆ
                    if (this.gameStateManager.checkLevelComplete()) {
                        this.completeLevel();
                    }
                }
            }

            setMultiplier() {
                this.scoreComponent.setMultiplier(2.0, 10000);
                this.log('âš¡ è®¾ç½®2å€å¾—åˆ†å€æ•°');
            }

            addBonus() {
                this.scoreComponent.addScore(500, ScoreSystem.ScoreEventType.BONUS_ACHIEVED);
            }

            // ç²¾åº¦æµ‹è¯•æ–¹æ³•
            fireShot() {
                this.scoreComponent.recordShot(false);
                this.log('ğŸ”« å‘å°„å­å¼¹');
            }

            hitTarget() {
                this.scoreComponent.recordShot(true);
                this.log('ğŸ¯ å‘½ä¸­ç›®æ ‡');
            }

            missTarget() {
                this.scoreComponent.recordShot(false);
                this.log('âŒ æœªå‘½ä¸­ç›®æ ‡');
            }

            log(message) {
                const logElement = document.getElementById('systemLog');
                const timestamp = new Date().toLocaleTimeString();
                logElement.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                logElement.scrollTop = logElement.scrollHeight;
            }

            clearLog() {
                document.getElementById('systemLog').innerHTML = '';
            }

            exportLog() {
                const logContent = document.getElementById('systemLog').textContent;
                const blob = new Blob([logContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `score-test-log-${new Date().toISOString().slice(0, 19)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        // å¯åŠ¨æµ‹è¯•
        let scoreTest;
        window.addEventListener('load', () => {
            scoreTest = new ScoreSystemTest();
        });
    </script>
</body>
</html>